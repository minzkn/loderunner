# Lode Runner (1983) - 게임 규칙 및 메카닉 참고문서

## 1. 게임 개요

1983년 Broderbund에서 출시된 Lode Runner의 웹 재현판입니다.
Apple II 원본 버전을 기준으로 합니다.

### 기본 규칙
- 금을 모두 수집하여 탈출 사다리를 등장시킨 후, 화면 상단으로 탈출하면 레벨 클리어
- 적(가드)로부터 도피하면서 금을 수집하는 퍼즐 액션 게임
- 점프 불가, 무한 낙하 (어떤 높이에서도 데미지 없음)

---

## 2. 타일 타입

| 값 | 타입 | 문자 | 설명 |
|----|------|------|------|
| 0 | EMPTY | `.` | 빈 공간 (중력 적용) |
| 1 | BRICK | `#` | 벽돌 (파괴 가능, 파기 후 복구) |
| 2 | SOLID | `@` | 단단한 블록 (파기 불가) |
| 3 | LADDER | `H` | 사다리 (상하 이동 가능) |
| 4 | BAR | `-` | 로프/바 (매달리기, 좌우 이동만 가능) |
| 5 | TRAP | `T` | 함정/False Floor (밟으면 즉시 추락) |
| 6 | GOLD | `$` | 금괴 |
| 7 | ESCAPE_LADDER | `E` | 탈출 사다리 (금 수집 후 등장) |

### 플레이어 시작 위치: `P`
### 적 시작 위치: `E`

---

## 3. 기본 상수

```javascript
const BASE_TILE_SIZE = 24;
const LEVEL_WIDTH = 28;
const LEVEL_HEIGHT = 16;
const BASE_WIDTH = 672;   // 24 * 28
const BASE_HEIGHT = 384;  // 24 * 16
```

---

## 4. Apple II 원본 색상 팔레트

| 색상 | HEX | 용도 |
|------|-----|------|
| BLACK | `#000000` | 배경 |
| WHITE | `#FFFFFF` | 플레이어 |
| RED | `#FF0000` | 적, 함정 |
| GREEN | `#00FF00` | 사다리, 금 |
| ORANGE | `#FF8800` | 벽돌 |
| PURPLE | `#AA00FF` | 솔리드 블록 |
| CYAN | `#00AAAA` | 로프/바 |
| YELLOW | `#FFFF00` | 금 상자 |

---

## 5. 게임 상태 (STATE)

| 상태 | 값 | 설명 |
|------|-----|------|
| TITLE | 0 | 타이틀 화면 |
| PLAYING | 1 | 게임 진행 중 |
| PAUSED | 2 | 일시정지 |
| DYING | 3 | 사망 애니메이션 |
| LEVEL_COMPLETE | 4 | 레벨 클리어 |
| GAME_OVER | 5 | 게임 오버 |
| STUCK | 6 | 스턱 (클리어 불가) |
| EDITOR | 7 | 레벨 에디터 |

---

## 6. 플레이어 규칙

### 이동
- **좌/우 이동**: 방향키, A/D, J/L
- **사다리 상하**: 방향키 위아래, W/S, I,K
- **점프 불가**: 가장 중요한 규칙
- **로프 위**: 좌우 이동만 가능, 위로 올라갈 수 없음
- **추락**: 아래가 빈 공간이면 즉시 낙하 (속도 제어 불가)

### 금 운반
- **1개만 운반 가능** (원본 규칙)
- 금을 든 상태에서 다른 금을 줍면 기존 금은 제자리에 떨어짐

### 파기 (Dig)
- **가능 조건**: 왼쪽 아래 또는 오른쪽 아래가 BRICK(벽돌)일 때
- **불가능**: 아래 정면, 공중 (지면 또는 로프/사다리에 있어야 함)
- **파기 시간**: 약 12프레임 애니메이션
- **복구 시간**: 약 7초 (210프레임 at 30fps, 420프레임 at 60fps)
- **복구 시**: 안에 있으면 즉사, 금만 있으면 금만 남고 적만 죽음

---

## 7. 적 (가드) 규칙

### 기본 능력
- 사다리/로프 사용 가능
- BRICK 위 이동 가능
- 금 1개 소지 가능
- 구멍에서 탈출 시도

### AI 행동 패턴
1. **같은 층**: 좌우로 바로 추적
2. **다른 층**: 사다리를 통해 접근 시도
3. **로프 위**: 좌우로만 이동
4. **구멍에 빠짐**: 60프레임 후 탈출 시도 (좌→우 순서)

### 금 줍기/드롭 확률
- **줍기**: 5% ( GOLD_PICKUP_CHANCE = 0.05 )
- **드롭**: 2% ( GOLD_DROP_CHANCE = 0.02 )

### 리스폰
- 화면 상단에서 무작위 위치에 리스폰
- 금은 소지하지 않은 상태

### 구멍에 갇힘
- **갇힘 시간**: 약 5초 (150프레임 at 30fps)
- **탈출 시도**: 60프레임 남았을 때부터
- **탈출 실패 시**: 구멍이 복구되면 즉사

---

## 8. 레벨 클리어

1. 모든 GOLD 수집 → ESCAPE_LADDER 등장
2. ESCAPE_LADDER로 화면 상단 도달 → 레벨 클리어
3. **보상**: +1500점, +1 목숨

---

## 9. 점수 시스템

| 행동 | 점수 |
|------|------|
| 금 줍기 | 250 |
| 적 구멍에 가두기 (압사) | 75 |
| 레벨 클리어 | 1500 |

---

## 10. 타이밍 상수 (30fps 기준)

| 항목 | 프레임 | 시간 (30fps) |
|------|--------|--------------|
| HOLE_FILL_TIME (구멍 복구) | 210 | ~7초 |
| ENEMY_TRAPPED_TIME (적 갇힘) | 150 | ~5초 |
| ENEMY_TRAPPED_ESCAPE (탈출 시도) | 60 | ~2초 |
| GOLD_PICKUP_COOLDOWN | 30 | 1초 |
| DEATH_DELAY | 45 | 1.5초 |
| LEVEL_COMPLETE_DELAY | 60 | 2초 |

### 60fps 기준 (원본)
- HOLE_FILL_TIME: 420 (~7초)
- ENEMY_TRAPPED_TIME: 300 (~5초)

---

## 11. 이동 속도

| 항목 | 값 |
|------|-----|
| PLAYER_SPEED | 0.14 (타일/프레임) |
| ROPE_SPEED_MULTIPLIER | 1.15 (로프 이동 15% 빠름) |

---

## 12. 속도 증가

- 150레벨 이후 15% 속도 증가
- 최대 2.0배 (200%)

---

## 13. 조작법

| 동작 | 키 |
|------|-----|
| 이동 (좌/우) | 방향키 / A,D / J,L |
| 사다리 (상/하) | 방향키 위아래 / W,S / I,K |
| 왼쪽 파기 | Z / F1 / U |
| 오른쪽 파기 | X / F2 / O |
| 시작/재개 | ENTER |
| 일시정지 | ESC |
| 레벨 재시작 | R |
| 레벨 에디터 | E (타이틀에서) |

---

## 14. 레벨 정보

- **총 레벨 수**: 200개 (150개 클래식 + 50개 챔피언십)
- **레벨 포맷**: 28x16 타일
- **문자셋**: `. # @ H - $ T P E`

---

## 15. 레벨 데이터 예시

```
Level 1:
...................-.........
....$.............-.........
#######H#######...-.........
.......H-----------....$....
.......H....##H...#######H##
.......H....##H..........H..
.....E.H....##H.......$E.H..
##H#####....########H#######
..H.................H.......
..H...........E.....H.......
#########H##########H.......
.........H..........H.......
.......$.H----------H...$...
....H######.........#######H
....H.........P..$.........H
############################
```

---

## 16. 레벨 유형 (퍼즐 패턴)

1. **적 유도형**: 적을 특정 위치로 유도해야 금을 얻는 구조
2. **Dig 타이밍 퍼즐**: 구멍 파기 타이밍이 핵심
3. **이중 구멍 락다운**: 두 개의 구멍으로 적을 가두는 패턴
4. **로프 중심**: 로프를 활용한 수평 이동 퍼즐
5. **False Floor 연쇄**: TRAP을 활용한 함정

---

## 17. 디버그/테스트 기능

- **스 턱 감지**: 플레이어가 레벨을 클리어할 수 없는 상태에 빠졌는지 감지
- **레벨 에디터**: E 키로 타이틀 화면에서 진입 가능
- **데모 모드**: 30초 무입력 시 자동 전환
- **음소거**: M 키로 사운드 토글

---

## 18. 주요 메서드 목록

### 초기화
- `constructor()` - 게임 초기화
- `setupResponsiveCanvas()` - 반응형 캔버스 설정
- `setupInput()` - 입력 시스템 설정
- `setupToggle()` - 토글 버튼 설정
- `setupTouchControls()` - 터치 컨트롤 설정

### 레벨 관리
- `loadLevel(levelNum)` - 레벨 로드
- `startGame()` - 게임 시작
- `loadEditorLevel()` - 에디터 레벨 로드

### 게임 루프
- `gameLoop()` - 메인 게임 루프
- `update()` - 게임 상태 업데이트
- `render()` - 렌더링

### 플레이어
- `updatePlayer()` - 플레이어 업데이트
- `collectGold(x, y)` - 금 줍기 (1개만 운반)
- `dig(digX, digY)` - 벽돌 파기
- `playerDie()` - 플레이어 사망
- `updateDigEffects()` - 파기 효과 업데이트

### 적 AI
- `updateEnemies()` - 적 업데이트
- `respawnEnemy(e)` - 적 리스폰
- `checkCollisions()` - 충돌 검사

### 구멍 메카닉
- `updateHoles()` - 구멍 상태 업데이트

### 스턱 감지
- `checkStuck()` - 스턱 상태 검사
- `findReachablePositions(startX, startY)` - 도달 가능한 위치 찾기
- `triggerStuck(reason)` - 스턱 트리거

### 데모 모드
- `startDemo()` - 데모 모드 시작
- `updateDemo()` - 데모 모드 업데이트
- `updateDemoKeyDisplay()` - 데모 키 표시 업데이트

### UI
- `updateUI()` - UI 업데이트
- `updateTitleMessage()` - 타이틀 메시지 업데이트

### 렌더링
- `renderTitleScreen(ctx)` - 타이틀 화면 렌더링
- `drawPlayer(p)` - 플레이어 렌더링
- `drawEnemy(e)` - 적 렌더링
- `drawTile(x, y, tile)` - 타일 렌더링

---

## 19. 파일 구조

```
loderunner/
├── index.html    # 게임 컨테이너
├── style.css    # 반응형 스타일
├── game.js      # 게임 로직 (IIFE)
├── RULES.md     # 게임 규칙 문서
└── .claude/     # Claude 설정
```

---

## 20. 참고사항

- **IIFE 구조**: 전역 변수 오염 방지를 위해 모든 코드가 IIFE로 감싸져 있음
- **프레임 기반 타이밍**: requestAnimationFrame 사용, frameCount로 프레임 관리
- **좌표 시스템**: 타일 좌표 (0~27, 0~15)와 픽셀 좌표 구분
- **스케일 적용**: 모든 렌더링에 TILE_SIZE 사용
- **원작 충실도**: 1983년 Apple II 메카닉을 기준으로 구현
