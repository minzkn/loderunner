// Lode Runner (1983) - Vector Graphics Version
// Faithful recreation based on original Broderbund release

(function() {
    'use strict';

    // ============================================
    // CONSTANTS - Vector Graphics Mode
    // ============================================

    const BASE_TILE_SIZE = 24;
    const LEVEL_WIDTH = 28;
    const LEVEL_HEIGHT = 16;
    const BASE_WIDTH = BASE_TILE_SIZE * LEVEL_WIDTH;   // 672
    const BASE_HEIGHT = BASE_TILE_SIZE * LEVEL_HEIGHT; // 384

    // Dynamic values set by setupCanvas
    let TILE_SIZE = BASE_TILE_SIZE;
    let CANVAS_WIDTH = BASE_WIDTH;
    let CANVAS_HEIGHT = BASE_HEIGHT;
    let SCALE = 1;

    // Tile types
    const TILE = {
        EMPTY: 0,
        BRICK: 1,
        SOLID: 2,
        LADDER: 3,
        BAR: 4,
        TRAP: 5,
        GOLD: 6,
        ESCAPE_LADDER: 7
    };

    // Apple II original color palette (1983)
    const COLORS = {
        BLACK: '#000000',
        WHITE: '#FFFFFF',
        RED: '#FF0000',
        GREEN: '#00FF00',
        ORANGE: '#FF8800',
        PURPLE: '#AA00FF',
        CYAN: '#00AAAA',
        YELLOW: '#FFFF00',
        BROWN: '#8B4513',
        LIGHT_RED: '#FF0000',
        DARK_GRAY: '#444444',
        GRAY: '#888888',
        LIGHT_GREEN: '#00FF00',
        LIGHT_BLUE: '#00AAAA',
        LIGHT_GRAY: '#AAAAAA',
        BLUE: '#0000AA'
    };

    // Animation frames for smoother movement
    const PLAYER_ANIM_FRAMES = 8;
    const ENEMY_ANIM_FRAMES = 8;
    const GOLD_ANIM_SPEED = 0.15;
    const TRAP_PULSE_SPEED = 0.3;

    // Gameplay constants
    const ENEMY_COLLISION_RADIUS = 0.6;
    const TRAPPED_ENEMY_RADIUS = 0.8;
    const GOLD_PICKUP_CHANCE = 0.05;
    const GOLD_DROP_CHANCE = 0.02;   // chance to randomly drop gold while carrying
    const GOLD_PICKUP_COOLDOWN = 30; // frames
    const DEATH_DELAY_FRAMES = 45;   // ~1500ms at 30fps
    const LEVEL_COMPLETE_DELAY_FRAMES = 60; // ~2000ms at 30fps

    // Hole/Trap timing constants (30fps - original Apple II ~60fps scaled)
    // Original Apple II: ~5 seconds at 60fps = 300 frames, ~7 seconds at 60fps = 420 frames
    // At 30fps: 150 frames (~5 seconds), 210 frames (~7 seconds)
    const ENEMY_TRAPPED_TIME = 150;     // time enemy stays trapped in hole (~5 seconds)
    const ENEMY_TRAPPED_ESCAPE = 60;    // frames remaining when enemy starts escape attempt (~2 seconds)
    const HOLE_FILL_TIME = 210;         // time until hole fills (~7 seconds - original Apple II)

    // Movement speed constants
    const PLAYER_SPEED = 0.14;
    const ROPE_SPEED_MULTIPLIER = 1.15; // Rope movement is ~15% faster (speedrun exploit)

    // Game states
    const STATE = {
        TITLE: 0,
        PLAYING: 1,
        PAUSED: 2,
        DYING: 3,
        LEVEL_COMPLETE: 4,
        GAME_OVER: 5,
        STUCK: 6,
        EDITOR: 7
    };

    // ============================================
    // ORIGINAL LODE RUNNER LEVELS (1983)
    // Apple II disk image data - 150 levels
    // ============================================

    const LEVELS = [
        // Level 001
        [
            "..................-.........",
            "....$.............-.........",
            "#######H#######...-.........",
            ".......H-----------....$....",
            ".......H....##H...#######H##",
            ".......H....##H..........H..",
            ".....E.H....##H.......$E.H..",
            "##H#####....########H#######",
            "..H.................H.......",
            "..H...........E.....H.......",
            "#########H##########H.......",
            ".........H..........H.......",
            ".......$.H----------H...$...",
            "....H######.........#######H",
            "....H.........P..$.........H",
            "############################"
        ],
        // Level 002
        [
            "...$.......................H",
            "H@@#@@H...........$........H",
            "H.....H....H#########H.$...H",
            "H.$.E.H....H.........H####TH",
            "H#@#@#H....H.........H.....-",
            "H.....H----H------..EH.....-",
            "H.....H....H.....H###@@@@@@H",
            "H.....H....H..$..H.........H",
            "H...E.H.$..H#####H.........H",
            "@###@##@##@H.........H###H##",
            "@###@......H.........H...H..",
            "@$..@......H...------H...H.$",
            "########H###@@@@.....H..####",
            "........H............H......",
            "........H...P........H......",
            "############################"
        ],
        // Level 003
        [
            "...........................-",
            "----------....$............-",
            "H.$......H##########H......-",
            "#####H...H..........H@@@@@@@",
            ".....H.E.H.....$....H.......",
            ".....H######H#####H##.......",
            "..$..H......H.....H..--.....",
            "####H#......H..E..H....--...",
            "....H....H######H##......--$",
            "....H----H......H..E.......#",
            "....H.......H#########H.....",
            "....H.......H#########H.....",
            "###H##########...$...#####H#",
            "###H##########.H###H.#####H#",
            "...H......P....H###H...$..H.",
            "############################"
        ],
        // Level 004
        [
            "-...........................",
            "------------................",
            "H.....H.....#.$.#.....H.....",
            "H.$..HHH..$.#####.$..HHH..$.",
            "H.HH..H..HH.......HH..H..HH.",
            "H.H.HHHHH.H.......H.HHHHH.H.",
            "H.H..$E$..H...H...H..$E$..H.",
            "H..H#####H...HHH...H#####H..",
            "H...HHHHH.HH..H..HH.HHHHH...",
            "H.........H.HHHHH.H.........",
            "H....$....H..$E$..H.....$...",
            "H######H...H#####H..H#######",
            "H......H....HHHHH...H.......",
            "H......H............H.......",
            "H......H.......$..P.H.......",
            "############################"
        ],
        // Level 005
        [
            ".........-..................",
            ".........-.......$......E...",
            "###......-......####H#######",
            "..##.....-.....##...H.......",
            "...##....-....##....H.......",
            "$E.###...-..$###....H...$...",
            "##H####..-..####H###H#######",
            "..H...##.-.##...H...........",
            "..H$E..##H##....H.....$.....",
            "H###H....H.....#H##H###.....",
            "H...H..............H........",
            "H...H....$.....E...H........",
            "H...H#######H######H#####H##",
            "H...........H............H..",
            "H...........H..P.........H..",
            "############################"
        ],
        // Level 006
        [
            "##################-#########",
            "#.$...............-#.E.$...#",
            "#T###H####H...$...-#######H#",
            "#T###H##############.###..H#",
            "#....H..$.E.....####.###..H#",
            "#H#########H########.###..H#",
            "#H...######H#####$$#.###$.H#",
            "#H...######H##############H#",
            "#H...#....$H....$..E...$.#H#",
            "#H...###H#######H#######H#H#",
            "#H..$###H.......H#######H#H#",
            "#H##T#..H....P..H..##...H#H#",
            "#H##T#H#####H########$$.H#H#",
            "#H##T#H#####H######$######H#",
            "#HE...H##$##H....$..E.....H#",
            "############################"
        ],
        // Level 007
        [
            "..-.........................",
            "..-.................--------",
            "..-..........E......H......H",
            "#####H#....#H###...EH....$.H",
            ".....H......H....###H#######",
            "..E..H...$..H.......H.......",
            "#####H####..H.......H.......",
            ".....H......H.......H.......",
            "..$..H...$..H.......H.......",
            "##H############H....H.####.H",
            "..H............H.$..H.####.H",
            "..H..$.........H----H.#.$#.H",
            "#######H............H.#####H",
            ".......H............H......H",
            ".......H.P........$.H..E...H",
            "############################"
        ],
        // Level 008
        [
            "...........-....-...........",
            "...........-....-...........",
            "...$.E...H#-....-#H...E.$...",
            "H#####H--H#-....-#H--H#####H",
            "H#...#H...#-....-#...H#...#H",
            "H#...#H...#-....-#...H#...#H",
            "H#.$.#H...#-....-#...H#.$.#H",
            "H#####H...#-....-#...H#####H",
            "H#...#H...#-....-#...H#...#H",
            "H#...#H---#H####H#---H#...#H",
            "H#...#...H#H....H#H...#...#H",
            "H#E$.#...H#H..$EH#H...#.$E#H",
            "H##T##...H#@@@@@@#H...##T##H",
            "H.....T..H........H..T.....H",
            "H......TEH....P...H.T......H",
            "############################"
        ],
        // Level 009
        [
            "-...........................",
            "----------------------------",
            "H#.E...#.............#.....#",
            "H.#####...............#####.",
            "H.#.###...............#$###.",
            "H.#####.E....E......E.#####.",
            "H.###.#T#################.#.",
            "H.#####T###.$##.$########H#.",
            "H.#####T#################H#.",
            "H.#####T#################H#.",
            "H.#####T####....#########H#.",
            "H.#####T####....#########H#.",
            "H.#####T####...$H########H#.",
            "H...........####H--------H..",
            "H..........@@@@.............",
            "H......P..@@@@......E......."
        ],
        // Level 010
        [
            "..........$..............-..",
            "........H#######..$......-..",
            "....$...H......######....-..",
            "##########H.........$....-..",
            "..........H######-#####H##..",
            "E.........H......-.....H....",
            "##########H......-.E...H...$",
            "##########H#######@@...H####",
            "##########H............H....",
            "##########H.......$.---H....",
            "##......##H.......##...H....",
            "##..$$..##H.....$......H....",
            "###########H#######H...H....",
            "...........H.......########H",
            "....$....P.H...............H",
            "############################"
        ],
        // Level 011
        [
            ".......H....................",
            ".E$....H.................$E.",
            "H##E$..H...............$E##H",
            "H..##..H####-H#####H...##..H",
            "H...........HH$....H.......H",
            "H...........$HH....H.......H",
            "H...........HH$............H",
            "H...........$HH............H",
            "H...........HH$............H",
            "H...........$HH............H",
            "H...........HH$............H",
            "H...........$HH............H",
            "H...........HH$............H",
            "H...........$HH............H",
            "H.......P...HH$............H",
            "H....H################H....H"
        ],
        // Level 012
        [
            "......$.....$...........H...",
            "H#################H.....H...",
            "H.............$...H-----H..$",
            "#########H#########.....H###",
            "########HH..............H...",
            "#######HH-------H.......H...",
            "#$.$##HH......E.H..$..E.H..$",
            "#####HH.....H####@@@####H###",
            ".....H......H...........H...",
            ".....H......H...........H...",
            "....EH...$..H-----------H..$",
            "H###########H..$.....$..H###",
            "H...........H.#########.H...",
            "H...........H...........H...",
            "H......$....H....P.$....H...",
            "############################"
        ],
        // Level 013
        [
            "............E..........E....",
            "THTHTHTHTHTHTHTHTHTHTHTHTHT-",
            "THTHTHTHTHTHTHTHTHTHTHTHTHT-",
            "$H#H.H#H$H#H.H#H$H#H.H#H$H#-",
            "TH#HTH#HTH#HTH#HTH#HTH#HTH#-",
            "TH#HTH#HTH#HTH#HTH#HTH#HTH#-",
            "TH#HTH#HTH#HTH#HTH#HTH#HTH#-",
            ".H#H$H#H.H#H$H#H.H#H$H#H.H#-",
            "TH#HTH#HTH#HTH#HTH#HTH#HTH#-",
            "TH#HTH#HTH#HTH#HTH#HTH#HTH#-",
            "$H.H.H.H.H.H.H.H.H.H.H.H.H#-",
            "H##########################-",
            "H.........$.E.$...$.E......-",
            "H@@@@@@@@@@@@@@@@@@@@@@@@@@-",
            "H$.......P................$-",
            "############################"
        ],
        // Level 014
        [
            "..H...E....-...E-H....H-...$",
            ".-H...-H-...-..-.H-...H.-..H",
            "-.H..-.H.-....-..H.-..H..-.H",
            "$.H.-..H..-..-...H..-$H...-H",
            "..H-..-H...--....H$..-H....H",
            "H-...-.H-..--..-.H------.-..",
            "H.-...-H..-$.-...H..-...H.-.",
            "H-.-...H$--H..-..H.....-H..-",
            "H.-.-..H--.H...-.H....-.H..-",
            "H-.$.-EH-..H.-..-H-..-..H..-",
            "H.-H..-....H...-...-....H..-",
            "H-.H...-...H..-.-...-...H..-",
            "H.-H.-..-..H$-...-...-..H.$-",
            "H-.H...-.-.H-.-..$-...-.H.-.",
            "H.-H..-...-H.....-.-.-.-H-..",
            "...H.....$.....$P.......H..."
        ],
        // Level 015
        [
            "-..........................-",
            "-.....$.E..$.....$..E.$....-",
            "----########H...H########---",
            "............H...H...........",
            ".......H#############H......",
            "$..E..$H.....$.$.....H$.E..$",
            "#######H.$.$#####$.$.H######",
            ".......H.####...####.H......",
            "....$..H......$......H.$....",
            "..H######################H..",
            "..H...........P..........H..",
            "..H.$....$H#######H$...$.H..",
            "##########H.......H#########",
            "..........H.......H.........",
            "..$.......H.......H......$..",
            "#@#@#@#@#@#@#@#@#@#@#@#@#@#@"
        ],
        // Level 016
        [
            ".........................-..",
            "....................P.....-.",
            "...T####HH######HHHHH......-",
            ".........H...#..H.........-.",
            "....$.....H.H#..H........-..",
            "....#$.....HH#..H.......-...",
            "...###$.....H#..H......-....",
            "..#####$....H#..H.....-.....",
            "########....H#..H......-....",
            ".$#####.....H#..H.......-...",
            "...###......H#..H........-..",
            "....#.......H#..H.........-.",
            ".......E....H#..H...E......-",
            ".H##############T#########.-",
            ".###############.........H#-",
            "################...$$$$$$H##"
        ],
        // Level 017
        [
            "-..........................-",
            "-..........................-",
            "-.........E................-",
            "H###T######################H",
            "H###T######################H",
            "H...$...##--------##.......H",
            "H.......$#H....E.$##....E..H",
            "H..###..##H.########..#####H",
            "H..#$#..##H.......##..##$##H",
            "H...P...##H.......##..#####H",
            "H..###..########HH##..##$##H",
            "H..###..########HH##..#####H",
            "H..###..##......H.##.......H",
            "H..###..##.....$H.##....$..H",
            "##########H#########H#######",
            "#######..$H######.$.H#######"
        ],
        // Level 018
        [
            "...-........................",
            "...-......$.........$......$",
            "HT#H....H###H.....H###H#..#H",
            "H..######...H#####H...H..$.H",
            "H$.E........H.....H...####.H",
            "HT####.........###H#.......H",
            "H.@####.......##........H#.H",
            "H.@#####.....##.......H#H..H",
            "H.@###########....$...H...##",
            "H.@###########...###..H.....",
            "H.@....###.###........H...E$",
            "H.@..$.##.$.##.....E..H...##",
            "H.@H###########H######H...##",
            "H..H...........H......H...##",
            "H..H.......P..........H...##",
            "############################"
        ],
        // Level 019
        [
            "............H##H............",
            "..........E$H##H$E..........",
            "..........H######H..........",
            ".........$H######H$.........",
            "........H##########H........",
            "......E$H##########H$E......",
            "......H##############H......",
            ".....$H...$$$$$$$$...H$.....",
            "....H##################H....",
            "...$H##################H$...",
            "..H######################H..",
            "..H######################H..",
            "..H......................H..",
            "..H......................H..",
            "..H..........P...........H..",
            "############################"
        ],
        // Level 020
        [
            ".............E$.............",
            "...........########H...E.$..",
            ".......E.$.........H#H#####H",
            ".....$#####H.......H.H.....H",
            "###T###....H-------H.H$....H",
            "...........H.......H.#######",
            ".$.........H.......H........",
            "###H#######H.......H--------",
            "$..H...E...H....$..H.......$",
            "#########..########H....####",
            ".......$...$.......H........",
            "#####H###T###H..$..H...$....",
            ".....H.......##############H",
            ".....H.....................H",
            ".....H.$...P......$........H",
            "############################"
        ],
        // Level 021
        [
            "@@@@@@@@@@@@@@@@@@@@@@@@@@-#",
            "H----------------------H---#",
            "H..H.....##..E...$.....H-$.#",
            "H..H.#####################H#",
            "H..H.###............$.....H#",
            "H..H...#.###################",
            "H..H..H#...$..#.$.#.$.#.$..#",
            "H..H..H##H##################",
            "H..H--H..H#####.#####......#",
            "H..H..H..H....#.$#.....E...#",
            "H..H..H..H--H.####H--#######",
            "H..H..H..H..H.....H..#######",
            "H..H..H..H..H--H..H..#######",
            "H..H..H..H..H..H.#H###.$$$.#",
            "H..HP.H..H.EH..H..H###H#####",
            "##################H.$$H#####"
        ],
        // Level 022
        [
            ".......$....$...............",
            "$$################H.........",
            "##..........$..$..H.........",
            ".........H########H..$...$..",
            ".........H........H########.",
            "....$.E$.H..................",
            "...H######H------.....$.....",
            "...H......H......H#########H",
            ".$.H......H......H.........H",
            "###H....E.H..E.$.H.......$.H",
            "......H###H######H....H#####",
            "......H--------....$..H.....",
            "....$.H$.......H######H...$.",
            "#######H.......H......H#####",
            ".......H.......H............",
            ".......H..$..P.H......$....."
        ],
        // Level 023
        [
            "...@@@@@@@@@...........-....",
            "..@.........@..........-.@@.",
            ".@...$$.E....#H........-.@@.",
            "@@##H########@@H....E..-$@@.",
            "@###H###########H##@@@#H@@@@",
            "@##HHH#-------#HHH#----H---H",
            "@##H.H#..$....#H.H#.$....$.H",
            "@##H.H#..P....#H.H#........H",
            "@##H$H####H####H$H#@......@H",
            "@#########H################H",
            "@......##HHH##..$....$...$.H",
            "@------#HH.HH--------------H",
            "@.$....#H...H............E.H",
            "@.......H...H..###########.H",
            "@@@@....H...H.###.$##..$.##H",
            "@######@H$.$H..#############"
        ],
        // Level 024
        [
            "................-...........",
            "...............--...........",
            "..............--............",
            ".............--.............",
            "............--..............",
            "............-...............",
            "..........H##H..............",
            "..........H##H$.............",
            ".......H#######H..E.........",
            ".#H..E.H#.$.$.#H.#H#H.......",
            "..###H############H###H.....",
            "...##.$..####.$...H$..##H...",
            "....####H..$.###H.H##H.#H...",
            ".....#$#H###H.$.H.H$#H$#H...",
            "..E...##################H.P.",
            "@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
        ],
        // Level 025
        [
            "....@.....@.....@.........-@",
            "....@.....@.....@...$.....-@",
            "....@T####@.....@####..###-@",
            "###.........###HE..$.....$-@",
            "###########H...H########.#H@",
            ".......P...H.##H#...$....#H@",
            "#H#########H.$#H#.#####H.#H@",
            "#--------##H.##H#.#....H.#H@",
            "#..#..#.$##H...HH.#.###H.#H@",
            "#..#..#..#HH####H##$###H.#H@",
            "#..#.$#..#H#......#.###H..H@",
            "#..####..#H#.####.#....H#HH@",
            "#H##..##HHH#.#$##.#######H.@",
            "#H...@@#HH##...#..##$....H#@",
            "#H...@...H##T####T#######H#@",
            "#H###....H.....E.........H.@"
        ],
        // Level 026
        [
            "..........................-.",
            ".....E....................-.",
            "H##########H..E..$.....$..-.",
            "H..........H#####H...###H###",
            "H.$......$.H....@H......H...",
            "H.#..###.#.H.$$.@H....E.H...",
            "H.#.###..#.H.@@.@#########@@",
            "H.#..###.#.H.@@...........@$",
            "H.#.###..#.H.@-------..$..@H",
            "H.#$.###.#.H.@$......####H@H",
            "H.#####..#.H.@@..........H.H",
            "H.########.H.@@....$.....H##",
            "H..........H.@@.######...H..",
            "H@@@@@@@@#@@@@@..........H..",
            "H.............P..........H..",
            "############################"
        ],
        // Level 027
        [
            "-..........................-",
            "-......P............E......-",
            "-...@#H#@----------@#H#@...-",
            "-...@$H.@.$......$.@.H.@...-",
            "-.@##.H.##@......@##.H$##@.-",
            "--@$..H..$@.$...$@.$.H.#$@--",
            "@-###.H...##@..@#####H.#.#-@",
            "@.....H.....@.$@$....H.#..$@",
            "@.....H#####@H#@##..$H.##.#@",
            "@.$.E.H...E..H.....##H.....@",
            "@H####H...@##H###@...H...#H@",
            ".H@.$.H...#..H.$.#...H..E@H.",
            ".H@##.H.###..H...###.H.##@H.",
            ".H.$@.H.@....H....$@.H.@$.H.",
            ".H...###.....H......###...H.",
            "############################"
        ],
        // Level 028
        [
            ".............-..............",
            "-----------..-..............",
            "..$....$.@H..-.$............",
            "#########@@@@@@@H..$H@H.....",
            "#@#@#@#@@@@@...@@@@@@@H.....",
            "..........@@..$......@H.E$..",
            "--------H.@@#####H...@@####H",
            "........H.@@.....HE....####H",
            "........H.@@.########H.####H",
            ".$....$.H.@@.#......#H.####H",
            "###E..#.H.@@.#...$..#H.##$#H",
            "#######.H.@@.########H.##.#H",
            "........H....#..$...#H....#H",
            "##############.H##H.#######H",
            "..........P....H.$H........H",
            "############################"
        ],
        // Level 029
        [
            "..E.--.-.............E......",
            "####..H...-.........##H.....",
            "####..H.##.-...E...-##H.....",
            "#$$#..H.##-.#######..-H.....",
            "####..H.....#######.H.H###..",
            "......H---..#######.H..#$#..",
            "....-.....H.#######.H..###..",
            ".....####.H.##$$$##.H.......",
            "...-.####.H.#######.H.......",
            "###-.#$$#.H-.....-.-H.......",
            "#$#..####.H.-...-.H..####...",
            "###.......H...P...H..####...",
            "..........H..###..H..#$$#...",
            "...##.....H..#$#..H..####...",
            "...##.....H..#T#..H.........",
            "..........H.......H........."
        ],
        // Level 030
        [
            "@..........................-",
            "@.....$$$$E.E.E......P.....-",
            "@##########T###############H",
            "...........................H",
            "....@.$..$.......$......$@.H",
            "....@#######T#######T####@.H",
            "...........................H",
            "......@..$....$.....$..@...H",
            "......@###T######T#####@...H",
            "...........................H",
            ".......@..$.....$....$@....H",
            "......@@##############@....H",
            "...........................H",
            "...........................H",
            "$$$$...E..........E.....H@.H",
            "##########@@@@@@#######@@@.H"
        ],
        // Level 031
        [
            ".............-..............",
            ".............-..............",
            "$............--............$",
            "#H.H--------------------H.H#",
            "##HH.E................$.HH##",
            "###H.H------.---------H.H###",
            "####HH.$..............HH####",
            "####TH.H------.-----HEHT####",
            "####T#HH..........$.HH#T####",
            "####T##H.H---.----H.H##T####",
            "####T###HH.$......HH###T####",
            "####T####H.H--.-H.H####T####",
            "####T#####HH....HH#####T####",
            "####T######H....H######T####",
            "####T#######HP$H#######T####",
            "####E.......H##H........####"
        ],
        // Level 032
        [
            "............................",
            "###-####.........------.E...",
            "...-.--..E............@@@@@H",
            "...H#..#####H######---...#.H",
            "H####..#$---H-----#...####H#",
            "H......####...###H#...#$..H.",
            "H......#----H----H#...#-..H.",
            "H.P#...#H$#$H$#H$H#...#...H$",
            "#H##...############...##H###",
            ".H....$#.....$....#.....H...",
            ".H....##...###H...#.....H...",
            ".H..$#.#......H...#$..H#####",
            ".H..#..#...$..H...##..H.....",
            ".H$#...#.H######H.#.#$H.....",
            ".H#..$.#.H#..$.#H....#H.....",
            "############################"
        ],
        // Level 033
        [
            "#####-#################.####",
            "....#-#.-------............#",
            "-##-.-#.#$...#H#.........E.#",
            "-.#####.######H#####$.#H####",
            "#-....$---####H########H#.##",
            "#######...#..#H###.####H#.##",
            ".......E.....#H###.##.#H#$.#",
            "H#######H#H$.#H###.##.#H####",
            "H.......H#####H###$.#.#H##.#",
            "H.........####H######.#H##$#",
            "H.......#.....H........H...#",
            "H###H####H#@#@#@#@#@#@#H#@#@",
            "H###H####H######..#####H#@#@",
            "H...H....H#######..####H....",
            "H########H########$.#######H",
            "HP.......H.$.######..E.....H"
        ],
        // Level 034
        [
            ".--------$$######$$--------.",
            "H.......$###HHHH###$.......H",
            "H......$##HHHEEHHH##$......H",
            "H......##HH......HH##......H",
            "H.....$#HH........HH#$.....H",
            "H.....##H$........$H##.....H",
            "H.....#HH$........$HH#.....H",
            "H.....#H$$........$$H#.....H",
            "H.....#HH$........$HH#.....H",
            "H.....##H$........$H##.....H",
            "H......#HH$......$HH#......H",
            "H......#THH$$..$$HHT#......H",
            "H.......T#HHH$$HHH#T.......H",
            "H........###HHHH###........H",
            "HP......E..######..E.......H",
            "#########H........H#########"
        ],
        // Level 035
        [
            "-............##............-",
            "-............@@............-",
            "-.$.......$..##..$.......$.-",
            "@#@#@#@#@#@#H@@H#@#@#@#@#@#@",
            "...$.....$..H##H..$.....$...",
            "H@#@#@#@#@#@#@@#@#@#@#@#@#@H",
            "H...$...$....##....$...$...H",
            "@#@#@#@#@#@#H@@H#@#@#@#@#@#@",
            "....$E.E$...H##H...$E.E$....",
            "H@#@#@#@#@#@#@@#@#@#@#@#@#@H",
            "H..$.....$...##...$.....$..H",
            "@#@#@#@#@#@#H@@H#@#@#@#@#@#@",
            "..$.......$.H##H.$.......$..",
            "H@#@#@#@#@#@#@@#@#@#@#@#@#@H",
            "H............P.............H",
            "#@#@#@#@#@#@#@#@#@#@#@#@#@#@"
        ],
        // Level 036
        [
            "....$....$.....$.......E$...",
            "H######H###.#####H###.#####H",
            "H......H.........H.........H",
            ".H......H..-....H.........H.",
            "H......H..-.-....H.........H",
            ".H......H-...-..H.--------H.",
            "H------H......-..H.........H",
            "....E...H-.....-H.........H.",
            "######.H..-...-..H....E$.$.H",
            "##.###..H..-.-..H....-###@@@",
            ".$...$.H....-....H...-###@@@",
            "##T###..H..-.-..H....-###@@@",
            "##T#.#.H..-...-..H...-##$$@@",
            "..$.$...H-.....-H....-@@@@@@",
            "######.H....$.P..H.$..@@@@@@",
            "############################"
        ],
        // Level 037
        [
            "-...........................",
            "-......E....................",
            "-##########@@@@@@#@@@@#@@@@H",
            "$.....................H....H",
            "##.........@...$....$---$..H",
            "#####HH#HH########..#...#..H",
            "....#HH.HH#.@@####.....E...H",
            "....#HH$HH#.@.####.###H####H",
            "....#######.@$###.....H....H",
            "......................H....H",
            ".......P.......#H#####H@@@@H",
            "##H########H###.H.$$..H....H",
            "..H........H....H.@@.....##H",
            "..H##$#....H..###.@@######.H",
            "..H####...EH...$..@@.......H",
            "##################@@####@@@@"
        ],
        // Level 038
        [
            "-..........................-",
            "-..........................-",
            "######H####HE.EH####H#######",
            ".-....H....H@H@H....H.....-.",
            "H.#####......H...$..######.H",
            "H.#####..#HHHHHHH#..######.H",
            "H.###$#..#H@@@@@H#..##$###.H",
            "H.#####..#HHHHHHH#..######.H",
            "H.........-------..........H",
            "H.E...H......@......H....E.H",
            "H@@@@@H....$@@@$....H@@@@@@H",
            "H.....H....@@@@@....H......H",
            "H#####H...@@@@@@@...H######H",
            "H.....H.$@@@@@@@@@$.H......H",
            "H@@@@@H.@@@@@@@@@@@.H@@@@@@H",
            "$.....H@@@@@@@@@@@@@H..P...$"
        ],
        // Level 039
        [
            "###..-.##....##....##.-..###",
            "####.-####.E####.E####-.####",
            "H..##H#..##H#..#H##..#H##..H",
            "H...#H--H.#H...$H#.H--H#...H",
            "H.E####$H####HH####H$####.PH",
            "H###..##H#..#H##..#H##..###H",
            "H##....#H$...H#...$H#....##H",
            "H###..####HH####HH####..###H",
            "H..##H#..##H#..#H##..#H##..H",
            "H...#H....#H...$H#....H#...H",
            "H..####HH####HH####HH####..H",
            "H###..##H#..#H##..#H##..###H",
            "H##....#H....H#....H#....##H",
            "H###..####HH####HH####..###H",
            "H....$....HH.$..HH....$....H",
            "H##########################H"
        ],
        // Level 040
        [
            "-..........#################",
            "-..........########@.------#",
            "-....$...H#....$...@H.#.$..#",
            "#########H@#######.@H.######",
            "....$....H@....$...@H.######",
            "H#########@.##T###.@H.######",
            "H....E$...@......$.@H...E...",
            "#########H@.##TTT#.########H",
            ".$.......H@....$...........H",
            "H#########@.##T###.........H",
            "H..$......@......$.........H",
            "#########H@.##TTT#..#####..H",
            "........$H@......$..#..$#..H",
            "H#########@.##T###....H##..H",
            "H...E.......P.........H#.$.H",
            "############################"
        ],
        // Level 041
        [
            "....--$.--------E-----.-----",
            "...H.$#$........H-.#.-H..$$$",
            "$PH.$#.#$......H-.###.-H..$$",
            "##.$#...#$....H-.#...#.-H..$",
            ".E.T..#..#...H-.##...##.-H.E",
            "H##..###..@@@-...#$$$#...-#H",
            "H...#...#...$...HH###......H",
            "H..-.###...$H..H##H#.......H",
            "H...-.#...$H...H$$H.-------H",
            "H....-...$H...H@@@@H.......H",
            "@@@H..---H....H$..$H.------H",
            "...H.........H######H......H",
            "###H###H.....H$....$H.-----H",
            ".......H....H@@@@@@@@H.....H",
            ".......H..E.H$...E..$H.----H",
            "########@@@@@########H.....H"
        ],
        // Level 042
        [
            "..$.......$..........$....$.",
            "H###....H###....H##########H",
            "H.$...$.H.....$.H.$....$...H",
            "H###H###H...#####@##@####@##",
            "H...H..EH...---------------.",
            "####H######H......$...$E...H",
            "....H......H.@####@@@@@@###H",
            "....H@@@@@.H.@......$..$...H",
            "#...H..$.@.H.@...@@@@@@@@@.H",
            "#$$@@@###@.H.@...@..$.$..@.H",
            "###@@@###@.H.@.$.@.H####H@.H",
            "..$..$.....H.@@T@@.H....H@.H",
            "#########..H.@.....H...EH@.H",
            "..$.$...@..H.@########@@@@.H",
            "######H.@@@@####@...$..$..PH",
            "####$#H...........H#########"
        ],
        // Level 043
        [
            "............................",
            "..-.......................-.",
            "..H#######################H.",
            "..H.H##...$...$.E.$...##H.H.",
            "..H###H###############H###H.",
            "..H.H.H.###.$...$E##H.H.H.H.",
            "..##H###H.H#######H.H###H##.",
            "..H.H.H.H.H.H###H.H.H.H.H.H.",
            "..H###H###H.H.$.H.H###H###H.",
            "$.H.H.H.H.HEH@@@HEH.H.H.H.H$",
            "####H###H$H@H@@@H@H$H###H###",
            "##H.H.H.H@H@H@@@H@H@H.H.H.H#",
            "##H##.H@H@H@H@@@H@H@H@H.##H#",
            "##H.H@H@H@H@H@@@H@H@H@H@H.H#",
            "##H@H.H.H.H.H..PH.H.H.H.H@H#",
            "############H#$#H###########"
        ],
        // Level 044
        [
            "###########################-",
            "#...HHHHHHHHHHHHHHHHHHH...#-",
            "#.P.H.HHH....H...HH...H.E.#-",
            "####H.HHH.HH.H.HH.H.HHH####-",
            "#...H.HHH.HH.H.HH.H...H...#-",
            "#.E.H.HHH.HH.H.HH.H.HHH.E.#-",
            "####H...H....H...HH...H####-",
            "HHHHHHHHHHHHHHHHHHHHHHHHHHH-",
            "H.$.H.$.H.$..H..$.H.$.H.$.H-",
            "HHHHHHHHHHHHHHHHHHHHHHHHHHH-",
            "H...H.H.H.HH.H.HH.H...H...H-",
            "H.H.H.H.H..H.H..H.H.HHH.H.H-",
            "H..HH.H.H.H..H.H..H...H..HH-",
            "H.H.H.H.H.HH.H.HH.H.HHH.H.H-",
            "H.H.H...H.HH.H.HH.H...H.H.H-",
            "HHHHHHHHHHHHHHHHHHHHHHHHHHH-"
        ],
        // Level 045
        [
            "@@@@@@@@@@@@@@@..-.@@@@@@@@@",
            "..EH......H---...-.H......$.",
            "@@@-##@@@@@#T#@@@-.H@@@@.H@#",
            "@--H.......H----H..H...#####",
            "@..H.......$.#$#HE.H..$...##",
            "$.TH.......H....@#H.@@####@#",
            "@#TH-------H-----@H-------H@",
            "#$.@.......H...$H@@@......H#",
            "@@T#....$$$H....H@----..$.HH",
            "@..........H....H@H.$...T#@H",
            "###T##.....H.P..H@H........H",
            "#H----.H@###@##T@@H........H",
            "#H$...#H........H#H..@####.H",
            "#H@--###H.......H@H..#.$.@.H",
            "#H..###@#H..E...H.H...#@@#@@",
            "@#####@@@@##############@###"
        ],
        // Level 046
        [
            ".$...................-......",
            "####H............E...-......",
            "..$.H..........H######H...$.",
            "########H######H.....#######",
            "........H......H.$........$.",
            ".....$..H......H############",
            "#H######H...$..H............",
            ".H...$..H@@@@@@H......$.....",
            "#H######H......#####H######H",
            "........H.E....$....H......H",
            ".$......H###H#######@@@@@@@@",
            "###H#####...H..$......$.E...",
            "...H.......H########H#######",
            "...H-------H........H.......",
            "...H.........P......H.....$.",
            "#######################-####"
        ],
        // Level 047
        [
            "@...............@@@@@@@@@@@-",
            "@E........E.....@..$.@.....-",
            "@@------#####H.P@.H@.@H@###-",
            "@#####...$..###@@.H@.@H@###-",
            "@....######.......H@.@H@...-",
            "###H......####H.$.H@.@H@.$.-",
            "#.###@#H......H###@@.@H@###-",
            "#..$..##@#H...H....@.@H@###-",
            "#####....###@#H....@.@H@...-",
            "#.$.#@H#.....##@##H@.@H@$$.-",
            "###...H##@@#..$..@H@.@H@###-",
            "#.#@##H....###@@#@H@.@H@###-",
            "#...###@##H..$...@H@.@H@.##-",
            "#.H##...$###@@#H#@H@.@H@..#-",
            "#.H#...........H.$H@..H...$-",
            "#$H#@####@#####@##@@##@#####"
        ],
        // Level 048
        [
            "............$...............",
            ".-------.####HP.............",
            "H..........$.H....$......$..",
            "H........H@@@@.#######H#####",
            "H........H.$..........H.....",
            "H######H.####H........H.....",
            "H......H...$.HEH###########H",
            "H......H.H@@@@.H@@@@@@@@@@@H",
            "H....$H#.H$....H@.....$...@H",
            "H....H#..####H.H@H@@@@@@@H@H",
            "H..$H#......$H.H@H@...$..H@H",
            "H..H#....H@@@@.H@H@@@@@@@@@H",
            "H.H#.....H.$...H@H....$....H",
            "HH#......####H.H@@@@@@@@@@@@",
            "HH..E........-.H....E.......",
            "############################"
        ],
        // Level 049
        [
            ".....-.....-.-......-..$..$.",
            "-...-.-...-.H.-....-.H######",
            ".-.-...-.-..H..-..-..H......",
            "..-.....-...H...--...H..E...",
            ".$...$..$...H...-....H@@@@@H",
            "@@@@@@@T@@@@@@H-.....H@.$.@H",
            "..............@......H@H@$@H",
            ".............$@..P.$.H@H@$@H",
            "H##########H#@@H####-H@H@$@H",
            "H.....E....H##HH.....H@H@$@H",
            "H....##....H##H...$E..@H@$@H",
            "H.###..###.H##@@#####H@H----",
            "H.###..###.H##.......H......",
            "H.###$$###.H#.....--$H.####.",
            "H.$.$##$.$.H##..H#..#H##$$##",
            "############################"
        ],
        // Level 050
        [
            "H...-..................H----",
            "H....H.................H.@..",
            "H....H.............E...H.@$$",
            "H.$..H####..$..$H#####T#H###",
            "H##..H...#########......HH#T",
            "H....H...................HHT",
            "H.....H-------------------HH",
            "H.....H....................H",
            "H.....H.$.......E...$.....$H",
            "H.....#####H@@@@@@@@@@##T###",
            "H---.......H..........---...",
            "...E$......H.........H......",
            "#########H.H...$.....H-...$.",
            "........#####H@@@H####.#$###",
            "$.......P....H...H...E.#####",
            "#############H...H##########"
        ],
        // Level 051
        [
            "#@#@@#.............-@#@@###@",
            "##@@##.............-#@@###@@",
            "...@#@#..$......$..-#@.....@",
            "H#...@##@###@H##@..-#@.#@H.@",
            "H#@..@#@@###@H.##.$-@..#@H.@",
            "H##.....@##@@H..#@###.$#@H.@",
            "H@##$....#@@#H........##@H$.",
            "H#@####...@##H..-------#@@#H",
            "H.@@#@##$..#@H.$.......#@..H",
            "H.....H##...@@#@@#@....#@..H",
            "@###@@H@##............$#@..H",
            "#@#@@@H#@##$...E....$###@..H",
            "...$..H@@###T@@@@@@T###@@H##",
            "H#@###@@...E.........P...H@#",
            "H@###@..H##@@#@@##@#@@##@@@#",
            "H...$...H............E...@#@"
        ],
        // Level 052
        [
            ".........H..................",
            ".........H......$....E......",
            "----..$..-.....@@@@@@@@@@@@H",
            "H..@@@@@@@.................H",
            "H.........-----..-----.H@@@@",
            "H---------........H....H....",
            "....E..........$..H#...H....",
            "H@@@@@@@@@@@@@@@@@@#...@@@@H",
            "H.........................HH",
            "H......$......$.....E..@..H.",
            "@@@@##@@@@H.#@@#@@@@@@@@..H.",
            "..........H...............H.",
            ".......$..H......$........H.",
            "H@@@@@@@@@@.@@@@@@@@......H.",
            "H...................------H.",
            "H..........P........E......."
        ],
        // Level 053
        [
            "............................",
            ".........E.....E........$.$-",
            "......H##############..H####",
            "......H.############..H#####",
            "H######..#$##$##$##..H######",
            "H#######...........EH#######",
            "H#############T#########....",
            "H########$.$....$.$#####.$$.",
            "H#########T###T#############",
            "H.......E..........$######..",
            "H..H#####H#####H..-H####..$H",
            "H..H..H..H..H..H...###..$H##",
            "H..H$$H$$H$$H$$H...#..$H####",
            "H..H#####H#####H....$H######",
            "H..............P...H########",
            "H###########################"
        ],
        // Level 054
        [
            "-..............#############",
            "-..$.....$.....#############",
            "##############H..$..........",
            "###########################H",
            ".....$.E...E.$.............H",
            "H###########################",
            "H........$..........$.......",
            "###########################H",
            "....$........$......$......H",
            "H###########################",
            "H...$..E.E..E.....$.........",
            "###########################H",
            "...$......$......$......$..H",
            "H###########################",
            "H.....$...........$..P......",
            "############################"
        ],
        // Level 055
        [
            "############-.##############",
            "#---------#.-..#---------#..",
            ".#$..H..$#..-...#$..H..$#...",
            "..#$.H.$#...-....#$.H.$#....",
            "...#$H$#....-.....#$H$#.....",
            "....#H#.....-@@@@@##H#......",
            ".P..#H#.....-@...$.#H#..E...",
            "###H#H######T#######H######H",
            "...H.H.E............H......H",
            "H##@#H##############H#@#####",
            "H---#H#------------#H#......",
            "H.$#.H.#$........$#.H.#.....",
            "H$#.$H$.#$......$#..H..#....",
            "H#.$#H#$.#$..H###...H...#.$.",
            "H.$##H$#HH#@H#@#..E.H..$.###",
            "#########H..H.$#############"
        ],
        // Level 056
        [
            "$$$----$$$.$$$-----------$$$",
            "###....###H###...........###",
            "###....###H###...........###",
            "###....###H###....$$$....###",
            "###....###H###....###....###",
            "###....###H###....###....###",
            "###....###H###....###....###",
            "###....###H###....###....###",
            "###....###H###....###....###",
            "###$--$###H###$--$###$--$###",
            "####$$####H####$$#####$$####",
            "##########H#################",
            ".########.H.#######.#######.",
            "..######..H..#####...#####..",
            "...E.....PH..........E......",
            "############################"
        ],
        // Level 057
        [
            "#-##########################",
            "#-------------------------.#",
            "#-#@@@#@@@#@@@#@@#@H#@---#H#",
            "#-#....$....$...$..H...$H#H#",
            "#-$H@@@@@@@@@@@@@@@@@@@@H@H#",
            "#-#H#----------------@.$H#H#",
            "#-$H#.@@@@@@@@@@@@@@@@####H#",
            "#-#H#.@.$$$$$$$$$$$$...$#$H#",
            "#-$H#.@###@@@@@@#@@@@@H###H#",
            "#-#H#.....E...........H$#$H#",
            "#-$H#@@@@@@@@@@@##@@@@H#.@H#",
            "#-#H------------------..H#H#",
            "#-#@@##@@H@@#@#@@H@@@@@@H$H#",
            "#-.E.....H.@@....H..E..$H#H#",
            "#@@@#@###@@@@H@@#@#@@##@@#H#",
            ".P...........H............H#"
        ],
        // Level 058
        [
            "#####################.....-#",
            "#.P##---.@@...$...........-#",
            "#.#@..$.H@@######HH.H#H.H.-#",
            "#.#.....H....@@#.HH$H.H.H.-#",
            "#.#H####@##$...#.HH.H.H#H.-#",
            "#.#H#......@##...HH.H.H.H.-#",
            "#$.H#...$..#@#.H#.H.H.H.H.-#",
            "##HH##T#@###@#.H#$#-##H#H.-#",
            "##H......E.....H#T#-#.H.H.-#",
            "##H##@#######@HHH.#-#.H.H.-#",
            "##H.#@#######@HH..#-#.H.HEH#",
            "#.H..@..$....@H...#-#HH###H#",
            "#.HH#@#######@H.$.#-#HE...H#",
            "#.#H#@#######@H@@@#-####..H#",
            "#.#H#.....$..@@#...-...#..H#",
            "#.$H.#@@@@@@@@@#.E.-...#####"
        ],
        // Level 059
        [
            "...--.$.........-$....$.....",
            "..H..##........H.##...##H...",
            "..H........$E..H........H..$",
            ".$H--......##.$H..E$....HH##",
            "##H..H$E.....##H..##...$.H..",
            "...$.H##.......H......##.H..",
            "..##.H-.--E$---H.........H..",
            "..$....H..##....$...$-...H$.",
            ".##....H.......##..##.H$H##.",
            "....-.$H..$...........H##...",
            "...H.##H..##...$......H.....",
            ".$.H.....$....##.$....H$....",
            "H##H....##.......##...H##...",
            "H...........................",
            "H.............P.............",
            "############################"
        ],
        // Level 060
        [
            "...............-----........",
            "..........----H.....E$..$...",
            ".....----H......E.$.#######H",
            ".---H.........$.#####..$..#H",
            "H.........P$.####...$E#T#H#H",
            "H..T#T.##.####..$.#T###.#H#H",
            "H..$.$.$..#..$.##T#..$..#H#H",
            "H.##.T#T..#.####...$###H#H#H",
            "H..$.$.$..#.#..$.#T#T.#H#H#H",
            "H..###.T#.#.#.##T#..$.#H#H#H",
            "H..$.$.$..#.#.#..$.##H#H#H#H",
            "H.#T.T##..#.#.#.#####H#H#H#H",
            "H..$.$.$..#.#.#.#...#H#H#H#H",
            "H..##T.T#.#.#.#.#.$.#H#H#H#H",
            "H........E#.#.#.#####H#H#H#H",
            "###########..........H.H.H.H"
        ],
        // Level 061
        [
            "..........-.................",
            "..........-.................",
            ".$.E.$...@H@...--------.P...",
            "H@###@@#.@H$..........####..",
            "H@.......@H@....$..........$",
            "H@----...@H@..####---......H",
            "H@......$@H@..$.........$..H",
            "H..$@###@@H@###......H####.H",
            "H@#@@....@H@......E$.H#....H",
            "H@-------$H@...########....H",
            "H@....$..@H@...$........$..H",
            "H@...@###@H@--####--..H##..H",
            "H@$......@H@........$.H....H",
            "H@##.....@H@......#####....H",
            "H.....E...H................H",
            "@###@####@@@@###@####@@##@@@"
        ],
        // Level 062
        [
            "##-####-#####-#####-#####-##",
            "#.-$E..-.....-...$.-.$...-.#",
            "#H########T####T##########H#",
            "#H#$.......E$........$...#H#",
            "#H#####T########T#######H#H#",
            "#H#..$..........$......#H#H#",
            "#H#H####T####T#####T##H#H#H#",
            "#H#H#................#H#H#H#",
            "#H#H#H#$.....E.....$.#H#H#H#",
            "#H#H#H###T##T###T#####H#H#H#",
            "#H#H#H...$........$...H#H#H#",
            "#H#H###T############T###H#H#",
            "#H#H...$.........$......H#H#",
            "#H###T####T####T######T###H#",
            "#H...E...$....P.....$..E..H#",
            "############################"
        ],
        // Level 063
        [
            "..................E.........",
            "###########################-",
            "$.E.....#.......$..#.$.....-",
            "###H#.#H#H########.#H#.##H##",
            "###H#H#H#H#..$...#.#H#.##H##",
            "###H#H#.#H#.####.#.#H#...H.H",
            "#$#H#H#H#H#H#P.#.#.#H#.####H",
            "#..H#H#H#H#H##.#.#.#H#.#H..H",
            ".H#H#H#H#H#H..$#.#.#H#.#H###",
            "H###.H#H#H######.#.#H#.#H..H",
            "H##.#H#H#H.$.....#.#H.-####H",
            "H..-#H#H##########.#H#.#H..H",
            "H##.#H#H...........#H#.#H###",
            "--#.#H##############H#.#H..H",
            ".....H......E.......H#.####H",
            "######################.E...H"
        ],
        // Level 064
        [
            "@-........................-@",
            "@-..E$$$$$$$$.$$$$$$$$$E..-@",
            "@@@@@@@@@@@@@-@@@@@@@@@@@@@@",
            "......$.$....-.....$..$.....",
            "....@H@@@@...-...@H@@@@@....",
            ".....H$.$....-....H$..$.....",
            "...@@@@@@H@..-..@@@@@@@H@...",
            "......$.$H...-.....$..$H....",
            "..@H@@@@@@@@.-.@H@@@@@@@@@..",
            "...H..$.$....-..H..$..$.....",
            ".@@@@@@@@@@H@-@@@@@@@@@@@H@.",
            "......$..$.H.-....$...$..H..",
            ".@H@@@@@@@@@@-@@@@@@@@@@@@@.",
            "..H.........................",
            "..H...$..$......P.$...$....E",
            "############################"
        ],
        // Level 065
        [
            "...................#######..",
            "----------$......E-.######..",
            "H........H#H----...-.######H",
            "H.......HT#TH.$H$...-.##..#H",
            "H-------HT#TH.###H...-.#$.#H",
            "H.......HT#THE###H....-.###H",
            "HE......HHHHH.###H.....-.##H",
            "#-----..@THT@.###H......-.#H",
            "##$..H..@THT@....H.......--H",
            "###$.H..@THT@.H--H---------H",
            "####$H..@THT@.H.............",
            "#####HE.@THT@.H------H##$###",
            ".....H..@THT@.H.....H@######",
            ".....H..@THT@.H....H@#######",
            ".....H...PH...H....H@#######",
            "############################"
        ],
        // Level 066
        [
            "#######HH----------HH#######",
            "######HH...-....-...HH######",
            "#####HH.....#EE#.....HH#####",
            "####HH....-.####.-....HH####",
            "###HH....-.######.-....HH###",
            "##HH-----.########.-----HH##",
            "#HH....-.####$$####.-....HH#",
            "HH......############......HH",
            "#HH....-.####$$####.-....HH#",
            "##HH....-.########.-....HH##",
            "###HH....-.######.-....HH###",
            "####HH....-.####.-....HH####",
            "#####HH....-....-....HH#####",
            "######HH............HH######",
            "#######HHE...P....EHH#######",
            "############################"
        ],
        // Level 067
        [
            "-...........................",
            "-....#...E.#.......E...E....",
            "-------$H#H.##H##--#--##H...",
            "H......#H.#H#.H#.$#.$#..H...",
            "H.P.....#..#.H#.H#..#...H...",
            "#####....##.H#..#..#....H...",
            "....#...$#.H#.$#..#.---.H...",
            "...#....#.HHH.#....#..#####H",
            ".$#...$#..#HH#..##..T......H",
            "##....#.$#.H#..#..#..#.....H",
            "#...$#..#.H#..#....#..#$...H",
            "....#.$#.H#.$#..H#..#$.#...H",
            "..$#..#.H#..#...H.#..#..#..H",
            "..#.$#.H#..#....H..#$.#..#.H",
            ".#..#.HH.....$..H...#.....#H",
            "......H##################..H"
        ],
        // Level 068
        [
            "@@@@@@@@@@@@@@@@@@@@@@-....@",
            "@.........E...........-....@",
            "@....H#@##@@#H@.......-....@",
            "@....H......-H@#@##@@#-....@",
            "@.##@H.....H-H#.#.E#-------@",
            "@$...H...$-H-##.#.@#......$@",
            "@....H...H-H-#..#..#......E@",
            "@H...H...H-H-#.$#P.#......#@",
            "@H...H...H-@##..##.#.....$#@",
            "@H@@@@T#@@-@.....#.#.....##@",
            "@H.--------@-----#.#..$...#@",
            "@H.....$..H.....##.#....###@",
            "@H..H@T@@@H@@@#H#..#...$#..@",
            "@H..H@...@H@..#H####T#@#.$.@",
            "@H..H@...@H@$.#H........##@@",
            "@H.$H@.E.@H@#####@@###@####@"
        ],
        // Level 069
        [
            "H.E.##..........------------",
            "H#####.......##H............",
            "H#####.......##H.#@#@#@#@#@#",
            "H#####.......##H.$.$.$.$.$.$",
            "H##$##.......##H#T#T#T#T#T#T",
            "H#####.$..E..##H#T#T#T#T#T#T",
            "H##############H------------",
            "H##############H...@.@.@.@.@",
            "H..P.E.........H...#T#T#T###",
            "H########H########H.....T###",
            "H########H...#####H####HT###",
            "H########H##$..###H####HT###",
            "H########H####$..#H.E..HT###",
            ".........H######..H####HT###",
            "....$.$..H########H####HT###",
            "##################H.$$.HT###"
        ],
        // Level 070
        [
            "...........................-",
            "...........................-",
            ".....................E-$$$--",
            "..$-$-...............H$###$H",
            "$H#.#.$-............$H#####H",
            "#H....#...........$.#H##$##H",
            ".H......$-........#H-H#####H",
            ".H......#.......$.-H..$###$.",
            ".H..............#H..........",
            ".H........$......H....$$$$..",
            ".H........#...$.-H...$####$.",
            ".H............#H.....####HT.",
            ".H.........$-..H.....###HT#.",
            ".H.........#.$-H.....##HT##.",
            ".H..........$#.H.....#HT###.",
            ".H..P.......#..H.E...HT####."
        ],
        // Level 071
        [
            "....-.......................",
            "....-..............E........",
            "....-............H#####H....",
            ".$H####H#HE....$.H#...#H....",
            "#H#####H#####H##H######H###H",
            "#H....@H.$..@H.@H..@#.#H..$H",
            "#H.###@H.@#.@H.@H.$@#.#H.##H",
            "#H.$##@H...$@H.@H.#.#.#H.##H",
            "#H.###@H.#.#@H.@H.@@..#H.##H",
            "#H...$@H.@...H$#H.##$.#HE.$H",
            "#H#####H#####HT#H######H###H",
            "$H-------.$$.H..E.##.....@$H",
            "@@@H....##@@@##H@@#$.....$@H",
            "...H###$#@@@@@#H@@@@@@H@@@@H",
            "P..H#$##$$$$$$.H$.....H....H",
            "@@@@@@####@@@@@@@###########"
        ],
        // Level 072
        [
            "-...........................",
            "-......------------------###",
            "H....$E.........H..........#",
            "H##T####........H..........#",
            "H......#........H.$EH.##.$.#",
            "H.$.H..#.$...---H###H#######",
            "H###H$.#####.$..H...H.......",
            "....H##########TH...H......$",
            "H...H##..$.####TH.$#H-----##",
            "H###H##########TH###H.$.H.##",
            "H.....#---------H#$#HT##H.##",
            "H$EH..#.....$...H###H...H.##",
            "###H..#...$.##..H###H...H.##",
            "...H..#.$.##....H###H...H.##",
            "...H.P####....$.H###H..EH.##",
            "############################"
        ],
        // Level 073
        [
            "............................",
            "......-------P-.......-.....",
            "....E....-....--.....--E@...",
            "..$H$....-.....--...--.@@@..",
            ".$HHH$...-......--.--.@@@@@.",
            "$HHHHH$..-.......---.@@@@@@@",
            "HHHHHHH---..$E.$..-----HHH..",
            "...H....############....H...",
            "..$@$...#.$......$.#....H...",
            ".$@@@$..#.--------.#....H...",
            ".@@@@@..#.H......H.#....H...",
            "..@@@...#.H......H.#....H...",
            "H#####H.#$H...E..H$#....H...",
            "H.....H.############....H...",
            "H.....H..H........H.....H...",
            "H#####HH############HH#####H"
        ],
        // Level 074
        [
            ".....-......................",
            ".....-...........@@@@@@@@@@@",
            "@@@@@-@@@@@H----H..........@",
            "@....-.....H.P..H...E......@",
            "#####H######################",
            "##H..H..H###....####......##",
            "#HH#####H###.##.############",
            "#H######.H##.$#.###.##..##.#",
            "#H#.###.#H##.##.###.$###.$.#",
            "#H##.$.##H##....###.##.$##.#",
            "#H#######H#########T########",
            "#H..#.#$.HH..............EH#",
            "#H#######.H########H######H#",
            "#H.$###...H......##H......H#",
            "#H......E.H...$..##H...$..H#",
            "############################"
        ],
        // Level 075
        [
            ".........$...$..............",
            ".$...$...##H##...$...$....$.",
            ".##H##.....H.....##H##...#H#",
            "...H......H........H......H.",
            "....H......H........H....H..",
            "...H.......EH...$$...H....H.",
            "..H........H....##..H.----.H",
            "...H......H........H......H.",
            "....H......H.------.H....HP.",
            "...H.-----.EH........H....##",
            "..H...$$...H........H.......",
            "...H..##..H........H........",
            "..E.H......H........H.E.....",
            "#####TTTTTTTTTTTTTTT#######H",
            "...........................H",
            "############################"
        ],
        // Level 076
        [
            "###############............-",
            "#.............#............-",
            "#.------------HH#######$...-",
            "#.............H#..$..#.#---H",
            "#$.$E......P..H#.....#.#E..H",
            "#H######H@@@@@@#@@...H..##.H",
            "#H.....#H......###...H.....H",
            "#H$....#H-------...E.#H....H",
            "#H...##@H......#######H...H#",
            "#H..##$@H....###.....#H#####",
            "#H..#..@H..$##$#.$$..#H##.##",
            "#H##...@H..##..#######H#.#.#",
            "#H#$...@H.##...#-----#H##.##",
            "#H.....HHH#....#..$..#H#$#.#",
            "#H.....H#H...........#H##.##",
            "############################"
        ],
        // Level 077
        [
            ".----......$$$$$$$.....----.",
            "H....##################....H",
            "H.@@@##################@@@.H",
            "H....##################....H",
            "HE@H.##################.H@EH",
            "@@@H.#....#....#....###.H@@@",
            "...H.#$$$$#$$$$#$$$$###.H...",
            "...H.##################.H...",
            "...H.##################.H...",
            "...H.##################.H...",
            "...H.###....#....#....#.H...",
            "...H.###$$$$#$$$$#$$$$#.H...",
            "...H.##################.H...",
            "...H.##################.H...",
            "...H.##################.H...",
            "...H...................PH..."
        ],
        // Level 078
        [
            "#.........................#-",
            "#......$..E...-----------$#-",
            "#############HH....E.$..H##-",
            "####.........HH###########.-",
            "#####..$..E..HH........##..-",
            "#############HH..$....###H.-",
            "#######......HH########..H.-",
            "...$..##..$..HH.....###T#H.-",
            "H############HH.$..##....H.-",
            "H##.#.####...HH#####.$...H.-",
            "H..H#H#.$##..HH..#####T##H.-",
            "@@@H.H#H####PHH.##.$.....H.-",
            "@@@@@H.H#.###HH#####T####H.-",
            "@@@@@@@HHH#.#HH#.........H.-",
            ".........H.H.HH..........H.-",
            "############################"
        ],
        // Level 079
        [
            ".....................-......",
            "....E...........@....-...E.$",
            "H@@@@@.@@@@@@@H@@...#-#H####",
            "H.......---...H@$##H#-#H####",
            "##H##.##..H#E.H.###H#-#H##$#",
            "..H..##$#.H.#.H##..H#-#H####",
            "H#...####TH..#H..H###-#H....",
            "H....P....H...#..H#..-.####H",
            "H########.#.$#..$H#H#######H",
            "H########T#.#..####H##.....H",
            "H########T#.....$##H..######",
            "H##$...##T#----H#.#H------..",
            "H##...$##T#H...#..#$....#.#H",
            "H########T#H..#######H###$#H",
            "H...##$....H.##......H..###H",
            "H##########H###########....H"
        ],
        // Level 080
        [
            "......-----------$..........",
            "@@@@@@...##.....#@@@@@@#H...",
            "@------..$$.....#......#H...",
            "@H......###T....#.E...$#H...",
            "@H$$....$..$....######T#H...",
            "@@@@H.$.#T##..........EHH...",
            "....H.......$...$...E--.H...",
            "....H.....#@@@@@@@@@#--.H...",
            "....H$E.$.#E.....$..#...H...",
            "....H####H######T####...H...",
            ".....#..#H..............H...",
            ".....#..#H..............H...",
            ".....#$$#H..............H...",
            ".....##T#H..............H...",
            ".........H....E..P......H...",
            "###@@@@@###@@@@###@@@@###@@@"
        ],
        // Level 081
        [
            "-...........................",
            "-...........................",
            "@@@@@@@H...............H@@@@",
            ".......H...E.........E.H....",
            ".......H#######@@@#####H....",
            "...#...H...............H....",
            "..#..--H...............H....",
            "..#.$.$H....$#$.....$$$H....",
            "..#.#$#H--..#.#.$$$.###H--..",
            ".#..#$#H$.$--$#.###.#$#H$.$-",
            ".#..###H#$#.$#$.$$$.###H#$#.",
            ".#....#H$#$.###.###.#$#H$#$.",
            "#.....#H#$#.........###H#$#.",
            ".......H-H.............H-H..",
            ".......H....P..........H....",
            "###@@@#########@@@@#########"
        ],
        // Level 082
        [
            "@@@@@@@@@@@@.-.@@@@@@@@@@@@@",
            "@--------H#@---@#H---------@",
            "@......$.H#-----#H.$.......@",
            "@...$..##H--$-$--H##..$....@",
            "@..$##T-HH#@#-#@#HH-#T#.$..@",
            "@.$##--H-#T-H-H-T#-H--###$.@",
            "#$##--H-----H-H-----H---##$@",
            "#T---H------H-H------H----T#",
            "#---HE------H-H------EH----#",
            "#...H######THPHT######H....#",
            "#.$.H.......###.......H..$.#",
            "H...H....E..#$#..E....H....H",
            "H---H#T#####H.H#####T#H----H",
            "H.$..H......H.H......H..$..H",
            "H....H..$...H.H..$...H.....H",
            "#########@#######@######@@@@"
        ],
        // Level 083
        [
            ".----$................$.$P#-",
            ".....#H..............H#####-",
            ".....#H.............HT#####-",
            ".....#H............H#T##..#-",
            ".....#H...........H##T##$.#-",
            ".$.E.#H..........H#$#T##TT#-",
            "####..#H........H#.H#T##..#-",
            "$...#$.#H$.....H#.$H#T##..#-",
            "###H.#..##H...H####H#T##..#-",
            "$..#H.#$.#H$EH#.$.$H#T##..#-",
            "##H.#H.#..##H######H#T##..#-",
            "$.#H.#H.#$.#H.$.$.-H#T##..#-",
            "#H.#H.#H.#.#H#####.H#T##TT#-",
            ".#H.#H.#H..........H#T##...-",
            "..H..H..H.....E....H.......-",
            "############################"
        ],
        // Level 084
        [
            "......................-.....",
            "......................-.....",
            "E.......$#$...........-#$...",
            "#####H########H#H##########H",
            "$...#H.$......H#H....#.....H",
            "###H#####H##########H#H#####",
            "$..H.....H..E.......H#H....$",
            "#H##############H###########",
            "$H##$..#......$#H....E.#$...",
            "#########H#########H########",
            "##H.....EH###$.##..H..##..$#",
            "##H####H#########H###H######",
            "$.H####H#.$#####$H###H....##",
            "##H####H#########H######H###",
            "##H...#H.....#.P.H..#...H..$",
            "############################"
        ],
        // Level 085
        [
            "..............E..$..........",
            ".........$..######H#.$......",
            ".....###T####.....H#####T#..",
            ".....#......#.....H#.....#..",
            ".....#.E$...#.....H#.....#..",
            ".########.$.#$..#H#####$$#..",
            ".#......###T#####H....#T####",
            ".#......#.....$.#H.E$....-.#",
            ".#......#....H###########.H#",
            ".#...$.$#....H#.........$.H#",
            ".#..#####....H#.$..H#H.H####",
            ".####...#.$#H####..H###T#...",
            "....#.$.####H...#.$H#.......",
            "....#####..#H...###T#.......",
            "............H......P........",
            "@#@#@#@#@#@#@#@#@#@#@#@#@#@#"
        ],
        // Level 086
        [
            "-..........................-",
            "----------------------------",
            "HH........................HH",
            "H..#T##....###T##..######..H",
            "H..#..##...#....#..#....T..H",
            "H..#...##..#.......#.......H",
            "H..#....#..#.......#.......H",
            "H..#...$#..#....$..#.......H",
            "H..#...##..#...##..#....$..H",
            "H..#$.##...#...$#..#$..$#..H",
            "H..####....###T##..##T###..H",
            "H......P...................H",
            "H.H######..######..#H####..H",
            "H.H#...$#..######H.#H##$#..H",
            "HEH#....#.E##.$##H..H####..H",
            "############################"
        ],
        // Level 087
        [
            ".-..........................",
            "..-.........................",
            ".H$....$H......$H.....$H....",
            ".$H....H$......H$.....H$....",
            ".H$....$H......$H.....$H....",
            ".$H....H$......H$.....H$....",
            ".H$....$H......$H.....$H....",
            ".$H....H$......H$.....H$....",
            ".H$....$H......$H.....$H....",
            ".$H....H$......H$.....H$....",
            ".H$....$H......$H.....$H....",
            ".$H....H$......H$.....H$....",
            ".H$....$H......$H.....$H....",
            ".$H....H$......H$.....H$....",
            "PH$....$H.....E$H...E.$H..E.",
            "############################"
        ],
        // Level 088
        [
            ".--------#..........E.......",
            "H........#..$....H####H.#.#H",
            "H.TTTTTT.#####H@.H@...H.#.#H",
            "H.TTTTTT.#..$.H@.H@H@.H.#.#H",
            "H.TTTTTT.#H####@.H@H@.H.#.#H",
            "H.TT$$TT.#H.$..@.H@H@.H.#.#H",
            "H.TTTTTT.#####H@.H@H@.H.#.#H",
            "H.TTTTTT.#..$.H@.H@H@.H.#$#H",
            "H.......E#H####@.H@H@.H.##TH",
            "H#########H.$..@.H@H@.H....H",
            "H#############H@##@H@######H",
            "H#########..$.H@@@@H@@@@###H",
            "H##$$#####H####@.$.-.$.@$##H",
            "H########$H@#@@@@@@@@@@@###H",
            "H@@@@@@@@@@.......$..E$....H",
            "H.P........H################"
        ],
        // Level 089
        [
            "@-#@@@#@@##@##@@#@.@@#@@##@#",
            "@H-----@-@#@@#-@------@@####",
            "@H.P.$-@-.$$$.-.-..E.-.$..-#",
            "@H@#@#-@-#@##@H#H@###H####-#",
            "@H.$..-@-.$$$.H.H.$##H###@-#",
            "@H@#@--@-.###.H.H.@@$H$##$-#",
            "@H---.$@-.....H$H..#@H@#@@-#",
            "@H..-##@-..$..H@H..$.H-----#",
            "@H$.E-.@-.###.H@H..#@H..$@##",
            "@H####H@-..#..H$H..#.H.##$-#",
            "@H..@.H@------H@H..#.H...@H@",
            "@H..@.H---------H$E#.H@$$$H#",
            "@H..@$H@####H.$@H###########",
            "@H..@#H@...#####@#@-------H#",
            "@H.$..H..$...$.......E.$$$H#",
            "@######@#@@@@@@@@@@@@#@@@@H#"
        ],
        // Level 090
        [
            "..................H...-.....",
            "........--........H...-.....",
            "$...$..--.H.....--H..$-E....",
            "####H--...H.E..---#T##H#H...",
            "....H..@#T#H..---$#$..-#H...",
            "TT###H..$..H-H@@.@######H...",
            "T$...H..@....H...@@@@.--H...",
            ".T$..H......$H.$.....H@.....",
            "..#$.H#T##H@@@@@@H#T@H@.....",
            "..H#$H....H..$...H...H@.....",
            "..H.TH@...H#T####H##@H@.....",
            "..H.-H..$.H..$...H..@H@.....",
            "..H@.$..@.H####T#H.@$H$@....",
            "..H..@....H..$...H.@@H@@....",
            "..H.......H##T###H..EH......",
            "##########H..E..PH##########"
        ],
        // Level 091
        [
            "..............-.............",
            "..............-.............",
            "..............-.............",
            ".------...E..H#H..E...------",
            "......H---H#$H#H$#H---H.....",
            ".H#$.#H...H#######H...H#.$#H",
            ".H####....H-H#.#H-H....####H",
            ".HH##.......H###H.......##HH",
            "..H##.......H#.#H.......##H.",
            "..H##.......H###H.......##H.",
            "..H##.......H#.#H.......##H.",
            "..H##.......H###H.......##H.",
            "..H##.......H#.#H.P...E.##H.",
            "..H#########H###H#########H.",
            "$.H##...$..#H.$.H#..$...##H$",
            "@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
        ],
        // Level 092
        [
            "........................-...",
            "...............$.....#E#-#..",
            "......H---H###########.#-#..",
            "$.----H....#......$..#.#-#..",
            "#H.........#....######.#-#..",
            "##H......E.#....$......#-#..",
            "###H.....$.#.....-----.#-#..",
            "####H.-----#$..$#....H..-...",
            "@@@@@@H....######....H---...",
            "......H....######....H.#####",
            "......H....######....H.#$.E.",
            "......H....######....H.####H",
            "......H..............H.....H",
            "....--H..............H.....H",
            "E.$#..H.......P......H.....H",
            "####..H##$###########H..###H"
        ],
        // Level 093
        [
            ".............--.............",
            "..E.HHHHH..$$--$$..HHHHH.E..",
            "....HHHHH.H######H.HHH.H....",
            "..H#H.H.H.H..$...H.H.H.H#H..",
            "..H#H.H.H.H######H.H.H.H#H..",
            "...#H.H.H-H..P.$.H-H.H.H#...",
            "...$@.H.@-########-@.H.@$...",
            "...TH.H.H-H######H-H.H.HT...",
            "..HTH.H.H-H######H-H.H.HTH..",
            "..HHH.H.H..H#TT#H..H.H.HHH..",
            "..HHH.H.H..H#TT#H..H.H.HHH..",
            "...HH.H.H...#$$#...H.H.HH...",
            "....HHH.H..........H.HHH....",
            ".....HHHH..........HHHH.....",
            "......HHH..........HHH......",
            ".......EH##########HE......."
        ],
        // Level 094
        [
            "$..############-############",
            "H#---....-...$#-#..........#",
            "H#$#.####.#####-#H###H####H#",
            "H#$#.#..#...$.#-#H###H####H#",
            "H#$#.#$$#######-#H..#H.E$#H#",
            "H#$#.##########-###H#H####H#",
            "H#$#..$....E...-..#H#H####H#",
            "H#$#####H####$.-.$#H#H....H#",
            "H#$#....H...#######H######H#",
            "H#$#H###$##H..$...#H...$.#H#",
            "H#$#H#.$..#######H########H#",
            "H#$#H.H##HE$....#H....$..#H#",
            "H#$############H########H#H#",
            "H#$#$..#.$.#.$.H$.#...$.H#H#",
            "H#T#H#H#H#H#H######H######H#",
            "H.$.H#H$H#H$H#P..$.H..$...H#"
        ],
        // Level 095
        [
            "..-.........................",
            "..-.........................",
            "..-......-----........-----H",
            ".EH....-......H..--.EH.....H",
            "T#H---H.#T##..H##..##H.##T##",
            "T#....H##T###.H##..##H.##T#.",
            "T#....H##E-...H##..##H.##...",
            "T#....H##H.##.H##..##H-.#...",
            "T#.$..H##H$##.H##$.##$HTT$P.",
            "T.--H-H##H.##.H##..##.H####.",
            "##.HH..##H..#.H##..##.H####.",
            "##HH...##H.T.-H##..##.H##...",
            "##H....##H.##..##..##.H##...",
            "##H.$--##H..$...#.$#..H...$.",
            "#####H.######H..##T#..H####H",
            "#####H.$####.H..$#T$..H#####"
        ],
        // Level 096
        [
            ".-..E...####.E..$...####....",
            "H.H####H####H######.#######H",
            "H.H####H..$.H###$##.####$##H",
            "H.H#$$#H###########....####H",
            "H.#####H.....--------------H",
            "H.....#HE........$..$.......",
            "H#T#H.#H#####T#######H.$.$..",
            "H$.#H.#H-----.-----H@@@@@@@@",
            "##.#H.#H....$.$....H..P$..$.",
            "...$H.#H#####T#####H#######H",
            "##H@@.#H-----------H.......H",
            "##H...$H....$.....@######H.H",
            "##H##############-@....$.H.H",
            "$#H#.............-@#####T#.H",
            "##H#.....$....$..-@....E...H",
            "############################"
        ],
        // Level 097
        [
            ".............HH----HHHHH####",
            "............H##H---H$$.H####",
            "...........H####H...HH$H.H.H",
            "..........H######H....HH$H$H",
            "..........H######H.....HHHHH",
            "..........H#@#@T@H.....H.H.H",
            "..........H$@#@T$H.....H.H.H",
            "..........H#@#@T@H.....H$H$H",
            "$---------H#@#@T@H.....HHHHH",
            "H$........H$@#@T$H.....H.H.H",
            "#H$.......H#@#@T@H.....H.H.H",
            "##H$......H#@#@T@H.....H$H$H",
            "###H$.....H$###T$H.....HHHHH",
            "####H$....H######H.....H.H.H",
            "#####H$..H@#.#@.#@H...PH$H$H",
            "######H.EH@#.#@.#@HE.H######"
        ],
        // Level 098
        [
            "@-.........................@",
            "@-@@@@.@@@@@@@@@#@@@@@@@@@$@",
            "@-....$...$----...--------H@",
            "@-.......H##..#####.....##H@",
            "@-.....$.H.......$#..#.$#$H@",
            "@-....###H..$.P..##..#T##@H@",
            "@-.$.....H#####H..#.E.....H@",
            "@-.###...H#...#H..#---H####@",
            "@-.....E.H#$..#H..#...H---.@",
            "@-...H#########H###...H..$.@",
            "@###.H#$.#.$..#...#...H.###@",
            "@$.##H#########...#...H.#..@",
            "@####H---$$@$$#$..##@@@H@##@",
            "@...#H..###@#####H#....H..$@",
            "@.$.#H....$......HH..E.H#H.@",
            "#####H############H#########"
        ],
        // Level 099
        [
            "..---......$..$....---..@.#H",
            "##..#H....H####H..HE..##@..H",
            ".##.#H...H##########H.##@.#H",
            "##..#H#####$##$#####H.#$@##H",
            "$##$#H.....E........H.....#H",
            "#################T#########H",
            "...$.E...$..........P...E..H",
            "@@@@@@@@@@@@@@@@H###########",
            ".-------------.@H...........",
            "H......-......H@H----------.",
            "H.....-.-.....H@##.##.##.##H",
            "H....-.#.-....H@@@@@@@@@@@@H",
            "H...-.###.-...H------------H",
            "H..-.#####.-..HT#T#T#T#T#T#T",
            "H.-.##$$$##.-.H@............",
            "H-.#########.-H@........E..."
        ],
        // Level 100
        [
            ".................E.E.E-.....",
            "...............H######.H###H",
            "...............H#....#.H###H",
            "...........H######...#.H###H",
            "...........H#....#...#.H###H",
            ".......H######...#$$$#.H###H",
            ".......H#....#...#####.H###H",
            "...H######...#$$$#.....H###H",
            "..EH#....#...#####.H#######H",
            "######...#$$$#....EH#....##H",
            "#....#...#####.H######...##H",
            "#....#$$$#.....H#....#...##H",
            "#....#####.H#####.$$$#$$$##H",
            "#$$$$#.....H#@@@@@@#@@@#@@@H",
            "######.H#####........P.....H",
            ".......H####################"
        ],
        // Level 101
        [
            "H..........................H",
            "H.....H#$##H.....H##$#H....H",
            "HE$...H####H.....H####H...$H",
            "####H.H####H-----H####H.H###",
            "....H.H##$#H.....H#$##H.H...",
            "..$EH.H####H.....H####H.H$..",
            "H####.H####H.....H####H.###H",
            "H.....H#$##H-----H$###H....H",
            "H.$...H####H.....H#$##H..$.H",
            "####H.H##$#H.....H####H.H###",
            "....H.H$###H.....H##$#H.H...",
            "..$.H.H####H-----H####H.H.$.",
            "H####.H#$##H.....H###$H.###H",
            "H.....H####H.....H#$##H....H",
            "H..P..H##$$H..E..H####H..E.H",
            "############################"
        ],
        // Level 102
        [
            "---------....H......-----...",
            ".........H....H....H........",
            "...------H.$...H...H........",
            "..H.$.E..###...H....H.......",
            "..H.####......H.---..H.$$--.",
            "..H..........H...$...H.@@...",
            "..H----...$.H....@..H......$",
            ".......H.##.H......H.......#",
            ".......H.....H.....@@@###@##",
            ".......H......H.--..........",
            "...$E$.H.......H.........@.@",
            "..####.H----...H...@@@@@@@.@",
            "$........$$...H.$......$.$E@",
            "@........@@..H..#..#########",
            "...........P.H..............",
            "#####@@@#########@@@########"
        ],
        // Level 103
        [
            "-----------------------H....",
            "..$....$.....$.....$...H....",
            "####..####..###T..##T#.H....",
            ".....$....$......$.....H....",
            "#..#T##..##T#..T###..#.H....",
            ".$......$...$......$...H....",
            "####..####..###T..##T#.H....",
            "....$.....$.....$......H....",
            "#..##T#..#T##..T###..#.H....",
            "..$.....$.....$....$...H....",
            "####..####..###T..##T#.H....",
            "E....P...........E.....H...E",
            "########################-###",
            "########################-###",
            "######################..-..#",
            "######################.E-E.#"
        ],
        // Level 104
        [
            "............E..............-",
            "....$.................$....-",
            "..H###H....##H##....H###H..-",
            ".H#.$.#HH##HHHHH##HH#.$.#H.-",
            "#H#####H##HHHHHHH#H######H#-",
            ".....E...HHHH$HHHH.........-",
            "#########HHHHHHHHH#########-",
            ".##$##...#HHHHHHH#..##$##..-",
            "..###.....#HHHHH#....###...-",
            "...#.......#HHH#......#....-",
            "............#H#............-",
            "............#H#............-",
            "............#H#............-",
            "............#H#............-",
            "....E........H.....P.......-",
            "###########################-"
        ],
        // Level 105
        [
            "####@@#####################-",
            "#.$..@.....$..E....P......#-",
            "#H#H.@#T#H######T########.#-",
            "#H##H.#T#HH##$--------$...#-",
            "#H.##H.T##HH##$...$..$##H.#-",
            "#H..##H.###HH##$....$##.H#H-",
            "#HH..##H.##HHH##$..$##..HHH-",
            "#HHH$.#HH.#H#HH##..##..#HH#-",
            "#HHHH..H#H.H##HH#T##..#HHH#-",
            "#$HHHHEH##HH###HHT#..HHH$H#-",
            "#HH$..HH.##H.###HT.$#HHHH##-",
            "###H####$.##H.##H..#HHHEHH#-",
            "#HHHHHHHH..#HH.HHEHHH$..HH#-",
            "#H.HH.$..H..H#HHH#HH#####H#-",
            "#$.H#H####H.....HHH$.....H.-",
            "#####HHHH$H#####HH##########"
        ],
        // Level 106
        [
            "@@@@@@@@@@@@-..@@@.......@#@",
            "#######@##@@-..##@.......#@#",
            "...$..#@#@#@-..@#@.......#..",
            "H@###T#....@-.E.#@......$#.$",
            "H####...----H##@#@T#####H@.H",
            "H#.$#.---@#@H#....T@####H#.H",
            "H###---..@#@H#----T@####H@#H",
            "H##---......H@.....$.##@H##H",
            "H#--$...##@#H#....T##@@#H##H",
            "H--.@-------H...-----.##H.#H",
            "...@#E..$..@HT##@.P.$...H##H",
            "##T#@##.@##@HT##@@#@@#@....H",
            "##T#@......@HT....E.$.@#####",
            "##T#@-------HT##..####@..$.#",
            "##.....$...@H..........#####",
            "#@####@##H..H..H###@########"
        ],
        // Level 107
        [
            ".----------..P...----------.",
            "H....----..######..----....H",
            "H....---.##########.---....H",
            "H....--.############.--....H",
            "H....-.#####$$$$#####.-....H",
            "H....-.##############.-....H",
            "H.....################.....H",
            "H.....##$$$$####$$$$##.....H",
            "H.....################.....H",
            "H.....######$$$$######.....H",
            "H......##############......H",
            "H....-.##############.-....H",
            "H....-..#$$$$##$$$$#..-....H",
            "H....--..##########..--....H",
            "HE$$$---$..######..$---$$$EH",
            "#########H$$$$$$$$H#########"
        ],
        // Level 108
        [
            "############....######@@###-",
            "#---------------------.##.#-",
            "#.H#########H..-#-----H-----",
            "P.H$@$$$$...H..-#$..$$H...$-",
            "##H#####@###H..-###H###T#H#-",
            "#.HHHHH.@..$H..-#$.H-----H.-",
            "#$..@$H..$$#H..-#@.H.@@@.H$-",
            "#######T####H..-#$.HE..$$H@H",
            "#..$@$$.@..#H..-######H####H",
            "#..@@@@.@..#H--H#$....H..$$-",
            "#.$$$.$$@$.#H$EH#@$...H.###H",
            "#H###T####H#########H######H",
            "#H--------H###.-----H-@.---H",
            "#H.$..$$$.H..$H.$.$.H.@H$.$#",
            "##H##H@#H###T#H##@#T#####H##",
            ".$H$$HE.H.....H........$$H$$"
        ],
        // Level 109
        [
            "HH.#####EH@@@.@@@HE#####.HH@",
            "H@HH.$.HH@HHHHHHH@HH.$.HH@HH",
            "$H@H#H#H@H$##H##$H@H#H#H@H$#",
            "#.H@HHH@H.#.HHH.#.H@HHH@H.#H",
            ".#HH@H@HH#.H...H.#HH@H@HH#..",
            "H#.HHHHH.#H.###.H#.HHHHH.#H#",
            "H#H.....H#H#.$.#H#H.....H#HP",
            "H#.HHHHH.#H.###.H#.HHHHH.#H#",
            ".#HH@H@HH#.H...H.#HH@H@HH#..",
            "T.H@HHH@H.#.HHH.#.H@HHH@H.#H",
            "$H@H#H#H@H$##H##$H@H#H#H@H$#",
            "H@HH.$.HH@HHHHHHH@HH.$.HH@HH",
            "@H.#####.H@@@H@@@H.#####.H@@",
            "@H.H.$.H.H@@HHH@@H.H.$.H.H@@",
            "@H.H#H#HEHH@HHH@HHEH#H#H.H@@",
            "H@H@HHH@H@HHHHHHH@H@HHH@H@HH"
        ],
        // Level 110
        [
            "......@-------..---.HH##H..-",
            "$...E$@------$##...HH##HH..-",
            "###H##@.....$##...HH##HH$..-",
            "...H..@....$##...HH##HH$.@@-",
            "$..H.$@...$##...HH##HH$.@@.-",
            "###H##@..$##...HH##HH$.@@..-",
            "..PH..@.$##...HH##HH$.@@.$$-",
            "###H.$@$##...HH##HH$.@@.H##.",
            "###H##@##...HH##HH$.@@..H$$.",
            "#$#H..@.$..HHE.HH$.@@.H####.",
            "###H.$@###########H@..H$.E$.",
            "$##H##@-----------H@.H#####.",
            "###H.$@$.$..H......@.H$...$.",
            "#@@@@@@###..H.####.@.H#####.",
            "...........EH##$$##@.H$...$.",
            "############@######@.#######"
        ],
        // Level 111
        [
            "............HHH.............",
            "...........HHHH.............",
            ".............HH.............",
            "..E.........HHHH.........E..",
            "-----------HHHHHH-----------",
            "-----------HHHHHH-----------",
            ".----------HHHHHH----------.",
            "...--------HHHHHH--------...",
            ".....------HHHHHH------.....",
            "........---HHHHHH---........",
            "$.$.$.$.$..HHHHHH..$.$.$.$.$",
            "...........HHEPHH...........",
            "###########HH##HH###########",
            "###########HH##HH###########",
            ".$.$.$.$....H..H....$.$.$.$.",
            "############################"
        ],
        // Level 112
        [
            ".....................@@@@@@H",
            "--------------..E..........H",
            "H............H@@@@@@@.H#.H-#",
            "H.EH@H.......H-----H.#H.#H..",
            "@@@@@H@H@.P........H..##.-#T",
            "H----H.H#T###@@@.##H.##H--#T",
            "H....H.H#.$#...$...H.#.H#--T",
            "H......H#..$####.@@H.$H#$.$$",
            "H......H#.E#####...H.#H#...#",
            "HT$.....#.#####$.@@H--H#H###",
            "H.#.....#.$#####.$.H..#.H##.",
            "H..#....#.######.H@H.###H.##",
            "H...#...#H.$#$.#.H.H..#.H#.$",
            "H....#...H######.H@H.#.##.##",
            "H.......#..........H........",
            "##@@@#########@@@@#@#@@@#@@@"
        ],
        // Level 113
        [
            "-...........................",
            "-...........................",
            "###############H##.$......P.",
            "....E.....E....H##T#@@@@@@@H",
            "$..HHHHHHHHHHH.H...........H",
            "#$.H..HHHHHHHH.H.$.$.H#####H",
            ".#$H..H........H.#-#.######H",
            "..#H..H$.$.$.$..H.#........H",
            "...#$.H#T#T#T#.H.....E$.$.$H",
            "....#.H.........H....#H####H",
            "......H.H.H.H..H......H.....",
            "......H.........H.....H.E...",
            ".......H.H.H...H......#####H",
            "........H.H.H...H..........H",
            "....E....$-#...H...E.......H",
            "############################"
        ],
        // Level 114
        [
            ".......--..........--....--.",
            ".######$-H########H-$####$-.",
            ".#######$H########H$######$.",
            ".########H########H########.",
            ".###.####H###.....H###...##.",
            ".###..###H###$$$..H###$$$--.",
            ".###..###H######..H######$-.",
            ".###..###H######..H.######$.",
            ".###..###H######..H..######.",
            ".###.$###H###.....H.....###.",
            ".###$####H###$$$$$H##$$$###.",
            ".########H########H##T#####.",
            ".#######.H########H.#T####..",
            ".######..H########H..T###...",
            "..E..E...H...P....H...E..E..",
            "#########-###HH###-#########"
        ],
        // Level 115
        [
            "...........................-",
            "--------.#H............$..$-",
            "...$#$..H#H#@#@#@#@#@T@#@#@#",
            "..$#.#$.H#H....$...$..------",
            ".$#...#$H##@#@#@#@#@#H.....H",
            ".#.....TH#@@@@@@@@@@@H..$..H",
            "........H----------H###T###H",
            "...................H#......H",
            "..$.P$.............H#......H",
            "H#######H.E.$..$...H#.$..$EH",
            "H.E$..$.H#@#@#@#@#@#@@#@T@#H",
            "H#######H######$.###.......H",
            "H..$.$..H########.##.......H",
            "H#######H#########.#.......H",
            "H...$.$.H##########..$..$..H",
            "############################"
        ],
        // Level 116
        [
            "##-#@#@#@#@#@@#.#-#@.##-####",
            "##-######@#@@H@.@-@#.#.-..H#",
            "#@-......#@..H...-.$..E-..H#",
            "###T##H------H##T#########H#",
            ".P.$..H$H#@$.H.@..@#@..#..H#",
            "#####H##H@#@..$.@....@.---H#",
            "..@#.H@.H@@@#@@#.@..-----#H#",
            "$.E..H..H..#---------@.$##H#",
            "#T@##H..H$@@#$.#@$..@..##.H#",
            "@T.@.H..$@#@@#$.@#---H#...H#",
            "..#..H.$@.$$$.@$..@..H....H.",
            "H----H$@.H#@#..@$...#H######",
            "H.H..@@--H......@..$.H.@@@@@",
            "H.H#@#$$.H--H..H.####H..@..#",
            "H.H$.$##$E$$H--H..##@H...E$#",
            "############H.$H$###########"
        ],
        // Level 117
        [
            "............###............-",
            "....$..E.$..@@@.....$E..$..-",
            "H##############H############",
            "H----------.@@@H............",
            "...........H###H..---------.",
            ".----------H@@@H$..........H",
            "H.$..----P..######.......$H#",
            "#####....#H.@@@@@@....E$H###",
            "..-.#....#H.######...$H#####",
            "##$H#....#H.@@@@@@.$H#######",
            "$##H#....#H-----.$H#########",
            "##$H#....#H.@@@.H@@@@@@@@@@@",
            "$##H#.$$.#H.###.H...........",
            "##$H####T#H.@@@.H##########H",
            "$##H..E...H$###$H#$........H",
            "############@@@###@@@@@@@@@@"
        ],
        // Level 118
        [
            "----------------............",
            ".....$..........HE..........",
            "....$$$........HHH..........",
            "....$$$........HHH..........",
            "...$$.........HH............",
            ".$$.$$$.....HH.HHH..--------",
            "$$.$$..$$..HH.HH..HH...E....",
            "...HH.........HH......HHHHH.",
            ".E.HHH........HHH.....$$$$$.",
            "HHHH.HH....HHHH.HH....HHHHH.",
            ".....HH.........HH....$$$$$.",
            ".....HH.......P.HH....HHHHH.",
            "############H###############",
            "............H...............",
            "............H...............",
            "############################"
        ],
        // Level 119
        [
            "........................-...",
            "...$....................-...",
            "H@##....................-@@H",
            "H@$##.$................$-@@H",
            "H..#$###..........E.#######H",
            "H..#.#..###$.....###.$.....H",
            "H--..#$.#..#..$.##$.@@@@...H",
            "H..######...###T#......###@H",
            "H$.P.............#@@@H#.$..H",
            "H@@@@--------........H###$.H",
            "H...@....E$$$$.......H..####",
            "H.$.@$..@@@@@@@@@@...H.$@..$",
            "H#####...............H##@@##",
            "H----H------.........H......",
            ".....H...............HE.....",
            "...$.H...###################"
        ],
        // Level 120
        [
            ".............-..............",
            ".............-..............",
            ".........H...-............H.",
            "...######H...H------------H.",
            "...#..$.#H...H..........E.H.",
            "...#....#H...H@@@@@@##@@##@@",
            "@#@@#@@#@@#@@H#-----#T###..#",
            ".$E.$.....$..H#.H...#--.#..#",
            "#######T#####H#.H#$$#$#H#$.#",
            ".------------H#.H####T#H#..#",
            "HE...........H#.H$...--HHH##",
            "H############H######H.$..H..",
            "H...........PH......H##..HHH",
            "H$#####.$.###H##.$.#H#$--..H",
            "H##.$.#####$.H$#####H##$.##H",
            "####################H..#####"
        ],
        // Level 121
        [
            "............................",
            "######H-............-H######",
            "###HHH$-............-$HHH###",
            "HH###HHH$..........$HHH#T#HH",
            "$HHH#T#HHH$E....E$HHH###HHH$",
            "..$HHH###HHH$..$HHH#T#HHH$..",
            "....$HHH#T#HHHHHH###HHH$....",
            "......$HHH###HH###HHH$......",
            "........$HHH#HH#HHH$........",
            "......$HHH###HH###HHH$......",
            "....$HHH###HHHHHH#T#HHH$....",
            "..$HHH#T#HHH$..$HHH###HHH$..",
            "$HHH###HHH$......$HHH#T#HHH$",
            "HH#T#HHH$..........$HHH###HH",
            "###HHH$-............-$HHH###",
            "######H-.......P....-H######"
        ],
        // Level 122
        [
            "-...........................",
            "-......E..........$.........",
            "-.@@H@@@@.........@@@@H@@@@@",
            "-...H....#$......#....H#.---",
            "----H-----#.....#-----H@H..$",
            "#$..H..$...#...#......H#H--.",
            ".#E.H---.#H.#.#...$...H@...H",
            "..#.....#.H..T........H#$..H",
            "P..#...#..H.........$.H@.--H",
            "@@#.#.#...H#.------.#.H#H...",
            "....#T....H.#.$....#..H@H.E.",
            "$H###.....H..#....#.$.H####H",
            "#H@-------H...#..#..##H####H",
            ".H.............TT.....H....H",
            ".H....................H....H",
            "@@@@@@#######@@@@####@@@@@@@"
        ],
        // Level 123
        [
            "..............-.............",
            "...--------..-----..........",
            "..H........H-.....H.H####H..",
            "..H-------EH------.H#.H-.#H.",
            "..H.......H#..---.H#..H.$.TH",
            "..H......HT.#H...H#...H...$#",
            "..H..--.H#...#H.-.P---H----#",
            "H.#HH-.H#$H##.#H..#........#",
            "H#.#H-.H#######H..####.#####",
            "##T##-.H#..#$.#H-H....-...EH",
            "##T##-.H#######..H####.####H",
            "#.$.#-.H#.$#..#H.H#$##.####H",
            "#####-.H#######H.H####.##$#H",
            "#####-.H#..#$..H.H#....#...H",
            "#...#-.H#######H.H##T###T##H",
            "#.$..-#H......#H#H...#..$..H"
        ],
        // Level 124
        [
            "-..........................-",
            "-..........................-",
            "------H.....H------H#.....#H",
            "......H-----H......H#.$...#H",
            ".$....H.....H.E.$..H#####T#H",
            "###.$.#HH...#############T#H",
            "#######.H.$..........$.....H",
            "#####$..H##...$#$...##.....H",
            "######$.H##..$###$..##.....H",
            "#######$H##.$#####$.##.E.$.H",
            "########H##T###########H@@#H",
            "#......EH..............H.##H",
            "#..$..##H.......P......H.##H",
            "########H----H####H$---H.##H",
            "#..$....H..$.H##$#H#..#H$##H",
            "##################H####H###H"
        ],
        // Level 125
        [
            "....------..............-...",
            ".###......H--...E..H####....",
            ".#$......H--.######H####....",
            ".###.....--..T####TH#$$#....",
            ".....###T....T####TH####....",
            ".....###T.##-T#$$#TH....T###",
            ".....#$$T.##.T####TH....T###",
            ".....###T..........H....T$$#",
            "...................H....T###",
            ".........T##T......H........",
            "T###T....T$$T......HT###....",
            "T###T....T##T......HT###.##.",
            "T.$.T..............HT$$#.##.",
            "T###T..............HT###....",
            "..............E....H.P......",
            "############################"
        ],
        // Level 126
        [
            "...$......-.-..E...-......-E",
            "H###.H####$#$#####H.-....-.H",
            "H..$.H############H.-$.-.$.H",
            "H###.H##$#####$###H-..-.-.-H",
            "H..$.H############H.$...$..H",
            "H###.H#$#######$##H.--..-..H",
            "H..$.H############H.-.$.-$-H",
            "H###.H##$#####$###H...-..-.H",
            "H..$.H############H..-.-...H",
            "H###.H###$###$####H-..-.-.-H",
            "H..$.H############H..$...-.H",
            "H###.H####$#$#####H...--.$.H",
            "H..$.H############H.-..-.-.H",
            "H###.H###$###$####H.$.-.-.-H",
            "H.E..H############H.....P...",
            "H####H##$#####$###H#########"
        ],
        // Level 127
        [
            "......-....................-",
            "......-......E.............-",
            "---.E.-------#####H....E...-",
            "H##@###.#######H$##########H",
            "H##$###.@$...H#H##...$...$.H",
            "H######.@@@@@H@H...-------.H",
            "H........----H.H...H.......H",
            "##T###H........H...H..#....H",
            "---...H######.#######H######",
            "$...H##.....----#.HHHHHHHH--",
            "....H#..@@@H....#$HHHHHHHH.$",
            "H####..#...@@@H.#-HHHHHHHH.-",
            "H.....#..H####H.#$HHHHHHHH..",
            "H...H#...H####H.#-HHHHHHHH..",
            "HP..H#H..H#.$#H.###########H",
            "###############............H"
        ],
        // Level 128
        [
            ".-........................-.",
            "H.########################.H",
            "H.#....#..$..$#.......#..#.H",
            "H.#.$..####T###.......#..#.H",
            "H.#T####.....#.$E.$...#.$#.H",
            "H.#...#......#############.H",
            "H.#.$.#......#......#....#.H",
            "H.#####..$.E.#......#....#.H",
            "H.#...#########.....#..$.#.H",
            "H.#......#....#$..E.##T###.H",
            "H.#.$..$.#....#######....#.H",
            "H.###T####....#...#......#.H",
            "H.#.$.#$...E$.#$..#.$....#.H",
            "H.###T##########T######T##.H",
            "H...........P......E.......H",
            "############################"
        ],
        // Level 129
        [
            ".............HH.............",
            "..EH.........HH.........H.E.",
            ".##H##.....##HH##.....##H##.",
            "##$H$##...###HH###...##$H$##",
            "#..H.....##$.HH.$##..#..H...",
            "##$H$.---##..HH......##$H$..",
            ".##H##...##$.HHE$.....##H##.",
            "..$H$##...###HH##......$H$##",
            "...H..#....##HH###.--...H..#",
            "##$H$##....$.HH.$##..##$H$##",
            ".#THT#.......HH..##...##HT#.",
            "...H.....##$.HHE$##.....H...",
            "..........###HH###..........",
            "...........##HH##...........",
            "........P....HH.............",
            "#############HH#############"
        ],
        // Level 130
        [
            "H...........................",
            "H..--......-----------------",
            "H...-.....$H....$....H...E.H",
            "###.#######H-------H.H.H@@@@",
            ".$.........H.$.....H.H.H....",
            "@@@H###.E..H-------H.H.@@@@H",
            "...H.$.#####....$..H.H.....H",
            ".P.H.#####$#-------H.H.H@@@@",
            "H#.H---------------H.H.H.$..",
            "H#######T#####...E...H.@@@@H",
            "H$..####.....#$..####H.....H",
            "H#############@@.######H####",
            "H@############...######H###$",
            "H@############H@.##$###H####",
            "H@.$##########H@.......H....",
            "H.#######$....H@############"
        ],
        // Level 131
        [
            "............-...............",
            "#.........#$-$#.........#...",
            ".#---H-----#H#-----H---#....",
            "..#$.H.E...$H$...E.H.$#.....",
            "...#-H-H---#H#---H-H-#......",
            "....#..H..T.H.T..H..#.......",
            ".H---#.H.#--H--#.H.#------H.",
            ".H-H..#H#.......#H#.....H-H.",
            "...H..#H#.......#H#.....H...",
            ".H-H..#H#.P.$...#H####..H-H.",
            ".H....#H#########H####....H.",
            ".H-H..#H#.#####.#H##$#..H-H.",
            "..$H..#H#.##$##.#H####..H$..",
            ".H-HE.#H#.#####.#H#....EH-H.",
            ".H----.H.-.....-.H.-------H.",
            ".H....#H#.#####.#H#.......H."
        ],
        // Level 132
        [
            "#-.........................#",
            "#--------------------------#",
            "#-.......T###H###T.........#",
            "#-....$T#T...H...T##.$.....#",
            "#-..$T#T$$$$$H$$E$$#T#.$...#",
            "#-.##T#T#####H######T#T#.$.#",
            "####.........H.........#T#T#",
            "##.....$$$$..HE.$$$$.....#T#",
            "#....H######TH#######H.....#",
            "#....H.......H.......H.....#",
            "#...$H..$$$$$H.$.$$$$H.E...#",
            "#.HT#########HT#########H..#",
            "#.H..........H..........H..#",
            "#.H..........H..........H..#",
            "#.H..........H..P.......H..#",
            "############################"
        ],
        // Level 133
        [
            "-------------H--------------",
            ".$......$....H...$...$.E$..$",
            "E$..$....E.$.H.$...$.$......",
            ".#T##T#H.H#T####H.H#T#......",
            ".#T##T##HH#T####THH#T#......",
            ".#T##T##TH#T####T#H#T#......",
            ".#T#..##TH#T#..#T#H#T#......",
            ".#T#..##TH#T#..#T#H#T#......",
            ".#T#..##TH#T#..#T#H#T#......",
            ".#T#..##TH#T#..#T#H#T#......",
            ".#T#.$##TH#T#.$#T#H#T#......",
            ".#T#T###TH#T#T##T#H#T###T##.",
            ".#T#T###.H#T#T##T.H#T###T##.",
            ".#T#T##..H#T#T##..H#T###T##.",
            ".........H...P....H.........",
            "############################"
        ],
        // Level 134
        [
            "$E.....#####################",
            "##H....#####################",
            "H####H....##################",
            "H#######H.E..###############",
            "H#####.####H....############",
            "H#####.#######H....#########",
            "H#####.##########H.E..######",
            "H####.$.############H....###",
            "H#######.$.############H....",
            "H#####.####.$.#############H",
            "H#####.#######.$.##########H",
            "H#####.#########H.$.#######H",
            "H#####.#########H###.######H",
            "H$...$...$...$.#H###.######H",
            "##############..H###......PH",
            "############################"
        ],
        // Level 135
        [
            ".......-....................",
            ".......-....................",
            ".......-...H@@@@@@@@@@@@@@@@",
            "##HH###H###H.....E...-------",
            "#$#H#.#H#.#H############..$.",
            "#.#H#$#H#$#HHHH$HHHH$HHH###H",
            "#THH###H#.#HH@@@@HH@@@HH...H",
            "HHHHHHHHHHHHH@..$HH@..HH##H$",
            "HH....H.##.HH@.-@HH@.$HH#.H#",
            "HH.###H.#$#HH@@@@HH@@@HH#H.#",
            "HH.#$.H..##HH----.HHHHHH#H..",
            "HH.##.H.#.#H..$...HHHHH####H",
            "HH....HP##.H#######..$H###$H",
            "HHHHHHH@@@@H#HHHHH@.##H###.H",
            "H.....$..@@H#H.H.H@.##H.##H#",
            "#####H...E..#H.H$H@..$H#.EH#"
        ],
        // Level 136
        [
            ".....................EEE....",
            "..................$$$$$$-...",
            "...........$$$$$$-#######...",
            "....$$$$$$-@@@@@@@..........",
            "...-#######.................",
            "...--.......................",
            "....-.......................",
            "$$$$-.......................",
            "####H.......................",
            "##########H.................",
            "###############H............",
            "###################H........",
            "######################H.....",
            "########################H...",
            "#########################H..",
            "#########################HP."
        ],
        // Level 137
        [
            "-...........................",
            "-...$...$...$E.E$...$...$...",
            "##############-#############",
            "..............H.............",
            ".............#H#............",
            ".............$H$............",
            "...E........##H##.......E...",
            "...H........$.H.$.......H...",
            "..#H#......###H###.....#H#..",
            "..$H$......$..H..$.....$H$..",
            ".##H##....####H####...##H##.",
            ".$.H.$....$...H...$...$.H.$.",
            "###H###..#####H#####.###H###",
            "$..H..$..$....H....$.$..H..$",
            "...H..........H.P.......H...",
            "############################"
        ],
        // Level 138
        [
            ".............-..............",
            ".............-..............",
            "..........E..-..$---........",
            ".--------H@@@@#T##..H.......",
            "H........H.......$..H.......",
            "H......######@@@#######.....",
            "H......#$.#...#...#...#.....",
            "H.E.$$.#..#..$#.$$#.$$#.$...",
            "H#######..#################.",
            "H#..#.#####.....#...........",
            "H#.$#.$..#...H$.#.P......$..",
            "H###########@H@#######T#####",
            "H............H..........---.",
            "H............H.........H..$.",
            "H........$...H.........H.###",
            "#############H....$.E..H..$."
        ],
        // Level 139
        [
            "-...............-..@####....",
            "-###############-..@.$H#.$..",
            "------------H..#H--@##H#.@@@",
            "$H#@#.....$.H--#H...$.H#...H",
            "@H...##.....H..#H..@##H#..$H",
            "@H##..$#...PH..#H.$@E.H#H--H",
            "HH.$########H..#H..@#H##H..H",
            "H..###.....@H..#H....H..H.$.",
            "H...##....$@H..##H...H..H###",
            "HH...######@HE..###H.H..H...",
            "@H###------@##H...###HH.H##H",
            "#H....E.......#@H...##H#...H",
            "#H#######H......#@H...H#...H",
            "#H##$####H#####H###@@HH###.H",
            "#H#####$#H#####H$..$.HH#$..H",
            "#H###################H#####H"
        ],
        // Level 140
        [
            "............................",
            "..........--------..........",
            "..........H######H..........",
            "........E.H#.E..#H.E........",
            "..........H#..$.#H..........",
            ".....H################H.....",
            ".....H#....#....#....#H.....",
            ".....H#....#....#....#H.....",
            ".....H#....#....#....#H.....",
            ".....H#..$.#E.$.#..$.#H.....",
            "H#############T############H",
            "H#....#....#....#....#....#H",
            "H#....#....#....#....#....#H",
            "H#..$.#..$.#..$.#..$.#..$.#H",
            "H#H##H#H##H#H##H#H##H#H##H#H",
            "H.H##H.H##HPH##HEH##H.H##H.H"
        ],
        // Level 141
        [
            "----------........----------",
            "H.........########.........H",
            "H.......############.......H",
            "H...E..##############..E...H",
            "H.@@@@################@@@@.H",
            "H........##########........H",
            "H.@H........####........H@.H",
            "@@@H....................H@@@",
            "...H..$..$..$..$..$..$..H...",
            "...H....................H...",
            "...H........####........H...",
            "...H.....###TTTT###..P..H...",
            "...H..###TTTTTTTTTT###..H...",
            "...H...TTTTTTTTTTTTTT...H...",
            "...H....TTTTTTTTTTTT....H...",
            "...H......TTTTTTTT......H..."
        ],
        // Level 142
        [
            "-----------.................",
            "...........H.....#...-.-....",
            "..$..$..$.EH----.####.H.####",
            "###########.....H####.H.T###",
            "$$.......$$.----H####.H.T###",
            "##$.....$##H.....#.##.H.T$$#",
            "###$...$###H----.#.##.H.T###",
            "####$.$####.....H#.##.H.T$$#",
            "#####$#####..E..H#.##.H.T###",
            "###########H######$$#.H.T$$#",
            "...........H.....####.H.T###",
            "#-#....P...H.........EH.T$$#",
            "#-###########H##########T###",
            "#-....###$###H#####$........",
            "#-....####$##H##$.$##H.....$",
            "#-$..$#####..H..############"
        ],
        // Level 143
        [
            "########-###################",
            "P.@..@@@-...@H.#...H-------.",
            "#H...H.@H@@.@H$#H@@H........",
            "$H@@#H.@H@@..H..H.........$.",
            "##H..H.@H..###H@H-----......",
            "$@H##@$@H##---H@H.......####",
            "..H....@H@.$@.H@##...$......",
            ".EH..$.@H@####H@.H.......E..",
            "@@##H#.@H@....H--H@@@@@@@@@@",
            "H..@H#..H@######.H...@-----@",
            "H#..H###H@.$#$..###H.@.H...@",
            "H@.H@@.@H@..#......H...H...@",
            "H@.H@.$@H...###########H@..@",
            "H.###.@@H@###..........H...@",
            "H....E..H@$.@H.$....$..H...@",
            "#########@##$H@@####@@@H..$@"
        ],
        // Level 144
        [
            "............................",
            ".....----......---....-...--",
            "H...H..-#@@@@@@...####.@@H..",
            "H$..H$..#...@$...........H.$",
            "##H-@@H.@H..@@#@.TTTT##.H#T#",
            ".$H.E$H.@H..@$..........H...",
            "H##-H@@.@HH.@@#H.T....T.H...",
            "H$..H$..@.HH..@H..#$$#..H...",
            "##H-@@H.@..HH.@H...##H--H.$.",
            "E$H..$H.@...HH@H.....H..##T#",
            "H##-H@@.@....H@H..E..H......",
            "H$..H$E.@.....@H@@@@@@@@H.$.",
            "##H-@@H.@.....@H#..$.$.#H#T#",
            ".$H..$H.@.....@H#H#@#@##H...",
            "H##-@@@.@E$$H#.H#H.$.$..H...",
            "H.P.....######@@##@#@#@#@#@#"
        ],
        // Level 145
        [
            "......E...-.......-...E.....",
            "...........-.....-..........",
            "............-...-...........",
            "..........$###H###$.........",
            "..........#$#$H$#$#.........",
            "..$......#$H.H#H.H$#....$.$.",
            "..##H#H######H.H######H#H##.",
            ".$#.H#H......HHH......H#H$#.",
            ".#.HH#HHHHHHHHHHHHHHHHH#HH.#",
            ".#HE$.#HHHHHHH#HHHHHHH#.$EH#",
            "..###H.#H.$..H.H..$.H#.H###.",
            "...$##H#######H#######H##$..",
            "...##.H.....$.H.$.....H.##..",
            "...#.H##HHHHHH#HHHHHH##H.#..",
            ".$..H###HHH#HHHHH#HHH###HP$.",
            "############################"
        ],
        // Level 146
        [
            "#....-.....P....-....#.$....",
            "####H.##########.H####.####H",
            "####H.#..#####.#.H####...$.H",
            "#$##H.#.#####..#.H##$#.H####",
            "####H.#..#####.#.H####.H$...",
            "##$#H.#.#####..#.H#$##.####H",
            "####H.#..#####.#.H####....$H",
            "#$##H.#.#####..#.H####.H####",
            "####H.#..#####.#.H.###.H.$..",
            "##$#H.#.#####..#.H####.####H",
            "####H.#...####.#.H#$##..$..H",
            "#$##H.#$#####$$#.H####.H####",
            "####H.##########.H##$..H..$.",
            "##$#H.##########.H####.####H",
            "####H..E.....E...H####..E..H",
            "############################"
        ],
        // Level 147
        [
            "................-...........",
            ".E-.........-P..-.....-.....",
            ".H.H.......H.H..-....H.H...H",
            "H..HH.....H...H.-...H...H..H",
            ".#$H.H...H.#$#.H-..H.#$#.H-H",
            ".##H..---HE###.H---HE#H#...H",
            "@##H##T##@##@##@##T##@H#T##H",
            "#..H..T..#..$###..$#.#H.T..H",
            "#--H--T--#.H#----H----H-#--H",
            "#..H..T..#.H#..#.HTH.#E.$..H",
            "#T@H#@#T@##H##@##@TH@##@#T#H",
            ".T####...##H##...#TH##...T#H",
            "...H---.--#H#--.--TH#--.--#H",
            "..#H#..$..#H#..$..#H...$..#H",
            ".$#H#..@..#H#..@..#H#..@..#H",
            "#T.H.T#@##.H.##@##.H.##@#T.H"
        ],
        // Level 148
        [
            "............................",
            "..........EE.--.EE..........",
            ".........$$$-##-$$$.........",
            "...$$$$$-@@@@@@@@@@-$$$$$...",
            "..-######..........######-..",
            "..---..................---..",
            "....-..................-....",
            "....-..................-....",
            "....-..................-....",
            "....-..................-....",
            "....-..................-....",
            "....-..................-....",
            "....-..................-....",
            "....-..................-....",
            "....-..........P.......-....",
            "@######@#####@@#####@######@"
        ],
        // Level 149
        [
            "............................",
            ".........H##....##H.........",
            "........H##......##H........",
            ".......H##........##H.......",
            "......H##$..E.....$##H......",
            "..$--H################H--$E.",
            ".H#H...##$........$##...H#H.",
            ".HH#H...##.$....$.##...H#HH.",
            ".$HH#HE..####..####...H#HH$.",
            "..$HH#H...###..###...H#HH$..",
            "...$HH#H...##$P##...H#HH$...",
            "....$HH#H...####...H#HH$....",
            ".....$HH#H...HH...H#HH$.....",
            "......$HH#H..HH..H#HH$......",
            "$..E...$H##H.HH.H##H$...E..$",
            "############################"
        ],
        // Level 150
        [
            ".----........EP........----.",
            "H....##H$..........$H##....H",
            "H....##H$..........$H##....H",
            "H.....##H$........$H##.....H",
            "H$.$..##H$........$H##..$.$H",
            "H####H.##H$......$H##.H####H",
            "H$..$H.##H$......$H##.H$..$H",
            "H#####H.##H$....$H##.H#####H",
            "H$E.E$H.##H$....$H##.H$E.E$H",
            "H######H.##H$..$H##.H######H",
            "H$....$H.##H$..$H##.H$....$H",
            "H#######H.##H$$H##.H#######H",
            "H$.....$H.########.H$.....$H",
            "H########H.###T##.H########H",
            "H$......$H.$$#T$$.H$......$H",
            "#############@@##-##########"
        ]
    ];


    // ============================================
    // CHAMPIONSHIP LODE RUNNER (1984) - 50 levels
    // ============================================

    const CHAMPIONSHIP_LEVELS = [
        // Championship Level 001
        [
            "............................",
            "H--------------------------H",
            "H.$..$.$$$$.$....$.....$$..H",
            "H.$..$.$....$....$....$..$.H",
            "H.$$$$.$$$..$....$....$..$.H",
            "H.$..$.$....$....$....$..$.H",
            "H.$..$.$$$$.$$$$.$$$$..$$..H",
            "H.......................E.EH",
            "H--HHH---HHH---HHH--HHHH---H",
            "HP-...-.-...-.-...-.-...-..H",
            "H#H#....-...-.-...-.-...H##H",
            "H#-.#HH.-...-.-...-.-###-.#H",
            "H#-...-#H#..-.-...H#H...-.#H",
            "H#.----..-HH#$$HHH..----..#H",
            "H#........................#H",
            "############################"
        ],
        // Championship Level 002
        [
            "$E....@@....-$-...E......P.$",
            "H-----@-@----H----@@-------H",
            "H----$@--@---H----@-@------H",
            "H---@@@------H---$@--@-----H",
            "H---@@@------H--@@@--------H",
            "H------------H--@@@--------H",
            "HE...$$$.....E............EH",
            "H............$.........$$..H",
            "H------------H---------@@--H",
            "H--------@@--H---------@-@-H",
            "H--------@-@-H--------$@--@H",
            "H-------$@--@H-------@@@---H",
            "H------@@@-----------@@@---H",
            "H......@@@........$$$......H",
            "H..........................H",
            "H$$$$$$$$$$$$$$$$$$$$$$$$$$H"
        ],
        // Championship Level 003
        [
            "HHHHH$HHEHHHHHHHHPHHH......-",
            "HHHHHHHHHHHHHHHHHHHHH@.....-",
            "HHHHHHHHHHHHHHHHHHHHH@.....-",
            "$HHHHHEHHHH$HHHHHHHHH@######",
            "HHHH@@@@@@@@@@@@@@@@@@@@@@@@",
            "HHHHHHHHHHHHHHHHHHHHHHHHHHHH",
            "HHHHH$HHHHHHHHEHH$HHHHHHHHHH",
            "@@@@@@@@@@@@@@@@@@@@@@@@HHHH",
            "HHHHHHHH$HHHHHHHHHH$HHH@HHH$",
            "HHHHHHHHHHHHHHHHHHHHHHH@HHHH",
            "HHHHHHHHHHHHHHHHHHHHHHH@HHHH",
            "HHHH$HHHHHHHHH$HHHHHHH$@$HHH",
            "HHHH@@@@@@@@@@@@@@HHHHH@HHHH",
            "HHHHHHHHHHHHHHHHH@HHHHHHHHHH",
            "HHHHHHHHHHHEH$H$H@HHHHHHHHHH",
            "@@@@@@@@@@@@@@@#@@H$HHHHHHH$"
        ],
        // Championship Level 004
        [
            ".............H..............",
            "----------------------------",
            "............$-$............H",
            "......$....H#H#....E$......H",
            "H@@@@@@@@@@@@H@@@@@@@@@@@@@@",
            "H............-..............",
            "H...........$-$.............",
            "H.E...$....##H##H...$....E..",
            "@@@@@@@@@@@@@H@@@@@@@@@@@@@H",
            ".............-.............H",
            "............$-$............H",
            "......$..H###H###...$....E.H",
            "H@@@@@@@@@@@@H@@@@@@@@@@@@@@",
            "H............-..............",
            "H...........$-$.............",
            "H.....$P.####H####H.$....E.."
        ],
        // Championship Level 005
        [
            "###########################.",
            "###########################-",
            "P.............$.#..........-",
            "H@#@#@#@#@#@#.#.###########H",
            "H@#@#@#@#@#@#@#.#.#######.#H",
            "H............$..#.#######.#H",
            "H#@#@#@#@#@#.#..#.#-###-#.#H",
            "H#@#@#@#@#@#@#..#.#-###-#.#H",
            "H...........$...#.#-#.#-#.#H",
            "H@#@#@#@#@#.#...#.#-#.#-#.#H",
            "H@#@#@#@#@#@#...#.#-#.#-#.#H",
            "H..........$....#.#-#.#-#.#H",
            "H#@#@#@#@#.#....#$#$#$#$#$#H",
            "H#@#@#@#@#@#....#T#########H",
            "H......................EEEEH",
            "H###########....############"
        ],
        // Championship Level 006
        [
            "H--------------------------H",
            "H#.#..#.#.....$..###.#.#...H",
            "H###..###...#.#..#.#.###...H",
            "H...$...$...###.....$.....PH",
            "H.#.#..###.......$.###..#.#H",
            "H.###..#.#$....###.#.#..###H",
            "H$...$....#.#..#.#....E....H",
            "H#.#.#.#..###.......$.#.#..H",
            "H###.###......$...#.#.###..H",
            "H...$....$..#.#...###....$.H",
            "H.#.#...###.###..$.....#.#.H",
            "H.###...#.#......#.#...###.H",
            "H....$.....#.#...###...E...H",
            "H..#.#.#.#.###$.$.....###..H",
            "H..###.###....#.#.....#.#..H",
            "H.EEE.$.......###...$.....$H"
        ],
        // Championship Level 007
        [
            "HHHHHHHHHHHHHHHHHHHHHHHHHHHH",
            "H..........................H",
            "H............$$............H",
            "H...........$TT$...........H",
            "H...........#TT#...........H",
            "H........$.$#TT#$.$........H",
            "H........#$#.$.##$#........H",
            "H.....$.$###.#$.###$.$.....H",
            "H.....#$###.$##$.###$#.....H",
            "H.....####..####..####.....H",
            "H..$.$##.$.$#.##$.$.##$.$..H",
            "H..#$##..#$##..##$#..##$#..H",
            "H..#T.$.$###....###$.$.T#..H",
            "H..##.#$###......###$#.##..H",
            "H..##.###..$$$$$$..###.##..H",
            "H...P.....H######H....EEEE.H"
        ],
        // Championship Level 008
        [
            "H$H##H$H@@H$H##H$H@@H$H##H$H",
            "H@@H.H##H.H@@H.H##HEH@@H.H#H",
            "HHEH@@H.H##HEH@@H.H##H.H@@HH",
            "HH##H.H@@H.H##H.H@@H.H##H.HH",
            "H@H.H##H.H@@H.H##H.H@@H.H##H",
            "H.H@@H.H##H.H@@H.H##H.H@@H.H",
            "H##H.H@@H.H##H.H@@H.H##HEH@H",
            "HH.H##H.H@@H.H##H.H@@H.H##HH",
            "HH@@H.H##H.H@@H.H##H.H@@H.HH",
            "H#H.H@@H.H##H.H@@H.H##H.H@@H",
            "H.H##H.H@@H.H##H.H@@H.H##H.H",
            "H@@H.H##H.H@@H.H##H.H@@H.H#H",
            "HH.H@@H.H##HEH@@H.H##H.H@@HH",
            "HH##H.H@@H.H##H.H@@H.H##H.HH",
            "H@H.H##H.H@@H.H##H.H@@H.H##H",
            "HPH@@H$H##H$H@@H$H##H.H@@H$H"
        ],
        // Championship Level 009
        [
            "############-.#.-##########-",
            "##.EHHH.HH.E-...-EHH..HH.E#-",
            ".$##..$#.$#HH...H#$.##$.##$-",
            "$##..$#.$#HH....H##$.##$.##-",
            "##..$#.$#HH.$.P.H.##$.##$.##",
            "#..$#.$#HH.$####H$.##$.##$.#",
            ".$.#.$#HH.$##..##H$.##$.##$.",
            "H##.$#HH.$##.$$.##H$.##$.##.",
            "H#.$#HH.$##$H##H$##H$.##$.##",
            "H.$#HH.$##$H#..#H$##H$.##$..",
            "H$#HH.$##$H#.$$.#H$##H$.##$E",
            "H#HH.$##$H#.$##$.#H$##H$.##H",
            "HHH.$##$H#.$####$.#H$##H$.#H",
            "HH.$##$H#.$##$$##$.#H$##H$.H",
            "H$.##$H#.$...##...$.#H$##H$H",
            "##H.$#H.############.H#.$H##"
        ],
        // Championship Level 010
        [
            "H---..####...$HH..########..",
            "H..$##$###..$H..$##.......#.",
            "H.$####$##.$H..$##$H#######.",
            "H$######$#.H$.-##$H.....##..",
            "H#########.$H.-#.H.......##.",
            "H.--$$#$$#.H$.-#H........$#.",
            "H$..##$##$.$H.-#H#.......H#.",
            "PH..$##$##.H$.-#H#$H#$H#$H#.",
            ".#H.##$##$.$H.-#H@@@@@@@@@#.",
            "E#H.$##$##.H$.-#H.........#.",
            ".#H.##$##$.$H.-######H#####.",
            ".#H.$##$##.#H.-##$..#H#..$#.",
            ".$H.##$##$#.H.-..#.E#H#..##.",
            ".#H..#####..H..##.###H####..",
            "..H---.#####....#HHHHH###...",
            "..-........................."
        ],
        // Championship Level 011
        [
            "H--------------------------H",
            "H...P......................H",
            "H.#####.#####..#####.#####.H",
            "H.#.$.#.#.$.#..#.$.#.#.$.#.H",
            "H.#@###.#####..#####.#@###.H",
            "H...#.....#......#.....#...H",
            "H.###@#.#####..#####.###@#.H",
            "H.#.$.#.#.$.#..#.$.#.#.$.#.H",
            "H.#@###.#####..#####.#@###.H",
            "H...#.....#......#.....#...H",
            "H.###@#.#####..#####.###@#.H",
            "H.#.$.#.#.$.#..#.$.#.#.$.#.H",
            "H.#####.#####..#####.#####.H",
            "H...#.....#......#.....#...H",
            "HE........#......#........EH",
            "############################"
        ],
        // Championship Level 012
        [
            "-..------------------------H",
            ".#-..T.E.#...#.E.#...#...#.H",
            "..$T-.$#$.$T$.$#$.$T$.$#$..H",
            "T.#T#-###.#T#.##T.TT#.###..H",
            "...#.-.#...#...#...#...#...H",
            "$#$.$T-.-T-.$#$.$T$.$T$.$#$H",
            "T##.###-##T-T##.#TT.###.###H",
            ".#...#.E.#.-.#.E.T...#...#.H",
            "..$T$.$#$.$T-.$T$.$#$.$#$..H",
            "T.###.###.###-###.T##.T#T..H",
            "...#...#...#.-.#...#...#...H",
            "$#$.$#$.$T$.$#-.$#$.$#$.$#$H",
            "T##.###.###.###-##T.###.##TH",
            ".#.$.#.$.#.$.#.-.#.$.#.$.#.H",
            "P.H#H.HTH.H#H.-#..H#H.H#H.EH",
            "##H.H.H.H.H.H.H.H.H.H.H.H##H"
        ],
        // Championship Level 013
        [
            "@.@@@@@@@@@@@@@@@@@@@@@@@@@-",
            "@-PH.H$H.H$H.H$H.H$H.H$H.H@-",
            "@@@H@@@@@@@H@@@@@@@H@@@@@H@-",
            "@H@H$H.H$H@H$H.H$H@H$H@H@H@-",
            "@H@@@@@@@H@H@@@@@@@@@H@H@H@-",
            "@H$H.H$H@H@H@H$H.H$H@H@H@H@-",
            "@@@H@@@@@H@H@H@@@@@H@H@H@H@-",
            "@H@H@H.H$H@H@H@H$H@H@H.H$H@-",
            "@H@H@H@@@@@H@H@H@H@H@@@@@H@-",
            "@H$H.H$H@H$H@H$H@H@H.H$H@H@-",
            "@H@@@@@H@H@H@@@H@H@@@@@H@H@-",
            "@H@H$H.H@H@H$H@H@H.H$H@H@H@-",
            "@H@H@@@@@@@@@@@H@H@@@H@H@@@-",
            "@H@H.H$H.H$H.H$H@H@H@H@HEH@-",
            "@H@@@@@@@@@@@@@@@H@H@H@@@H@-",
            "@HEH$H.H@H.H$H.H$H@H$H.H@H.."
        ],
        // Championship Level 014
        [
            "...P...E...E...E...E...E...-",
            "###H#T#H###H#T#H###H#T#H###H",
            "###H#T#H###H#T#H###H#T#H###H",
            "###H#T#H###H#T#H###H#T#H###H",
            "HHHHHHHHHHHHHHHHHHHHHHHHHHHH",
            "###H#T#.#T#H###.#T#H#T#.###H",
            "###H#T#.#T#H###.#T#H#T#.###H",
            "###H#T#$#T#H###$#T#H#T#$###H",
            "HHHHHHHHHHHHHHHHHHHHHHHHHHHH",
            "#T#.###H#T#.###H#T#.###H#T#H",
            "#T#.###H#T#.###H#T#.###H#T#H",
            "#T#$###H#T#$###H#T#$###H#T#H",
            "H$HHH$HHH$HHH$HHH$HHH$HHH$HH",
            "###H###H###H###H###H###H###H",
            "###H###H###H###H###H###H###H",
            "###H###H###H###H###H###H###H"
        ],
        // Championship Level 015
        [
            "E...........................",
            "P$..$..$..$..$..$..$..$..-..",
            ".H-.H-.H-.H-.H-.H-.H-.H-.H-.",
            ".H..H..H..HE.H..H..HE.H..H..",
            ".H..H..H..H..H..H..H..H..H..",
            ".H..H..H..H..H..H..H..H..H..",
            ".H..H..H..H..H..H..H..H.-H..",
            ".H..H..H..H..H..H..H.-H.....",
            ".H..H..H..H..H..H.-H........",
            ".H..H..H..H..H.-H.....#####H",
            ".H..H..H..H.-H.....#$######H",
            ".H..H..H.-H.....###########H",
            ".H..H.-H.....##############H",
            ".H.-H.....#.###############H",
            "-H.....####################H",
            ".-..#######################H"
        ],
        // Championship Level 016
        [
            "HHHH..HHHHHHHHHHHHHHHHHHHHHH",
            "H..$##..@@.$.@H$E.@@$..@H.$H",
            "H.$##.....@@E$.@H$..@@$..@HH",
            "H$##......$.@@.$.@H$..@@$..H",
            "H##......H##..@@.$.@H$..@@$H",
            "H@.$....HT#.....@@.$.@H$..@H",
            "H.@@.$.H#T........@@.$.@H$.H",
            "H$..@#.##..........$@@.$.@@H",
            "H@H$..@@.$.......H##..@@.$.H",
            "H$.@H$..@@.$....HT#.....@@PH",
            "H@$..@H$E.@@.$.H#T.......$#H",
            "H.@@$E.@H$..@#.##......$#@@H",
            "H$..@@.$.@H$..@@.$....$#@..H",
            "H@H$..@@$..@H$..@@.$.$#@...H",
            "HE.@H...@@...@H...##.##....H",
            "HHHHHHHHHHHHHHHHHHHH#######H"
        ],
        // Championship Level 017
        [
            ".........-........-.........",
            "....$....-........-.........",
            "...H@#HE.-........-..H#@H.$.",
            "H@#H..H@@H........H@@H..H@@H",
            "HP.$..$..H#@H.$H#@H..$..$..H",
            "@@H.$....$.-H@@H.........H@#",
            "..H#@HE.H@@-$..H@@H...H@#H.$",
            "H@@$.H#@H......$..H-@@H$.H@@",
            "H....$..H#@HE...H@#-..H#@H..",
            "H#@-....$..H@@-.H..$..H..E..",
            ".$.-@@H..H@@..-#@H....H@#@H.",
            "......H@#H....$..H@@H...$.H.",
            "...H@#H.$H@@H.......H#@H..H.",
            "H@@H..H#@H..H@#H.H@#H$.H@@H.",
            "H..-..-.E-..-$.-$-..-..-.$-.",
            "H@@@@@@@@H#.@@#@@H#.@@@@@@@@"
        ],
        // Championship Level 018
        [
            "###########################.",
            "P.-..#H...##H...##H...##.##H",
            "##-###H###-#H###-#H###-#.##H",
            "##-#T#H###-#H###-#H#$#-#.##H",
            "##-#T#H##-.#H###-#H#T-.#.##H",
            "##-#T#H.-.##H...-#H...#####H",
            "##-#T#H.####H#T#-#H####.#.#H",
            "##-#T#H#.###H###-#H####.#.#H",
            "##-#T#H##$##H###-#H####$..#H",
            "##-#$.H#TT..H#$#-.H#.$###.#H",
            "###T#########T##T###T######H",
            ".---.-------------------E.EH",
            "-.....--..-.--.-.--.-..-.E.H",
            ".--..-..-.--...--....--....H",
            "...-.-..-.-....-.....-.....H",
            "---...--..-....-....-....-.H"
        ],
        // Championship Level 019
        [
            "........--.@..-..@@@...-..@@",
            "#H@$#@@H..#$#@.H#...$#@.H-$.",
            "#H.##$.@H..@@..H#$..#@.H..#.",
            "#@@@@#..@H...EH@#.@##.H..#@.",
            "$....#@@@H#@@@#@@#@@.H..#@@.",
            "T.H@.....H#.--...----H.##$@.",
            "T@H.@@#@@#@.$.@#...@T@..#@@.",
            ".@@H..-...@@#@@@#.@@$@@..@@.",
            "..@@H..@#$@....$#@@@T@@@..@.",
            "--.@@H..@#....@@@.---H.@@$..",
            "$.H.@@H..........H....H.@@..",
            ".#H...@H..H#@H----....@H.@@.",
            ".#H@##.@H#@#.H.E...#E@..H...",
            "@#.$##@.H@$##@@#-.#@#..HT-..",
            "@@@###.H#@@##.$#-#$@..H@$@-$",
            "@$..#H@H..P#@@.@-@#..H..T.-@"
        ],
        // Championship Level 020
        [
            "-...........................",
            "-$....E.......------------$$",
            "H@------------.$$$$$$$$.$$@H",
            "H@T#######T###T###T####T##@H",
            "H@.$..E..$..$.....$.....$.@H",
            "H@.@@@@@@@@@@@.###T####T##@H",
            "H@.$$$E$$$$$.@.@.$$$$$$$$.@H",
            "H@.#########.@.@.########.@H",
            "H@.$..E..$..$..@..$.....$.@H",
            "H#H###########T##########H#H",
            "H#H$..E..$..$..$..$..$...H#H",
            "H#############.@@@@@@@@@@##H",
            "H..$..P..$..$@.$..$..$..$..H",
            "H#############.##########.#H",
            "H..$..$..$..$@.$..$..$..$..H",
            "H#############.############H"
        ],
        // Championship Level 021
        [
            "###########################-",
            "####--------#---------....#-",
            "###.....P...#....E....H#..#-",
            "###...####..#########.H#..#-",
            "##...#####..###$##$##.H#..#-",
            "##.....$##..#$#####$#.H#..#-",
            "#....E......###$####$.H#..#-",
            "#...####....#$####$##.H#..#-",
            "#T######@@..###$#$###.H#..#-",
            "#T#$$$$$#HH.#$#####$#.H#..#-",
            "#T######HH.####$####$.H#..#-",
            "#T####....###$####$##.HT..#-",
            "#T####H#.############.H####-",
            "#.....H.#.###.........H#..#-",
            "#....H.###.#..........H#.$#-",
            "###########.#############T--"
        ],
        // Championship Level 022
        [
            "@@.@@@@@@@@@@-@@@@@@@@@@@.@@",
            "#H$$$$$$$$$$$-P$$$$$$E$$$$H#",
            "@H@@@@@@@@@@@H@@@@@@@@@@@@H@",
            "#H@E$$$$$$$H.H.H$$$$$$$$.@H#",
            "@H#$@@@@#@@H$H$H@@#@@@@@$#H@",
            "#H@$#H$$$E@HHHHH@.$E$$.#$@H#",
            "@H#$@H@@@T@@HHH@@T@@@@H@$#H@",
            "#H@$#H@.$$$$HHH$$$.$H@H#$@H#",
            "@H#$@H#$@@@@HHH@@@$@H#H@$#H@",
            "#H@$#H@$$.$$HHH$$E$$H@H#$@H#",
            "@H#$@H@@@T@@HHH@@T@@@@H@$#H@",
            "#H@$#H$$$$#HHHHH#$$$$$H#$@H#",
            "@H#$@@@@@@@H@$@H@@@@@@@@$#H@",
            "#H@$$$$$$$$H#$#H$$$$$$$$$@H#",
            "@H@@@@@@@@@@@$@@@@@@@@@@@@H@",
            "#H$$$$$$$$$$$$$$$$$$$$$$$$H#"
        ],
        // Championship Level 023
        [
            "###########################.",
            "#P.#..#.....#..#...--.--.--H",
            "#$.#...$H#...$.#..#.$#..#$.H",
            "####H###############.##H###H",
            "#..#H$#..#.$#..#.$...#$H#..H",
            "#..#H....#..#....H#----H#..H",
            "#####H#####################H",
            "#..#.H#..#..#.$#...$.#$H#..H",
            "#.$..H#$.......#..#H..HH#$.H",
            "#.#########################H",
            "#..#..#..#$H#..#....H#..#..H",
            "#...$.#..#..#...$H#..#..#..H",
            "#.##H########H#############H",
            "#.$#H.#..#...H$#..#$....#..H",
            "#..#H..$....#H......-#....$H",
            "############################"
        ],
        // Championship Level 024
        [
            "H----------------.E####.----",
            "H-----.E.-------.#######.---",
            "H---..###..----.########.---",
            "H--.#######..-.#######..----",
            "H-.#..#######.######...-----",
            "H-.#.$.############.#####.--",
            "H--.###.##########.########.",
            "H-------.##########.########",
            "H.......############.#######",
            "H......###$###$######.######",
            "H......##############.######",
            "H...-----########-----######",
            "H....----##...###------#####",
            "H--.###-####H#####.####.####",
            "H..#$##-..######..######.###",
            "HPHTH###-........##H#H##.###"
        ],
        // Championship Level 025
        [
            "##########HHHHHHHH##########",
            "#######HHHHEE...PHHHH#######",
            "######HH...######...HH######",
            "#####HH.#####-######.HH#####",
            "####HH.######--#.#$##.HH####",
            "###HH.##$####--#######.HH###",
            "###H.####E...--...E####.H###",
            "###H.########--########.H###",
            "###H.#####--#--#--#####.H###",
            "###H.####--##--##--####.H###",
            "###HH.##-.##.--###$-##.HH###",
            "####HH.######.-######.HH####",
            "#####HH.######.#####.HH#####",
            "######HH...######...HH######",
            "#######HHHH......HHHH#######",
            "##########HHHHHHHH##########"
        ],
        // Championship Level 026
        [
            "#####HHHHHHHHHHHHHHHHH######",
            "####HH...............HH#####",
            "###HH.....P......E....HH####",
            "##HH..H######H######H..HH###",
            "##H...H#..$.#H#.$..#H...H###",
            "##H---H@$...#H#...$@H---H###",
            "##H$$$H##.###H###.##H$$$H###",
            "##H$$$H.#.T@@@@@#.#.H$$$H###",
            "##H...H.###.....###.H...H###",
            "##H---H.....$$$.....H---H###",
            "##H...H.###########.H...H###",
            "##HE......$HHHHH$.....EH####",
            "###H....TT#TTTTT#TT...H#####",
            "####HE..............EH######",
            "#####H..............H#######",
            "######H$$$$$$$$$$$$H########"
        ],
        // Championship Level 027
        [
            "...@E.........@.............",
            "...@H@@@@@@@@.@.............",
            "...@H@@.......@.............",
            "...@H@@.@@@@@@@.............",
            "....H.H.....................",
            "....H.H.....................",
            "....H.H.....................",
            "....H.H.@@@@@@@@@@@@@@@@@@@-",
            "....H.$$@$$$$$$$$$$$$$$$$$$H",
            "....H.@@@@@@@@@@@@@@@@@@@@@@",
            "....H.......................",
            "....H.$$$$$$$$$$$$$$$$$$$$$H",
            "....H.@@@@@@@@@@@@@@@@@@@@@@",
            "....H.......................",
            "....H.$$$$$$$$$$$$$$$$$$$$$H",
            "P...H.@@@@@@@@@@@@@@@@@@@@@@"
        ],
        // Championship Level 028
        [
            "...P...........E............",
            "##-#####T#########-#########",
            "..-...#..........#-.........",
            "-##########T##########T###-#",
            "-.........#............#..-.",
            "####-###############T###..-.",
            "....-------------.........-.",
            "....-.H..........###...####H",
            "####--H###########......---H",
            "####-.H................-...H",
            "##E#-.#####H#######....-...H",
            "####-......H.........$.-..H#",
            "##E#-.##H######.H##H.#.-.H##",
            "####-...H.......H..H....H###",
            "#$$#....H.......H..H....H###",
            "############################"
        ],
        // Championship Level 029
        [
            "HHH#H............H#P.E#EHHHH",
            "T#T#H.$.$.$.$....H###$##T##H",
            "H#T#H.HHHHHHHH..$HHH#$E$$E#H",
            "H#HHH.H#T#TTTH...$.H#####$##",
            "H##HH.H#--$$THHHHH.HHHHH#$$E",
            "T##H$.H#$--#T#TT#H.$.$.H#T##",
            "HHHHH.H#--$#T-$$#HHHHH.HHHHH",
            "H###H.H###T#T--##T#T#H..$$$-",
            "H$$#H.HHHHH#$$$##$--#H.$HHHH",
            "HHH#H$....H#T####--$#H..$HTT",
            "HTH#H.....HHHHH#$$$$#H..$HTH",
            "HTH#####H$....H####T#H.HHHTH",
            "HTHHHHH#H.....HHHHHHHH.H#TTH",
            "HT##T#H#T###H$..$...$.$H#HHH",
            "HHHH$#HHHH###HHHH...HHHH#H#T",
            "TTTTH###$HHH#TTTH$.$HTTT#H#H"
        ],
        // Championship Level 030
        [
            "##############-#############",
            "#....E.$.E..P---..E.$.E....#",
            "#-###########...##########-#",
            ".H------------------------H.",
            ".H...........-............H.",
            ".H...........-............H.",
            ".H...........-............H.",
            ".H...........-............H.",
            ".H...........-............H.",
            ".H...........-............H.",
            ".H...........-............H.",
            ".H...........-$...........H.",
            ".H.....$......@......$....H.",
            ".H.....@......@......@....H.",
            "H......@......@......@..E..H",
            "H#####...####.@.####...####H"
        ],
        // Championship Level 031
        [
            ".---------------------------",
            ".H##T###T###T###T###T###T##H",
            ".H#---#...#--.#.--#...#---#H",
            ".H#T#T#T#T#T#T#T#####T#T#T#H",
            ".H#....#---#...#...T---#..#H",
            ".H##T#T#T#T#T#T#T###T#T#T##H",
            ".H#...#...#---#---#...#...#H",
            ".H#T#T#T###T#T#T#T#T#T#T#T#H",
            ".H#..T..H#---#---#...#....#H",
            ".H##TTT#T#T#T#T#T#####T#T##H",
            ".H#...#---#...T...#H--#...#H",
            ".H#T#T#T#T#T#TT######T#T#T#H",
            ".H#---.#...#...#H..#...#--#H",
            ".H##T#T#T#T#TTTTT#T#T#T#T##H",
            ".HPEE.........$.........EEEH",
            ".############-.-############"
        ],
        // Championship Level 032
        [
            ".-............P...........-.",
            ".H.H##########@@@@@@@@@@@.H.",
            ".H.H#...................H.H.",
            ".H.H@$#H#.......$.E..$H#H.H.",
            ".H.H@@@@@@@@@@@@@@@@@@##H.H.",
            ".H..H#..............---H..H.",
            ".H..H#$.E.E.E...$#H#.$#H..H.",
            ".H..H#######@@@@@@@@@@#H..H.",
            ".H---H---............#....H.",
            ".H...H#$.#H#....$$...@H...H.",
            ".H...H######@@@@@@@@@@H...H.",
            ".H....H@..................H.",
            ".H....H@$E.#H#H.$$..#H....H.",
            ".H....H@#@@@@@@@@@@@#H....H.",
            ".H........................H.",
            ".H........................H."
        ],
        // Championship Level 033
        [
            "-------------H$-------------",
            ".$.$E$.......$H.......$P$.$.",
            "########.....H$.....########",
            "##.....##....$H....##.....##",
            "#-#....#.#...H$...#.#....#-#",
            "#--#...#..#..$H..#..#...#--#",
            "#---#E.#...#.H$.#...#.E#---#",
            "#----TT###T##$H##T###TT----#",
            "#----T.#....#H$#....#.T----#",
            "#####T##$...#$H#...$##T#####",
            ".#HHHTHH#$..#H$#..$#HHTHHH#.",
            "..#HHTHHH#$.#$H#.$#HHHTHH#..",
            "H..#HTHHHHT$#H$#$THHHHTH#..H",
            "HH..#THHHHHT#$H#THHHHHT#..HH",
            "..H..TT####T#H$#T####TT..H..",
            "##HH.........$H.........HH##"
        ],
        // Championship Level 034
        [
            ".-..-............E..........",
            "@-.H..#H..........@--------T",
            ".H@H#@@@@##@H###@H.H.......H",
            "H@@@H.-.@.$.@H##@H..@...@..H",
            "H@$..H$.$@HE-HH#@H--$...$-@H",
            "H@@H.H.H@@H..@@H@H..@.$-@..H",
            "H$@H.H.@$.H..$@H@H--$.@.$-@H",
            "H@$H-H@@H.H.$H@H@H..@-$.@..H",
            "H$@H.@$.H.H.TH.H@H--$.@.$-@H",
            "H@$H@@H.H.H.@$@H@H..@.$-@..H",
            "H@@@$.H.H.H.$T$H@H--$.@.$-@H",
            "H$@@H.H.H.H.H@@@.H..@-$.@..H",
            "@@$.H.H.H.H.H@..#H--$.@.$-@H",
            "@.H.H.H.H.H.H.#H@H..@...@..H",
            "$@H@H@H@H@H.@@@.PH@-....EE.H",
            "H.H.H.H.H.H....#H@@@####@@#@"
        ],
        // Championship Level 035
        [
            "-..........................-",
            "-..$..E.$.......$....$..E.$-",
            "@@@@@@@@@@#H..H#@@@@@@@@@@@@",
            "...........H..H.............",
            "...........H##H.............",
            "$..E$....$.H..H......$..E.$.",
            "#@#@#@#@#@#@HH@#@#@#@#@#@#@#",
            "............HH..............",
            "------....$.HH...$..--------",
            "......H@@@@@@@@@@@@H........",
            "......H............H........",
            ".$.E..H.$.....$....H...$E.$.",
            "@@@@T#######HH#######T@@@@@@",
            "............HH..............",
            "............HH..............",
            ".$....P$....HH.....$......$."
        ],
        // Championship Level 036
        [
            "..-------------------------.",
            "..-..E......-----.....P...-.",
            "..-#########..H..#########-.",
            "..--H-H-H-H.#HHH#.H-H-H-H--.",
            "..#-H-H-H-H-#H.H#-H-H-H-H-#.",
            "..#-H$H.H$H-#HHH#-H$H.H$H-#.",
            "...#########.HHH.#########..",
            ".............H.H............",
            ".............HHH.....###....",
            ".............HHH....#--H.$..",
            "H#.-----$....H.H...#.$.H###.",
            "H@$.---.#....HHH--.@.#.H--..",
            "H#@#$-.#H#@#@#H#..#....H....",
            "H..#@#@#H...E.H.#@#@#@#@#.$@",
            "@H......@#.#@#H#H...$...$.#@",
            "#@#@H$#H......$.H#@#@#@#@#@#"
        ],
        // Championship Level 037
        [
            "..........................-.",
            ".....H------------------H-..",
            ".....H-.-.-.-.-.-.-.-###H...",
            ".....H.#.#.#.#.#.#...#.#.H..",
            "...H###############..###..H.",
            "...H#.####.#.###.#.T####.H..",
            "...H###############T####H...",
            ".E.H###.#####.#####T####.H..",
            "H##########.####.$.T####..H.",
            "H##-############T##T####...H",
            "H####..$###.####T##T####..H.",
            "H#...H#####.###-T#-T#-##.H..",
            "HT###HT####$.##T##TT####H...",
            "HT#-###--####--T##T--###.H..",
            "HT####----##----##----##..H.",
            "H...HH..E.HH..$.HH.$..HH.P.H"
        ],
        // Championship Level 038
        [
            "PHHHH####.H###H-----####HHHH",
            "H###H-----H###H####.####H##H",
            "H###.##T#EH###H####-----H##H",
            "H.$E$E.$E$H.$.H$.$..$$..$..H",
            "###.@@T#.#HT#H##H#.T#T#.#TH#",
            "###..$T#.#HT#H##H#.$#T#.##H#",
            "#T#.##T#.#HHHH##H#.T#T#.H.HH",
            "$$.$---------..$H.$.$...$.$.",
            "##.TH##E#T##.#T#H.#T#H.##TT.",
            "##.TH##.#T#$-HHHH.#$#H------",
            "##.TH##.#T##.###H.#T#H.####.",
            "$.$.H...$.$..$$.H.$$.H..$$.$",
            "#HTH#THT###.####HT##TH####.#",
            "#HTH##HT###.####HT##TH####.#",
            "#HHHHHHT###.####HT##TH####.#",
            "$H$$$$$$$$$$$$$$H$$$$H$$$$$$"
        ],
        // Championship Level 039
        [
            ".E.........--..........P....",
            "...H#######...######H.......",
            "...H#######...######H-H-.--.",
            "...H....###...###...E.H.-..-",
            "H--H....###...###.....H.-..-",
            "H..H...###.....###....H..--.",
            "H..E..###.......###...H.....",
            "H....###.$$...$$.###..H.-.-.",
            "H....###.##...##.###..H.--..",
            "H....###.........###..H.-.--",
            "H....###..#####..###..H.....",
            "H....###..#####..###..H#@##H",
            "H.....##...###...###..#.$.#H",
            "#####H###..$#$..###---#.#.#H",
            "#.$.#H.###########----##.##H",
            "#.#.#H...##...##...........H"
        ],
        // Championship Level 040
        [
            "............................",
            "H----.......................",
            "H.PE.H###H..---------..H###H",
            "H...#H#####H..-----..H#####H",
            "H..##H#H###H##.....##H###H#H",
            "H..##H#H###H##.###.##H###H#H",
            "H...#H###H####..H..####H###H",
            "H....H###H####.#H#.####H###H",
            "H...#H#H###H##.#H#.##H###H#H",
            "H..##H#H###H##.#H#.##H###H#H",
            "H..##H###H####.#H#.####H###H",
            "H...#H###H####.#H#.####H###H",
            "H....H.H###H##.#H#.##H###H#H",
            "#H..H##H###H...#H#...H###H#H",
            "##HH#####.$...##H##...$.###H",
            "#########################..H"
        ],
        // Championship Level 041
        [
            ".........E....-...........#-",
            "##...H###.....-..#.#-######-",
            "...##H....#-######.###....#-",
            ".....H..#.#####..#.....H#.#-",
            ".#-######........#######..#-",
            ".###....#######.......E..##-",
            "................#..#######.-",
            "####.##...P..####H.#.......-",
            ".......H####.....H.....H###-",
            ".H##...H...$.####H.H####.$.-",
            "#H...###.H###......$....H#T-",
            ".H..$....H.....$.H###...H...",
            ".######H##.#####.H....####H.",
            ".$...E.H.....$...H........H.",
            "###.######H.###..####H..H###",
            "..........H..........H..H..."
        ],
        // Championship Level 042
        [
            ".....----........--E........",
            "....H....#######-..-######..",
            "..H#####.#.....#-..-#....#..",
            "..H#...#####...#P--.#.H#####",
            "H#H###.#...#H..###H##.H#.#.#",
            "H#...#.#...#H...#.H...H###.#",
            "H#..$#.#.#H#######H...H#...#",
            "H#.#####.#H......###H#.#####",
            "H#.#.#.#.###..#H##..H####H..",
            "H#####.###.H#####...H#..#H..",
            "H..#.....#$H.#.#######H.#H$.",
            "H..#..######.#.#.E.#.$H####.",
            "#H###H#.E#.#.#.#...#..H#.E#.",
            "#H..#H#.$#####.#...#####..#.",
            "#H..#H######...#####...#T##.",
            "#####H............#.....T..."
        ],
        // Championship Level 043
        [
            "...###H###........###H###...",
            ".###..H.....####.....H..###.",
            ".#....H######..######H....#.",
            ".##-####............####-##.",
            "..#-.....H###..###H.....-#..",
            "T.#-#####H........H#####-#.T",
            "T@@-@@@@@@@@H..H@@@@@@@@-@@T",
            "T..-...$.#..H..H..#.$...-..T",
            "T@@-@@@@@@H@.--.@H@@@@@@-@@T",
            "...-......H.#..#.H......-...",
            "E#.-.#H.P.H##..##H.E.H#.-.#E",
            ".#####H####H#..#H####H#####.",
            "E....#H##$.H#$$#H.$##H#....E",
            "##..##H.#--H#$$#H--#.H##..##",
            "###...H..##########..H...###",
            "########H..........H########"
        ],
        // Championship Level 044
        [
            "..................P........-",
            ".##H#H#######H#########H###-",
            "...H.#H#.....H.#H#.....H.#.-",
            ".##H##H##.#H####H##-#######-",
            "..H.-.H.....H...H..H.....H.-",
            "..#H..H#..##H..#H#.#H..#.H-.",
            ".#.H..H..-.#H..###..#H###H..",
            ".#H#.#H##$#H#H.....#.H...#H.",
            "..H#..#H#-H#.H-#H#...H.#H#H.",
            "..H....H####E##.H.####..H#H.",
            ".#H.-.#H#-..#..#H.....-.H#H.",
            ".#H..#.H####.H#.H.H#$##.H#H.",
            "..H..H#H---##.#H..HH#---H#H.",
            ".##H.H..H....#H#.#.H#####HH.",
            "...###H-.H----H---##-----H..",
            "............E..............."
        ],
        // Championship Level 045
        [
            "#############...............",
            "#P.#..#.$...#.H...----------",
            "#..#$...H#.$#-H...H.........",
            "#####H#######EH..-H.#######.",
            "#..#$H#..#$.#.H.-.H.$###$##.",
            "#$.#.H#$....#-H-..H.#$####$.",
            "##.##H#######.....H.$###$##.",
            "#.$#.H#.$#H.#.....H.#$####$.",
            "#...$H#..#$.#.....H.$###$##.",
            "#####H#######.....H.#$####$.",
            "#--#.H#--#..#.....H.........",
            "#--#.H#--#.E#.....H#########",
            "#############.....H#..H#..$#",
            "#H.#.....#........H#########",
            "#HE...#.$..H#.....H#...#H.$#",
            "############################"
        ],
        // Championship Level 046
        [
            ".......E-.....-E............",
            "@@.@@..@-..P..-@@..@..@@@@@.",
            "@.@.@..@.-.H.-.@.@.@..@@@...",
            "@...@..@..-H-..@..@@..@@@@@.",
            "#####T###@#H##########.E##..",
            "H-.........H.-..-.$-$$#H###H",
            "H..$#####$#H#$H#.H#.H##H..#H",
            "H.$$#####$#H#@@@TT#H#T#$###H",
            "H$$$#####$#H.$....@@.$...$.H",
            "H#$######$#HT@@#T######@@##H",
            "H..@@T$T@@@H@.$TT#.$#@.$@@@H",
            "##H@@$$$@@@H#H###@#########H",
            "#.H@$$$$$@@H@$.......$...$#H",
            "#H#########H@@@@@@.#####@@#H",
            "#H.$.$.$.$.H.#####H#$.....$H",
            "############@.####HE#H#-####"
        ],
        // Championship Level 047
        [
            "H.-.E..E..E..E...-..-..-.P-H",
            "H#.##$##$##$##$##.##.##.##.H",
            "H##.##.##.##.##.##.##.##.##H",
            "H.##.##.##.##.##.##.##.##.#H",
            "H#.##.##.##.##.##.##.##.##.H",
            "H##.##.##.##.##.##.##.##.##H",
            "H.##.##.##.##.##.##.##.##.#H",
            "H#.##.##.##.##.##.##.##.##.H",
            "H##.##.##.##.##.##.##.##.##H",
            "H.##.##.##.##.##.##.##.##.#H",
            "H#.##.##.##.##.##.##.##.##.H",
            "H##.##.##.##.##.##.##.##.##H",
            "H.##$##$##$##$##$##$##$##$#H",
            "H#.##.##.##.##.##.##.##.##.H",
            "H..........................H",
            "############################"
        ],
        // Championship Level 048
        [
            ".........-........-.........",
            ".........-........-.........",
            "....#....-........-....#....",
            "....#@@T#H#T@@@@T#H#T@@#....",
            "....#$$T#H#T....T#H#T$$#....",
            "....###.@H#.####.#H@.###....",
            ".......@@H@@....@@H@@.......",
            "...#@@T@HH@......@HH@T@@#...",
            "...#$$T@H##@T@@T@##H@T$$#...",
            "...###.@H#$$T@@T$$#H@.###...",
            "......@@H###.@@.###H@@......",
            "..#@@T@HH...@@@@...HH@T@@#..",
            "..#$$T@H............H@T$$#..",
            "..###.@H............H@.###..",
            "..EE.@HH..P.......EEHH@.E...",
            "####H.H##############H.H####"
        ],
        // Championship Level 049
        [
            "##-.....................-###",
            "#####-E.....P.......E-######",
            "#########-H#####H-##########",
            ".....$....HT...TH.....$.....",
            "...H##....H##$##H....##H....",
            "H####..H#.H#####H.#H..#####H",
            "H.....H##-#######-##H......H",
            "H..E.HT.#-#..T$.#-T.#H..E..H",
            "H######$#-#$###.#-#$#######H",
            "H.....#T#-#####T#-#T#......H",
            "T#H......-.......-......H###",
            "T####H#.-#########-.#H###TT#",
            "T$..#H##-H#.$#$.#H-##H..#.$#",
            "##$..H.##H#.T#T.#H##.H.#..##",
            "###..H...H#######H...H#.....",
            "#####H###H.......H###H######"
        ],
        // Championship Level 050
        [
            "P......--....--.----.#.$E$.$",
            "E#H..H@..$.@H#$#$#...#H#T#.H",
            "@#####@H#.##H#.#.####HH##..H",
            "@#####@H.#.#H#--.#$##H.##-.H",
            "........H...H########H..$..H",
            "H######TH...H--#.#$##..##.##",
            "H#..#H.#H#.$#.H#$.###@@..###",
            "H#$.#.$#H##.#.H###$H.......$",
            "H.#####.H..#..H#$##H-.$.#H##",
            "H#.H#..#H..#E#H###$H.##.$H#$",
            "H#$.#.$TH...##H#$#..H#$H#.#.",
            "H.#####.H....#H#..E#H#HH####",
            "H#..#..#H....-H.$.#HH.##...$",
            ".#$.#.$#H...H.$.#.#H.....H##",
            "$#######H...H.#.#@HH.H##.H#$",
            "........H#..#.#@..H..H##$H#."
        ]
    ];

    // SOUND CLASS
    // ============================================

    class Sound {
        constructor() {
            this.audioCtx = null;
            this.enabled = true;
            this.iconEl = null;
            this.toggleEl = null;
        }

        init() {
            if (!this.audioCtx) {
                this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (this.audioCtx.state === 'suspended') {
                this.audioCtx.resume();
            }
        }

        setupToggle() {
            this.toggleEl = document.getElementById('sound-toggle');
            this.iconEl = document.getElementById('sound-icon');
            if (this.toggleEl) {
                this.toggleEl.addEventListener('click', () => this.toggle());
            }
            this.updateIcon();
        }

        toggle() {
            this.enabled = !this.enabled;
            this.updateIcon();
            if (this.enabled) {
                this.play('gold'); //  
            }
        }

        updateIcon() {
            if (this.iconEl) {
                this.iconEl.textContent = this.enabled ? '' : '';
            }
            if (this.toggleEl) {
                this.toggleEl.classList.toggle('muted', !this.enabled);
            }
        }

        beep(freq, duration, type = 'square', vol = 0.1) {
            if (!this.enabled || !this.audioCtx) return;

            const ctx = this.audioCtx;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.value = vol;

            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
            osc.stop(ctx.currentTime + duration);
        }

        //   ()
        noise(duration, vol = 0.05) {
            if (!this.enabled || !this.audioCtx) return;

            const ctx = this.audioCtx;
            const bufferSize = ctx.sampleRate * duration;
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * vol;
            }

            const source = ctx.createBufferSource();
            const gain = ctx.createGain();
            source.buffer = buffer;
            source.connect(gain);
            gain.connect(ctx.destination);
            gain.gain.value = vol;
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
            source.start();
        }

        //   (  )
        sweep(startFreq, endFreq, duration, type = 'square', vol = 0.1) {
            if (!this.enabled || !this.audioCtx) return;

            const ctx = this.audioCtx;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.type = type;
            osc.frequency.setValueAtTime(startFreq, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(endFreq, ctx.currentTime + duration);
            gain.gain.value = vol;
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);

            osc.start();
            osc.stop(ctx.currentTime + duration);
        }

        play(type) {
            if (!this.audioCtx) return;

            switch (type) {
                //   - C64   
                case 'gold':
                    this.beep(880, 0.06, 'square', 0.1);
                    setTimeout(() => this.beep(1320, 0.08, 'square', 0.1), 50);
                    setTimeout(() => this.beep(1760, 0.15, 'square', 0.12), 100);
                    break;

                //   - C64   
                case 'dig':
                    this.noise(0.05, 0.25);
                    this.noise(0.03, 0.2);
                    setTimeout(() => {
                        this.noise(0.04, 0.18);
                    }, 40);
                    break;

                //   - C64 
                case 'fill':
                    this.beep(150, 0.06, 'square', 0.12);
                    setTimeout(() => this.beep(200, 0.08, 'square', 0.1), 40);
                    setTimeout(() => this.beep(250, 0.1, 'square', 0.08), 80);
                    break;

                //   
                case 'trap':
                    this.sweep(300, 100, 0.25, 'sawtooth', 0.15);
                    setTimeout(() => this.noise(0.15, 0.1), 200);
                    break;

                //  
                case 'respawn':
                    this.beep(200, 0.06, 'square', 0.08);
                    setTimeout(() => this.beep(400, 0.06, 'square', 0.08), 60);
                    setTimeout(() => this.beep(600, 0.1, 'square', 0.1), 120);
                    break;

                //   (  )
                case 'fall':
                    this.sweep(400, 150, 0.2, 'square', 0.12);
                    break;

                //  ()
                case 'step':
                    this.beep(100 + Math.random() * 50, 0.025, 'square', 0.04);
                    break;

                //  
                case 'climb':
                    this.beep(200 + Math.random() * 40, 0.035, 'square', 0.05);
                    break;

                //  
                case 'bar':
                    this.beep(250 + Math.random() * 30, 0.025, 'square', 0.04);
                    break;

                //   - C64 
                case 'die':
                    this.sweep(500, 50, 0.5, 'sawtooth', 0.2);
                    setTimeout(() => this.noise(0.3, 0.15), 400);
                    break;

                //    - C64 
                case 'escape':
                    for (let i = 0; i < 8; i++) {
                        setTimeout(() => this.beep(440 + i * 110, 0.05, 'square', 0.08), i * 40);
                    }
                    break;

                //   - C64  
                case 'levelup':
                    const notes = [523, 659, 784, 1047, 1319, 1568];
                    notes.forEach((freq, i) => {
                        setTimeout(() => this.beep(freq, 0.1, 'square', 0.1), i * 60);
                    });
                    setTimeout(() => {
                        this.beep(1568, 0.2, 'square', 0.12);
                        this.beep(1319, 0.2, 'square', 0.1);
                        this.beep(1047, 0.3, 'square', 0.1);
                    }, 400);
                    break;

                //   - C64 
                case 'start':
                    this.beep(220, 0.08, 'square', 0.1);
                    setTimeout(() => this.beep(330, 0.08, 'square', 0.1), 80);
                    setTimeout(() => this.beep(440, 0.1, 'square', 0.1), 160);
                    setTimeout(() => this.beep(660, 0.2, 'square', 0.12), 280);
                    break;

                // 
                case 'pause':
                    this.beep(440, 0.1, 'square', 0.08);
                    setTimeout(() => this.beep(330, 0.15, 'square', 0.06), 100);
                    break;

                // 
                case 'resume':
                    this.beep(330, 0.1, 'sine', 0.06);
                    setTimeout(() => this.beep(440, 0.15, 'sine', 0.08), 100);
                    break;

                //  
                case 'gameover':
                    this.sweep(400, 100, 0.5, 'sawtooth', 0.12);
                    setTimeout(() => this.beep(80, 0.3, 'square', 0.08), 400);
                    setTimeout(() => this.beep(60, 0.4, 'square', 0.06), 600);
                    break;

                //  ( )
                case 'stuck':
                    this.beep(200, 0.15, 'square', 0.1);
                    setTimeout(() => this.beep(150, 0.15, 'square', 0.1), 200);
                    setTimeout(() => this.beep(100, 0.2, 'sawtooth', 0.1), 400);
                    break;

                //    - C64 
                case 'title':
                    const titleNotes = [
                        { freq: 220, dur: 0.12 },
                        { freq: 330, dur: 0.12 },
                        { freq: 440, dur: 0.12 },
                        { freq: 330, dur: 0.12 },
                        { freq: 440, dur: 0.12 },
                        { freq: 550, dur: 0.24 },
                        { freq: 440, dur: 0.12 },
                        { freq: 550, dur: 0.24 }
                    ];
                    let titleTime = 0;
                    titleNotes.forEach(note => {
                        setTimeout(() => this.beep(note.freq, note.dur, 'square', 0.08), titleTime);
                        titleTime += note.dur * 700;
                    });
                    break;

                //   
                case 'demo':
                    this.beep(523, 0.08, 'sine', 0.06);
                    setTimeout(() => this.beep(659, 0.08, 'sine', 0.06), 100);
                    setTimeout(() => this.beep(523, 0.12, 'sine', 0.08), 200);
                    break;

                //   ( )
                case 'kill':
                    this.sweep(300, 80, 0.2, 'sawtooth', 0.1);
                    setTimeout(() => this.noise(0.1, 0.1), 150);
                    break;

                // Championship  
                case 'championship':
                    this.beep(392, 0.1, 'square', 0.08);
                    setTimeout(() => this.beep(523, 0.1, 'square', 0.08), 120);
                    setTimeout(() => this.beep(659, 0.1, 'square', 0.08), 240);
                    setTimeout(() => this.beep(784, 0.2, 'sine', 0.1), 360);
                    setTimeout(() => this.beep(1047, 0.3, 'sine', 0.12), 500);
                    break;

                //   
                case 'drop':
                    this.beep(600, 0.06, 'triangle', 0.06);
                    setTimeout(() => this.beep(400, 0.08, 'triangle', 0.05), 60);
                    break;

                //   
                case 'pickup':
                    this.beep(400, 0.06, 'triangle', 0.05);
                    setTimeout(() => this.beep(500, 0.06, 'triangle', 0.06), 50);
                    break;
            }
        }
    }

    // ============================================
    // GAME CLASS
    // ============================================

    class LodeRunner {
        constructor() {
            this.canvas = document.getElementById('game-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.canvas.width = CANVAS_WIDTH;
            this.canvas.height = CANVAS_HEIGHT;

            this.scoreEl = document.getElementById('score');
            this.levelEl = document.getElementById('level');
            this.livesEl = document.getElementById('lives');
            this.messageEl = document.getElementById('message');

            // Death overlay elements
            this.deathOverlay = document.getElementById('death-overlay');
            this.deathTitle = document.getElementById('death-title');
            this.deathReason = document.getElementById('death-reason');

            this.keys = {};
            this.keySource = {};  // Track input source: 'keyboard' or 'touch'
            this.gameState = STATE.TITLE;
            this.score = 0;
            this.lives = 5;
            this.currentLevel = 1;
            this.speedMultiplier = 1.0;  // C64: increases after completing all 150 levels

            this.level = [];
            this.player = null;
            this.enemies = [];
            this.goldCount = 0;
            this.goldCollected = 0;
            this.dugHoles = [];
            this.escapeLadderActive = false;

            this.frameCount = 0;
            this.lastTime = 0;
            this.tickRate = 1000 / 30;

            // Stuck detection
            this.stuckCheckTimer = 0;
            this.stuckReason = '';

            // Frame-based timers (replaces setTimeout)
            this.deathTimer = 0;
            this.levelCompleteTimer = 0;

            // Digging animation effects
            this.diggingEffects = [];
            this.digParticles = [];

            // Game mode (classic or championship)
            this.gameMode = 'classic';  // 'classic' or 'championship'
            this.activeLevels = LEVELS;

            // Editor mode
            this.editorTile = TILE.BRICK;
            this.editorLevel = this.createEmptyLevel();

            // Demo mode
            this.demoMode = false;
            this.demoMoveTimer = 0;
            this.demoTargetGold = null;
            this.lastDemoDir = 'H';  // Last movement direction (H: horizontal, V: vertical)
            this.demoPositionHistory = [];  // Recent position history (for deadlock detection)
            this.demoStuckCounter = 0;  // Deadlock counter
            this.lastInputTime = 0;  // Last user input time (frameCount based)
            this.idleTimeoutFrames = 900;  // 30 seconds (30fps * 30sec)

            this.sound = new Sound();

            // Gradient cache for performance
            this.gradientCache = {};
            this.gradientCacheHits = 0;
            this.gradientCacheMisses = 0;

            this.setupInput();
            this.setupResponsiveCanvas();
            this.sound.setupToggle();

            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    this.wasPlayingBeforeHidden = this.gameState === STATE.PLAYING;
                    if (this.wasPlayingBeforeHidden) {
                        this.gameState = STATE.PAUSED;
                        this.showMessage('PAUSED');
                    }
                } else {
                    if (this.wasPlayingBeforeHidden && this.gameState === STATE.PAUSED) {
                        this.gameState = STATE.PLAYING;
                        this.showMessage('');
                    }
                }
            });

            this.showTitle();
            this.gameLoop();
        }

        setupResponsiveCanvas() {
            const resize = () => {
                // Minimal margin from viewport edges (3px top/bottom)
                const marginY = 3;
                const marginX = 3;
                const viewportWidth = window.innerWidth - marginX * 2;
                const viewportHeight = window.innerHeight - marginY * 2;

                // UI overhead (all proportional to scale):
                // header: ~24px, message: ~24px, instructions: ~50px (with key display),
                // copyright: ~14px, container padding: ~12px, borders: ~8px
                const uiOverheadBase = 110;
                const containerPadding = 12;

                // Calculate scale to fit both width and height
                const scaleX = viewportWidth / (BASE_WIDTH + containerPadding);
                const scaleY = viewportHeight / (BASE_HEIGHT + uiOverheadBase + containerPadding);
                SCALE = Math.min(scaleX, scaleY);
                SCALE = Math.max(0.5, Math.min(SCALE, 2.5));

                // Apply device pixel ratio for crisp rendering
                const dpr = window.devicePixelRatio || 1;

                // Update canvas size
                CANVAS_WIDTH = Math.floor(BASE_WIDTH * SCALE);
                CANVAS_HEIGHT = Math.floor(BASE_HEIGHT * SCALE);
                TILE_SIZE = BASE_TILE_SIZE * SCALE;

                // Set canvas resolution (internal)
                this.canvas.width = CANVAS_WIDTH * dpr;
                this.canvas.height = CANVAS_HEIGHT * dpr;

                // Set canvas display size (CSS)
                this.canvas.style.width = CANVAS_WIDTH + 'px';
                this.canvas.style.height = CANVAS_HEIGHT + 'px';

                // Scale context for high DPI
                this.ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

                // Enable smooth rendering for vector graphics
                this.ctx.imageSmoothingEnabled = true;
                this.ctx.imageSmoothingQuality = 'high';

                // Update CSS variable for UI scaling
                document.documentElement.style.setProperty('--scale', SCALE);
                document.documentElement.style.setProperty('--game-width', CANVAS_WIDTH + 'px');
                document.documentElement.style.setProperty('--game-height', CANVAS_HEIGHT + 'px');
            };

            window.addEventListener('resize', resize);
            resize();

            // Editor mouse click handler
            this.canvas.addEventListener('mousedown', (e) => {
                if (this.gameState !== STATE.EDITOR) return;
                
                const rect = this.canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;
                
                const tileX = Math.floor(clickX / TILE_SIZE);
                const tileY = Math.floor(clickY / TILE_SIZE);
                
                if (tileX >= 0 && tileX < LEVEL_WIDTH && tileY >= 0 && tileY < LEVEL_HEIGHT) {
                    // Border tiles cannot be changed
                    if (tileX === 0 || tileX === LEVEL_WIDTH - 1 || tileY === 0 || tileY === LEVEL_HEIGHT - 1) {
                        return;
                    }
                    this.editorLevel[tileY][tileX] = this.editorTile;
                }
            });
        }

        // Vector graphics helper functions
        s(val) {
            return val * SCALE;
        }

        drawRoundRect(x, y, w, h, r) {
            const ctx = this.ctx;
            r = Math.min(r, w / 2, h / 2);
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
        }

        drawCircle(x, y, r) {
            this.ctx.beginPath();
            this.ctx.arc(x, y, r, 0, Math.PI * 2);
            this.ctx.closePath();
        }

        createGradient(x1, y1, x2, y2, color1, color2) {
            const key = `L:${x1},${y1},${x2},${y2},${color1},${color2}`;
            if (this.gradientCache[key]) {
                this.gradientCacheHits++;
                return this.gradientCache[key];
            }
            this.gradientCacheMisses++;
            const grad = this.ctx.createLinearGradient(x1, y1, x2, y2);
            grad.addColorStop(0, color1);
            grad.addColorStop(1, color2);
            if (Object.keys(this.gradientCache).length < 500) {
                this.gradientCache[key] = grad;
            }
            return grad;
        }

        createRadialGradient(x, y, r1, r2, color1, color2) {
            const key = `R:${x},${y},${r1},${r2},${color1},${color2}`;
            if (this.gradientCache[key]) {
                this.gradientCacheHits++;
                return this.gradientCache[key];
            }
            this.gradientCacheMisses++;
            const grad = this.ctx.createRadialGradient(x, y, r1, x, y, r2);
            grad.addColorStop(0, color1);
            grad.addColorStop(1, color2);
            if (Object.keys(this.gradientCache).length < 500) {
                this.gradientCache[key] = grad;
            }
            return grad;
        }

        setupInput() {
            const keyCodeMap = {
                37: 'LEFT', 38: 'UP', 39: 'RIGHT', 40: 'DOWN',
                65: 'LEFT', 87: 'UP', 68: 'RIGHT', 83: 'DOWN',
                73: 'UP', 74: 'LEFT', 75: 'DOWN', 76: 'RIGHT',
                90: 'DIGL', 88: 'DIGR',
                85: 'DIGL', 79: 'DIGR',
                112: 'DIGL', 113: 'DIGR',
                13: 'ENTER', 82: 'RESTART', 27: 'ESC'
            };

            // Key display update function
            const updateKeyDisplay = (key, isActive) => {
                const keyEl = document.querySelector(`#key-display .key-item[data-key="${key}"]`);
                if (keyEl) {
                    if (isActive) {
                        keyEl.classList.add('active');
                    } else {
                        keyEl.classList.remove('active');
                    }
                }
            };

            const handleKey = (e, isDown, source = 'keyboard') => {
                if (e.isComposing || e.keyCode === 229) return;

                // Update user input time (demo timer reset)
                if (isDown) {
                    this.lastInputTime = this.frameCount;
                }

                const key = keyCodeMap[e.keyCode];
                if (key) {
                    // Prioritize newer input source
                    if (isDown) {
                        this.keySource[key] = source;
                    } else if (this.keySource[key] !== source) {
                        // Another source still has this key pressed, don't release
                        return;
                    }
                    this.keys[key] = isDown;
                    if (!isDown) delete this.keySource[key];
                    e.preventDefault();
                    // Update key display
                    updateKeyDisplay(key, isDown);
                }

                // 'C' key to toggle game mode (title screen only)
                if (isDown && e.keyCode === 67 && this.gameState === STATE.TITLE) {
                    this.toggleGameMode();
                    e.preventDefault();
                }

                // 'E' key to toggle editor mode
                if (isDown && e.keyCode === 69) {
                    this.toggleEditor();
                    e.preventDefault();
                }

                // Editor mode keyboard controls
                if (this.gameState === STATE.EDITOR) {
                    this.handleEditorInput(e, isDown);
                    return;
                }

                // 'M' key to toggle sound
                if (isDown && e.keyCode === 77) {
                    this.sound.toggle();
                    e.preventDefault();
                }

                if (isDown) {
                    this.sound.init();

                    if (key === 'ENTER') {
                        // Press ENTER in demo mode to start game
                        if (this.demoMode) {
                            this.demoMode = false;
                            this.showTitle();
                            return;
                        }
                        if (this.gameState === STATE.TITLE || this.gameState === STATE.GAME_OVER) {
                            this.startGame();
                        } else if (this.gameState === STATE.STUCK) {
                            this.hideDeathOverlay();
                            this.lives--;
                            this.updateUI();
                            if (this.lives <= 0) {
                                this.gameState = STATE.GAME_OVER;
                                this.showMessage('GAME OVER - PRESS ENTER');
                                this.sound.play('gameover');
                            } else {
                                this.loadLevel(this.currentLevel);
                                this.gameState = STATE.PLAYING;
                                this.showMessage('');
                            }
                        } else if (this.gameState === STATE.PLAYING) {
                            this.gameState = STATE.PAUSED;
                            this.showMessage('PAUSED');
                            this.sound.play('pause');
                        } else if (this.gameState === STATE.PAUSED) {
                            this.gameState = STATE.PLAYING;
                            this.showMessage('');
                            this.sound.play('resume');
                        }
                    }

                    if (key === 'ESC' && this.gameState === STATE.PLAYING) {
                        this.gameState = STATE.PAUSED;
                        this.showMessage('PAUSED');
                        this.sound.play('pause');
                    }

                    if (key === 'RESTART' && (this.gameState === STATE.PLAYING || this.gameState === STATE.STUCK)) {
                        this.hideDeathOverlay();
                        this.lives--;
                        this.updateUI();
                        if (this.lives <= 0) {
                            this.gameState = STATE.GAME_OVER;
                            this.showMessage('GAME OVER - PRESS ENTER');
                            this.sound.play('gameover');
                        } else {
                            this.loadLevel(this.currentLevel);
                            this.gameState = STATE.PLAYING;
                            this.showMessage('');
                        }
                    }
                }
            };

            document.addEventListener('keydown', (e) => handleKey(e, true));
            document.addEventListener('keyup', (e) => handleKey(e, false));

            this.setupTouchControls();
        }

        setupTouchControls() {
            const buttons = document.querySelectorAll('#mobile-controls button');
            if (!buttons.length) return;

            const keyActionMap = {
                'LEFT': null, 'UP': null, 'RIGHT': null, 'DOWN': null,
                'DIGL': null, 'DIGR': null,
                'ENTER': () => this.handleEnterKey(),
                'RESTART': () => this.handleRestartKey(),
                'ESC': () => this.handlePauseKey()
            };

            const keyCodeMap = {
                'LEFT': 37, 'UP': 38, 'RIGHT': 39, 'DOWN': 40,
                'DIGL': 90, 'DIGR': 88,
                'ENTER': 13, 'RESTART': 82, 'ESC': 27
            };

            buttons.forEach(btn => {
                const key = btn.dataset.key;
                if (!key) return;

                const handlePress = (e) => {
                    e.preventDefault();
                    // Prioritize touch input over keyboard
                    this.keySource[key] = 'touch';
                    this.keys[key] = true;
                    this.lastInputTime = this.frameCount;
                    this.sound.init();
                    btn.classList.add('pressed');

                    if (keyActionMap[key]) {
                        keyActionMap[key]();
                    }
                };

                const handleRelease = (e) => {
                    e.preventDefault();
                    // Only release if this is the active source
                    if (this.keySource[key] === 'touch') {
                        delete this.keySource[key];
                        this.keys[key] = false;
                    }
                    btn.classList.remove('pressed');
                };

                btn.addEventListener('touchstart', handlePress, { passive: false });
                btn.addEventListener('touchend', handleRelease, { passive: false });
                btn.addEventListener('touchcancel', handleRelease, { passive: false });
                btn.addEventListener('mousedown', handlePress);
                btn.addEventListener('mouseup', handleRelease);
                btn.addEventListener('mouseleave', handleRelease);
            });
        }

        handleEnterKey() {
            if (this.demoMode) {
                this.demoMode = false;
                this.showTitle();
                return;
            }
            if (this.gameState === STATE.TITLE || this.gameState === STATE.GAME_OVER) {
                this.startGame();
            } else if (this.gameState === STATE.STUCK) {
                this.handleDeath();
            } else if (this.gameState === STATE.PLAYING) {
                this.gameState = STATE.PAUSED;
                this.showMessage('PAUSED');
                this.sound.play('pause');
            } else if (this.gameState === STATE.PAUSED) {
                this.gameState = STATE.PLAYING;
                this.showMessage('');
                this.sound.play('resume');
            }
        }

        handleDeath() {
            this.hideDeathOverlay();
            this.lives--;
            this.updateUI();
            if (this.lives <= 0) {
                this.gameState = STATE.GAME_OVER;
                this.showMessage('GAME OVER - PRESS ENTER');
                this.sound.play('gameover');
            } else {
                this.loadLevel(this.currentLevel);
                this.gameState = STATE.PLAYING;
                this.showMessage('');
            }
        }

        handleRestartKey() {
            if (this.gameState === STATE.PLAYING || this.gameState === STATE.STUCK) {
                this.handleDeath();
            }
        }

        handlePauseKey() {
            if (this.gameState === STATE.PLAYING) {
                this.gameState = STATE.PAUSED;
                this.showMessage('PAUSED');
                this.sound.play('pause');
            } else if (this.gameState === STATE.PAUSED) {
                this.gameState = STATE.PLAYING;
                this.showMessage('');
                this.sound.play('resume');
            }
        }

        showTitle() {
            this.gameState = STATE.TITLE;
            this.demoMode = false;
            this.lastInputTime = this.frameCount;  // Reset input timer
            this.activeLevels = this.gameMode === 'championship' ? CHAMPIONSHIP_LEVELS : LEVELS;
            this.loadLevel(1);
            this.updateTitleMessage();
            // Play title music
            if (this.sound) {
                this.sound.play('title');
            }
        }

        updateTitleMessage() {
            const modeText = this.gameMode === 'championship' ? 'CHAMPIONSHIP' : 'CLASSIC';
            const levelCount = this.activeLevels.length;
            this.showMessage(`LODE RUNNER ${modeText} (${levelCount} LEVELS) - PRESS ENTER | C: MODE`);
        }

        startDemo() {
            this.demoMode = true;
            this.score = 0;
            this.lives = 99;
            this.currentLevel = Math.floor(Math.random() * Math.min(10, this.activeLevels.length)) + 1;
            this.loadLevel(this.currentLevel);
            this.gameState = STATE.PLAYING;
            this.showMessage('DEMO - PRESS ENTER TO PLAY');
        }

        updateDemo() {
            if (!this.demoMode || this.gameState !== STATE.PLAYING) return;

            this.demoMoveTimer++;
            if (this.demoMoveTimer < 2) return;
            this.demoMoveTimer = 0;

            const p = this.player;
            const px = Math.floor(p.x + 0.5);
            const py = Math.floor(p.y + 0.5);
            const posKey = `${px},${py}`;

            //  
            this.keys.LEFT = false;
            this.keys.RIGHT = false;
            this.keys.UP = false;
            this.keys.DOWN = false;
            this.keys.DIGL = false;
            this.keys.DIGR = false;

            // ===   ===
            this.demoPositionHistory.push(posKey);
            if (this.demoPositionHistory.length > 60) {
                this.demoPositionHistory.shift();
            }

            //  60( 4)   (3x3)  
            let isStuck = false;
            if (this.demoPositionHistory.length >= 60) {
                const recentPositions = new Set(this.demoPositionHistory.slice(-30));
                if (recentPositions.size <= 6) {
                    isStuck = true;
                    this.demoStuckCounter++;
                } else {
                    this.demoStuckCounter = 0;
                }
            }

            //      ( )
            if (p.vy > 0.1) {
                this.updateDemoKeyDisplay();
                return;
            }

            const onLadder = this.isLadder(px, py);
            const onBar = this.isBar(px, py);
            const hasFloor = this.isSolidForPlayer(px, py + 1) || this.isLadder(px, py + 1) || onLadder || this.isDugHole(px, py + 1);
            const isEscaping = this.escapeLadderActive;

            // ===  :      ===
            if (isStuck && this.demoStuckCounter > 2) {
                //     
                const digOptions = [];
                if (hasFloor && px > 0 && !this.isSolid(px - 1, py)) {
                    const tile = this.getTile(px - 1, py + 1);
                    if (tile === TILE.BRICK || tile === TILE.TRAP) digOptions.push('DIGL');
                }
                if (hasFloor && px < LEVEL_WIDTH - 1 && !this.isSolid(px + 1, py)) {
                    const tile = this.getTile(px + 1, py + 1);
                    if (tile === TILE.BRICK || tile === TILE.TRAP) digOptions.push('DIGR');
                }

                if (digOptions.length > 0) {
                    const dig = digOptions[Math.floor(Math.random() * digOptions.length)];
                    this.keys[dig] = true;
                    this.demoStuckCounter = 0;
                    this.demoPositionHistory = [];
                    this.updateDemoKeyDisplay();
                    return;
                }

                //     
                const escapeOptions = [];
                if (!this.isSolid(px - 1, py) && (hasFloor || onBar)) escapeOptions.push('LEFT');
                if (!this.isSolid(px + 1, py) && (hasFloor || onBar)) escapeOptions.push('RIGHT');
                if ((onLadder || this.isLadder(px, py - 1)) && !this.isSolid(px, py - 1)) escapeOptions.push('UP');
                if ((onLadder || this.isLadder(px, py + 1) || onBar) && !this.isSolidForPlayer(px, py + 1)) escapeOptions.push('DOWN');

                if (escapeOptions.length > 0) {
                    //     
                    const newDir = escapeOptions[Math.floor(Math.random() * escapeOptions.length)];
                    this.keys[newDir] = true;
                    this.demoStuckCounter = 0;
                    this.updateDemoKeyDisplay();
                    return;
                }
            }

            // ===   ===
            const nearbyEnemies = [];
            for (const e of this.enemies) {
                if (e.trapped > 0) continue;
                const ex = Math.floor(e.x + 0.5);
                const ey = Math.floor(e.y + 0.5);
                const dist = Math.abs(ex - px) + Math.abs(ey - py);
                nearbyEnemies.push({ e, ex, ey, dist, dx: ex - px, dy: ey - py });
            }
            nearbyEnemies.sort((a, b) => a.dist - b.dist);
            const closestEnemy = nearbyEnemies[0];

            // ===    (  ) ===
            if (closestEnemy && closestEnemy.dist <= 2) {
                const escapeDir = closestEnemy.dx < 0 ? 1 : -1;
                const canEscapeH = !this.isSolid(px + escapeDir, py) && (hasFloor || onBar);
                const canEscapeUp = (onLadder || this.isLadder(px, py - 1)) && !this.isSolid(px, py - 1);
                const canEscapeDown = (onLadder || this.isLadder(px, py + 1) || onBar) && (!this.isSolidForPlayer(px, py + 1) || this.isDugHole(px, py + 1));

                if (canEscapeH) {
                    this.keys[escapeDir < 0 ? 'LEFT' : 'RIGHT'] = true;
                    this.updateDemoKeyDisplay();
                    return;
                } else if (canEscapeUp) {
                    this.keys.UP = true;
                    this.updateDemoKeyDisplay();
                    return;
                } else if (canEscapeDown) {
                    this.keys.DOWN = true;
                    this.updateDemoKeyDisplay();
                    return;
                }
            }

            // === BFS /   ===
            const findPath = (allowDig) => {
                const visited = new Map();
                const queue = [{ x: px, y: py, path: [], dug: false }];
                visited.set(`${px},${py}:0`, true);

                while (queue.length > 0) {
                    const current = queue.shift();
                    const { x, y, path, dug } = current;

                    //  
                    if (isEscaping) {
                        if (y === 0 && this.getTile(x, y) === TILE.ESCAPE_LADDER) {
                            return path;
                        }
                    } else {
                        if (this.getTile(x, y) === TILE.GOLD) {
                            return path;
                        }
                    }

                    //    
                    if (path.length > 100) continue;

                    const currOnLadder = this.isLadder(x, y);
                    const currOnBar = this.isBar(x, y);
                    const currHasFloor = this.isSolid(x, y + 1) || this.isLadder(x, y + 1) || currOnLadder;
                    const canMove = currHasFloor || currOnBar || currOnLadder;

                    const moves = [];

                    //   - enemies can walk ON brick but not THROUGH brick
                    if (x > 0 && !this.isSolidOrBrick(x - 1, y) && canMove) {
                        moves.push({ x: x - 1, y, action: 'LEFT', dig: false });
                    }
                    if (x < LEVEL_WIDTH - 1 && !this.isSolidOrBrick(x + 1, y) && canMove) {
                        moves.push({ x: x + 1, y, action: 'RIGHT', dig: false });
                    }
                    if (y > 0 && !this.isSolidOrBrick(x, y - 1) && (currOnLadder || this.isLadder(x, y - 1))) {
                        moves.push({ x, y: y - 1, action: 'UP', dig: false });
                    }
                    if (y < LEVEL_HEIGHT - 1 && !this.isSolidOrBrick(x, y + 1)) {
                        if (currOnLadder || this.isLadder(x, y + 1) || currOnBar) {
                            moves.push({ x, y: y + 1, action: 'DOWN', dig: false });
                        }
                    }
                    // 
                    if (!currHasFloor && !currOnBar && y < LEVEL_HEIGHT - 1 && !this.isSolidOrBrick(x, y + 1)) {
                        moves.push({ x, y: y + 1, action: 'FALL', dig: false });
                    }

                    //    ( )
                    if (allowDig && !dug && canMove) {
                        if (x > 0 && !this.isSolidOrBrick(x - 1, y)) {
                            const digTile = this.getTile(x - 1, y + 1);
                            if (digTile === TILE.BRICK || digTile === TILE.TRAP) {
                                //      + 
                                moves.push({ x: x - 1, y: y + 1, action: 'DIGL', dig: true });
                            }
                        }
                        if (x < LEVEL_WIDTH - 1 && !this.isSolidOrBrick(x + 1, y)) {
                            const digTile = this.getTile(x + 1, y + 1);
                            if (digTile === TILE.BRICK || digTile === TILE.TRAP) {
                                moves.push({ x: x + 1, y: y + 1, action: 'DIGR', dig: true });
                            }
                        }
                    }

                    for (const move of moves) {
                        const key = `${move.x},${move.y}:${dug || move.dig ? 1 : 0}`;
                        if (!visited.has(key)) {
                            visited.set(key, true);
                            queue.push({
                                x: move.x,
                                y: move.y,
                                path: [...path, move.action],
                                dug: dug || move.dig
                            });
                        }
                    }
                }
                return null;
            };

            //     
            let targetPath = findPath(false);
            //    
            if (!targetPath) {
                targetPath = findPath(true);
            }

            // ===    ===
            if (targetPath && targetPath.length > 0) {
                const action = targetPath[0];
                if (action === 'LEFT') this.keys.LEFT = true;
                else if (action === 'RIGHT') this.keys.RIGHT = true;
                else if (action === 'UP') this.keys.UP = true;
                else if (action === 'DOWN') this.keys.DOWN = true;
                else if (action === 'DIGL') this.keys.DIGL = true;
                else if (action === 'DIGR') this.keys.DIGR = true;
                this.updateDemoKeyDisplay();
                return;
            }

            // ===   (  )   ===
            let hasVisibleGold = false;
            for (let y = 0; y < LEVEL_HEIGHT; y++) {
                for (let x = 0; x < LEVEL_WIDTH; x++) {
                    if (this.getTile(x, y) === TILE.GOLD) {
                        hasVisibleGold = true;
                        break;
                    }
                }
                if (hasVisibleGold) break;
            }

            if (!hasVisibleGold && !isEscaping && closestEnemy) {
                //    
                const goldEnemy = this.enemies.find(e => e.hasGold);
                if (goldEnemy) {
                    const gex = Math.floor(goldEnemy.x + 0.5);
                    const gey = Math.floor(goldEnemy.y + 0.5);
                    //   
                    if (gex < px && !this.isSolidOrBrick(px - 1, py) && (hasFloor || onBar)) {
                        this.keys.LEFT = true;
                        this.updateDemoKeyDisplay();
                        return;
                    } else if (gex > px && !this.isSolidOrBrick(px + 1, py) && (hasFloor || onBar)) {
                        this.keys.RIGHT = true;
                        this.updateDemoKeyDisplay();
                        return;
                    } else if (gey < py && (onLadder || this.isLadder(px, py - 1)) && !this.isSolidOrBrick(px, py - 1)) {
                        this.keys.UP = true;
                        this.updateDemoKeyDisplay();
                        return;
                    } else if (gey > py && (onLadder || this.isLadder(px, py + 1) || onBar) && !this.isSolidForPlayer(px, py + 1)) {
                        this.keys.DOWN = true;
                        this.updateDemoKeyDisplay();
                        return;
                    }
                }
            }

            // === Fallback:   ===
            const possibleMoves = [];
            if (!this.isSolidOrBrick(px - 1, py) && (hasFloor || onBar)) possibleMoves.push('LEFT');
            if (!this.isSolidOrBrick(px + 1, py) && (hasFloor || onBar)) possibleMoves.push('RIGHT');
            if ((onLadder || this.isLadder(px, py - 1)) && !this.isSolidOrBrick(px, py - 1)) possibleMoves.push('UP');
            if ((onLadder || this.isLadder(px, py + 1) || onBar) && (!this.isSolidForPlayer(px, py + 1) || this.isDugHole(px, py + 1))) possibleMoves.push('DOWN');

            //   
            if (hasFloor) {
                if (px > 0 && !this.isSolidOrBrick(px - 1, py)) {
                    const tile = this.getTile(px - 1, py + 1);
                    if (tile === TILE.BRICK || tile === TILE.TRAP) possibleMoves.push('DIGL');
                }
                if (px < LEVEL_WIDTH - 1 && !this.isSolidOrBrick(px + 1, py)) {
                    const tile = this.getTile(px + 1, py + 1);
                    if (tile === TILE.BRICK || tile === TILE.TRAP) possibleMoves.push('DIGR');
                }
            }

            if (possibleMoves.length > 0) {
                //    (70% )
                const dirMoves = possibleMoves.filter(m =>
                    (this.lastDemoDir === 'H' && (m === 'LEFT' || m === 'RIGHT')) ||
                    (this.lastDemoDir === 'V' && (m === 'UP' || m === 'DOWN'))
                );

                let action;
                if (dirMoves.length > 0 && Math.random() < 0.7) {
                    action = dirMoves[Math.floor(Math.random() * dirMoves.length)];
                } else {
                    action = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                }

                if (action === 'LEFT' || action === 'RIGHT') this.lastDemoDir = 'H';
                else if (action === 'UP' || action === 'DOWN') this.lastDemoDir = 'V';

                this.keys[action] = true;
            }

            // DEMO    
            this.updateDemoKeyDisplay();
        }

        // DEMO     
        updateDemoKeyDisplay() {
            const keyMap = ['LEFT', 'RIGHT', 'UP', 'DOWN', 'DIGL', 'DIGR'];
            keyMap.forEach(key => {
                const keyEl = document.querySelector(`#key-display .key-item[data-key="${key}"]`);
                if (keyEl) {
                    if (this.keys[key]) {
                        keyEl.classList.add('active');
                    } else {
                        keyEl.classList.remove('active');
                    }
                }
            });
        }

        toggleGameMode() {
            if (this.gameMode === 'classic') {
                this.gameMode = 'championship';
                this.activeLevels = CHAMPIONSHIP_LEVELS;
                this.sound.play('championship');
            } else {
                this.gameMode = 'classic';
                this.activeLevels = LEVELS;
                this.sound.play('demo');
            }
            this.loadLevel(1);
            this.updateTitleMessage();
        }

        toggleEditor() {
            if (this.gameState === STATE.EDITOR) {
                this.gameState = STATE.TITLE;
                this.showMessage('');
            } else {
                this.gameState = STATE.EDITOR;
                this.editorLevel = this.createEmptyLevel();
                this.editorTile = TILE.BRICK;
                this.showMessage('EDITOR - Click to place | 1-8: Select tile | S: Save | L: Load | ESC: Exit');
            }
            this.updateUI();
        }

        handleEditorInput(e, isDown) {
            if (!isDown) return;

            const keyMap = {
                'Digit1': TILE.EMPTY,
                'Digit2': TILE.BRICK,
                'Digit3': TILE.SOLID,
                'Digit4': TILE.LADDER,
                'Digit5': TILE.BAR,
                'Digit6': TILE.TRAP,
                'Digit7': TILE.GOLD,
                'Digit8': TILE.ESCAPE_LADDER
            };

            if (keyMap[e.code]) {
                this.editorTile = keyMap[e.code];
                return;
            }

            if (e.keyCode === 83) { // S - Save
                this.saveEditorLevel();
                this.showMessage('Level saved!');
                return;
            }

            if (e.keyCode === 76) { // L - Load
                this.loadEditorLevel();
                this.showMessage('Level loaded!');
                return;
            }

            if (e.keyCode === 80) { // P - Place player
                this.placeEditorEntity('player');
                return;
            }

            if (e.keyCode === 69) { // E - Place enemy
                this.placeEditorEntity('enemy');
                return;
            }
        }

        placeEditorEntity(type) {
            const px = Math.floor(this.player?.x || LEVEL_WIDTH / 2);
            const py = Math.floor(this.player?.y || LEVEL_HEIGHT / 2);
            
            if (type === 'player') {
                this.editorPlayer = { x: px, y: py };
                this.showMessage('Player placed!');
            } else if (type === 'enemy') {
                if (!this.editorEnemies) this.editorEnemies = [];
                this.editorEnemies.push({ x: px, y: py, startX: px, startY: py });
                this.showMessage('Enemy placed!');
            }
        }

        saveEditorLevel() {
            const levelData = {
                level: this.editorLevel,
                player: this.editorPlayer,
                enemies: this.editorEnemies || []
            };
            localStorage.setItem('loderunner_editor_level', JSON.stringify(levelData));
        }

        loadEditorLevel() {
            const saved = localStorage.getItem('loderunner_editor_level');
            if (saved) {
                const data = JSON.parse(saved);
                this.editorLevel = data.level;
                this.editorPlayer = data.player;
                this.editorEnemies = data.enemies;
            }
        }

        showMessage(msg) {
            this.messageEl.textContent = msg;
        }

        startGame() {
            this.demoMode = false;
            this.lastInputTime = this.frameCount;  //   
            this.score = 0;
            this.lives = 5;
            this.currentLevel = 1;
            this.updateUI();
            this.loadLevel(this.currentLevel);
            this.gameState = STATE.PLAYING;
            this.showMessage('');
            this.sound.play('start');
        }

        updateUI() {
            this.scoreEl.textContent = String(this.score).padStart(6, '0');
            this.levelEl.textContent = String(this.currentLevel).padStart(2, '0');
            this.livesEl.textContent = String(this.lives);
        }

        createEmptyLevel() {
            const level = [];
            for (let y = 0; y < LEVEL_HEIGHT; y++) {
                level[y] = [];
                for (let x = 0; x < LEVEL_WIDTH; x++) {
                    if (y === 0 || y === LEVEL_HEIGHT - 1 || x === 0 || x === LEVEL_WIDTH - 1) {
                        level[y][x] = TILE.SOLID;
                    } else {
                        level[y][x] = TILE.EMPTY;
                    }
                }
            }
            return level;
        }

        loadLevel(levelNum) {
            const levels = (this.activeLevels && this.activeLevels.length > 0) ? this.activeLevels : LEVELS;
            if (levels.length === 0) {
                console.error('No levels available');
                return;
            }
            const levelIndex = ((levelNum - 1) % levels.length + levels.length) % levels.length;
            const levelData = levels[levelIndex];

            this.level = [];
            this.enemies = [];
            this.dugHoles = [];
            this.diggingEffects = [];
            this.digParticles = [];
            this.goldCount = 0;
            this.goldCollected = 0;
            this.escapeLadderActive = false;
            this.player = null;
            this.stuckCheckTimer = 0;
            this.levelStartGrace = 90; // 3 seconds grace period before stuck check
            this.hideDeathOverlay();

            for (let y = 0; y < LEVEL_HEIGHT; y++) {
                this.level[y] = [];
                const row = levelData[y] || '';

                for (let x = 0; x < LEVEL_WIDTH; x++) {
                    const char = row[x] || '.';
                    let tile = TILE.EMPTY;

                    switch (char) {
                        case '#': tile = TILE.BRICK; break;
                        case '@': tile = TILE.SOLID; break;
                        case 'H': tile = TILE.LADDER; break;
                        case '-': tile = TILE.BAR; break;
                        case 'T': tile = TILE.TRAP; break;
                        case '$':
                            tile = TILE.GOLD;
                            this.goldCount++;
                            break;
                        case 'P':
                            this.player = { x: x, y: y, vx: 0, vy: 0, frame: 0, dir: 1, trapped: 0, goldCount: 0, falseFloorTimer: 0 };
                            break;
                        case 'E':
                            this.enemies.push({
                                x: x, y: y, vx: 0, vy: 0,
                                startX: x, startY: y,
                                hasGold: false, trapped: 0,
                                frame: 0, dir: 1,
                                goldPickupCooldown: 0
                            });
                            break;
                    }

                    this.level[y][x] = tile;
                }
            }

            if (!this.player) {
                this.player = { x: 1, y: LEVEL_HEIGHT - 2, vx: 0, vy: 0, frame: 0, dir: 1, trapped: 0, goldCount: 0, falseFloorTimer: 0 };
            }

            this.updateUI();
        }

        getTile(x, y) {
            if (x < 0 || x >= LEVEL_WIDTH || y < 0 || y >= LEVEL_HEIGHT) return TILE.SOLID;
            return this.level[Math.floor(y)][Math.floor(x)];
        }

        setTile(x, y, tile) {
            if (x >= 0 && x < LEVEL_WIDTH && y >= 0 && y < LEVEL_HEIGHT) {
                this.level[Math.floor(y)][Math.floor(x)] = tile;
            }
        }

        isSolid(x, y) {
            const t = this.getTile(x, y);
            return t === TILE.SOLID;
        }

        isSolidForPlayer(x, y) {
            const t = this.getTile(x, y);
            return t === TILE.BRICK || t === TILE.SOLID;
        }

        isSolidOrBrick(x, y) {
            const t = this.getTile(x, y);
            return t === TILE.BRICK || t === TILE.SOLID;
        }

        isLadder(x, y) {
            const t = this.getTile(x, y);
            return t === TILE.LADDER || t === TILE.ESCAPE_LADDER;
        }

        isBar(x, y) {
            return this.getTile(x, y) === TILE.BAR;
        }

        isFalseFloor(x, y) {
            return this.getTile(x, y) === TILE.TRAP;
        }

        isInHole(x, y) {
            const ix = Math.floor(x);
            const iy = Math.floor(y);
            for (const hole of this.dugHoles) {
                if (hole.x === ix && hole.y === iy) return true;
            }
            return false;
        }

        isHoleOccupied(holeX, holeY, excludeEnemy) {
            // Check if player is trapped in this hole
            if (this.player && this.player.trapped > 0 &&
                Math.floor(this.player.x) === holeX && Math.floor(this.player.y) === holeY) {
                return true;
            }
            // Check if any enemy is trapped in this hole
            for (const e of this.enemies) {
                if (e !== excludeEnemy && e.trapped > 0 &&
                    Math.floor(e.x) === holeX && Math.floor(e.y) === holeY) {
                    return true;
                }
            }
            return false;
        }

        // Check if there's a trapped entity (player or enemy) at tile that can be walked on
        getTrappedEntityAtTile(tileX, tileY) {
            // Check for trapped player first
            if (this.player && this.player.trapped > 0) {
                const playerTileX = Math.floor(this.player.x);
                const playerTileY = Math.floor(this.player.y);
                if (playerTileX === tileX && playerTileY === tileY) {
                    return this.player;
                }
            }
            // Then check for trapped enemies
            return this.getTrappedEnemyAtTile(tileX, tileY);
        }

        // Check if player is trapped in a hole
        isPlayerTrapped() {
            return this.player && this.player.trapped > 0;
        }

        getEnemyAt(x, y) {
            for (const e of this.enemies) {
                if (Math.abs(e.x - x) < ENEMY_COLLISION_RADIUS && Math.abs(e.y - y) < ENEMY_COLLISION_RADIUS) {
                    return e;
                }
            }
            return null;
        }

        getTrappedEnemyAt(x, y) {
            for (const e of this.enemies) {
                if (e.trapped > 0 && Math.abs(e.x - x) < TRAPPED_ENEMY_RADIUS && Math.abs(e.y - y) < TRAPPED_ENEMY_RADIUS) {
                    return e;
                }
            }
            return null;
        }

        // Tile-based check for trapped enemy - used when player walks over holes
        getTrappedEnemyAtTile(tileX, tileY) {
            for (const e of this.enemies) {
                if (e.trapped > 0) {
                    // Enemy trapped position: e.x is at hole.x + 0.5, e.y is at hole.y
                    const enemyTileX = Math.floor(e.x);
                    const enemyTileY = Math.floor(e.y);
                    if (enemyTileX === tileX && enemyTileY === tileY) {
                        return e;
                    }
                }
            }
            return null;
        }

        dig(digX, digY) {
            // Can dig BRICK and TRAP tiles
            const tile = this.getTile(digX, digY);
            if (tile === TILE.BRICK || tile === TILE.TRAP) {
                this.setTile(digX, digY, TILE.EMPTY);
                this.dugHoles.push({ x: digX, y: digY, timer: HOLE_FILL_TIME }); // 300 frames at 30fps (10 seconds - original Apple II)
                this.sound.play('dig');

                // Add digging animation effect (pickaxe swing)
                const digDir = digX > this.player.x ? 1 : -1;
                this.diggingEffects.push({
                    x: digX,
                    y: digY,
                    dir: digDir,
                    frame: 0,
                    maxFrames: 12
                });

                // Add debris particles (C64 style - red brick colors)
                for (let i = 0; i < 6; i++) {
                    this.digParticles.push({
                        x: (digX + 0.5) * TILE_SIZE,
                        y: (digY + 0.3) * TILE_SIZE,
                        vx: (Math.random() - 0.5) * 3 * SCALE + digDir * 1.5 * SCALE,
                        vy: -Math.random() * 3 * SCALE - 1 * SCALE,
                        size: (Math.random() * 2 + 1.5) * SCALE,
                        life: 15 + Math.floor(Math.random() * 8),
                        color: Math.random() > 0.5 ? COLORS.RED : COLORS.BROWN
                    });
                }

                return true;
            }
            return false;
        }

        updateDigEffects() {
            // Update digging animations
            for (let i = this.diggingEffects.length - 1; i >= 0; i--) {
                this.diggingEffects[i].frame++;
                if (this.diggingEffects[i].frame >= this.diggingEffects[i].maxFrames) {
                    this.diggingEffects.splice(i, 1);
                }
            }

            // Update particles
            for (let i = this.digParticles.length - 1; i >= 0; i--) {
                const p = this.digParticles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.5 * SCALE; // gravity
                p.life--;
                if (p.life <= 0) {
                    this.digParticles.splice(i, 1);
                }
            }
        }

        collectGold(x, y) {
            const ix = Math.floor(x + 0.5);
            const iy = Math.floor(y + 0.5);
            if (this.getTile(ix, iy) === TILE.GOLD) {
                this.setTile(ix, iy, TILE.EMPTY);
                this.score += 250;  // Apple II original: gold pickup 250 points
                this.goldCollected++;
                // Original Apple II rule: can only carry 1 gold at a time
                if (this.player.goldCount === 0) {
                    this.player.goldCount = 1;
                }
                this.sound.play('gold');
                this.updateUI();

                if (this.goldCollected >= this.goldCount) {
                    this.activateEscape();
                }
            }
        }

        activateEscape() {
            this.escapeLadderActive = true;

            // Find unique ladder columns and their highest positions
            const ladderColumns = [];
            for (let x = 2; x < LEVEL_WIDTH - 2; x++) {
                for (let y = 0; y < LEVEL_HEIGHT; y++) {
                    if (this.isLadder(x, y)) {
                        ladderColumns.push({ x: x, y: y });
                        break; // Only need highest ladder in each column
                    }
                }
            }

            // If there are ladders, sort by height (lowest y = highest on screen)
            if (ladderColumns.length > 0) {
                ladderColumns.sort((a, b) => a.y - b.y);

                // Take only top 1-3 ladders (most accessible ones)
                const numToTake = Math.min(3, ladderColumns.length);
                for (let i = 0; i < numToTake; i++) {
                    const col = ladderColumns[i];
                    // Create escape ladder from top to this ladder
                    for (let y = 0; y <= col.y; y++) {
                        if (this.getTile(col.x, y) === TILE.EMPTY || this.getTile(col.x, y) === TILE.LADDER) {
                            this.setTile(col.x, y, TILE.ESCAPE_LADDER);
                        }
                    }
                }
            }

            // If no ladders, try bars
            if (ladderColumns.length === 0) {
                const barColumns = [];
                for (let x = 2; x < LEVEL_WIDTH - 2; x++) {
                    for (let y = 0; y < LEVEL_HEIGHT; y++) {
                        if (this.getTile(x, y) === TILE.BAR) {
                            barColumns.push({ x: x, y: y });
                            break;
                        }
                    }
                }

                if (barColumns.length > 0) {
                    barColumns.sort((a, b) => a.y - b.y);
                    const numToTake = Math.min(3, barColumns.length);
                    for (let i = 0; i < numToTake; i++) {
                        const col = barColumns[i];
                        for (let y = 0; y <= col.y; y++) {
                            if (this.getTile(col.x, y) === TILE.EMPTY) {
                                this.setTile(col.x, y, TILE.ESCAPE_LADDER);
                            }
                        }
                    }
                }
            }

            this.showMessage('ESCAPE TO TOP!');
            this.sound.play('escape');
        }

        updatePlayer() {
            const p = this.player;
            const keys = this.keys;
            const px = Math.floor(p.x + 0.5);
            const py = Math.floor(p.y + 0.5);

            const onLadder = this.isLadder(px, py);
            const onBar = this.isBar(px, py) || this.isBar(px, py - 1);
            const belowIsBar = this.isBar(px, py + 1);
            
            // False Floor (TRAP) check - falls through after 1 frame delay
            const onFalseFloor = this.isFalseFloor(px, py + 1);
            if (onFalseFloor) {
                p.falseFloorTimer++;
                // Original rule: 1 frame delay before falling through
                if (p.falseFloorTimer > 1) {
                    // Allow falling through false floor
                }
            } else {
                p.falseFloorTimer = 0;
            }
            
            const onGround = (this.isSolidForPlayer(px, py + 1) || this.isLadder(px, py) || this.isLadder(px, py + 1)) 
                && !(onFalseFloor && p.falseFloorTimer > 1)
                && !this.isDugHole(px, py + 1);
            
            // Check for trapped entity (player or enemy) below player - can walk on their head
            const onTrappedEntity = this.getTrappedEntityAtTile(px, py + 1);

            // Check if player is in a hole - fall through if below is empty
            if (p.trapped > 0) {
                p.trapped--;
                const holeX = Math.floor(p.x);
                const holeY = Math.floor(p.y);
                
                // Lock player in hole position
                p.x = holeX + 0.5;
                p.vx = 0;
                p.vy = 0;

                // If below is empty or hole, fall through instead of staying trapped
                const belowTile = this.getTile(holeX, holeY + 1);
                const belowIsHole = this.isDugHole(holeX, holeY + 1);
                if (belowTile === TILE.EMPTY || belowIsHole) {
                    p.trapped = 0;
                } else if (trappedEnemy) {
                    // Player can walk on trapped enemy to escape
                    if (keys.LEFT && holeX > 0 && !this.isSolidForPlayer(holeX - 1, holeY)) {
                        p.trapped = 0;
                        p.x = holeX - 1;
                        p.y = holeY - 1;
                        p.dir = -1;
                    } else if (keys.RIGHT && holeX < LEVEL_WIDTH - 1 && !this.isSolidForPlayer(holeX + 1, holeY)) {
                        p.trapped = 0;
                        p.x = holeX + 1;
                        p.y = holeY - 1;
                        p.dir = 1;
                    }
                }

                // Try to escape after hole fills (original C64 behavior)
                if (p.trapped <= 0) {
                    // Player escapes when hole fills - same as original
                    p.trapped = 0;
                }
                
                // Don't process normal movement when trapped (unless escaping via trapped enemy)
                if (p.trapped > 0) {
                    return;
                }
            }

            // Check if player falls into a trap/hole
            // Apple II original: player CANNOT climb out of holes (unlike enemies)
            if (!onGround && !onLadder && !onBar && p.vy > 0) {
                for (const hole of this.dugHoles) {
                    // Check if player is over this hole (including edge cases)
                    // Allow for player being on the edge of the hole
                    const playerLeft = p.x - 0.3;
                    const playerRight = p.x + 0.3;
                    const playerBottom = p.y;
                    const playerTop = p.y + 1;
                    
                    const isOverHoleX = playerRight > hole.x && playerLeft < hole.x + 1;
                    const isOverHoleY = playerBottom < hole.y + 1 && playerTop > hole.y;
                    
                    if (isOverHoleX && isOverHoleY) {
                        // Only trap if hole is not already occupied
                        if (!this.isHoleOccupied(hole.x, hole.y, null)) {
                            // If below is empty or is also a hole, keep falling through (don't trap)
                            const belowTile = this.getTile(hole.x, hole.y + 1);
                            const belowIsHole = this.isDugHole(hole.x, hole.y + 1);
                            if (belowTile === TILE.EMPTY || belowIsHole) {
                                // Keep falling - don't trap
                                break;
                            }
                            // Trap player in hole
                            p.trapped = HOLE_FILL_TIME;
                            p.x = hole.x + 0.5;
                            p.y = hole.y;
                            p.vx = 0;
                            p.vy = 0;
                            this.sound.play('trap');
                            break;
                        }
                    }
                }
            }

            // Gravity
            if (!onGround && !onLadder && !onBar && !onTrappedEntity) {
                p.vy = 0.25 * this.speedMultiplier;
            } else {
                p.vy = 0;
                // Snap to trapped entity head when standing on them
                if (onTrappedEntity && !onGround && !onLadder && !onBar) {
                    p.y = Math.floor(onTrappedEntity.y) - 1;
                }
            }

            // Movement
            p.vx = 0;
            const baseSpeed = PLAYER_SPEED * this.speedMultiplier;
            // Rope movement is faster (original speedrun exploit)
            const speed = onBar ? baseSpeed * ROPE_SPEED_MULTIPLIER : baseSpeed;

            if (keys.LEFT && !this.isSolidForPlayer(px - 1, py)) {
                if (onGround || onLadder || onBar || onTrappedEntity || p.vy > 0) {
                    p.vx = -speed;
                    p.dir = -1;
                }
            } else if (keys.RIGHT && !this.isSolidForPlayer(px + 1, py)) {
                if (onGround || onLadder || onBar || onTrappedEntity || p.vy > 0) {
                    p.vx = speed;
                    p.dir = 1;
                }
            }

            if (keys.UP && (onLadder || this.isLadder(px, py - 1))) {
                if (!this.isSolidForPlayer(px, py - 1)) {
                    p.vy = -speed;
                    p.vx = 0;
                }
            }
            
            if (keys.DOWN) {
                if (onLadder || this.isLadder(px, py + 1)) {
                    if (!this.isSolidForPlayer(px, py + 1)) {
                        p.vy = speed;
                        p.vx = 0;
                    }
                } else if (onBar) {
                    // Drop from bar with DOWN key - always allow if on bar and below is not solid
                    p.vy = speed;
                    p.vx = 0;
                }
            }

            // Auto-grab bar when running into it from below (Apple II original mechanic)
            // Check if player is running and bar is at current position (slightly above)
            if (!onLadder && !onBar && p.vx !== 0 && this.isBar(px, py - 1)) {
                // Snap to bar above
                p.y = py - 1;
                p.vx = 0;
                // Continue moving horizontally on bar
                if (keys.LEFT && !this.isSolidForPlayer(px - 1, py - 1)) {
                    p.vx = -speed;
                    p.dir = -1;
                } else if (keys.RIGHT && !this.isSolidForPlayer(px + 1, py - 1)) {
                    p.vx = speed;
                    p.dir = 1;
                }
            }

            // Auto-grab bar when jumping/falling into it from below
            if (!onLadder && !onBar && p.vy > 0 && this.isBar(px, py - 1)) {
                // Grab the bar
                p.y = py - 1;
                p.vy = 0;
            }

            p.x += p.vx;
            p.y += p.vy;

            p.x = Math.max(0, Math.min(p.x, LEVEL_WIDTH - 1));
            p.y = Math.max(0, Math.min(p.y, LEVEL_HEIGHT - 1));

            // Snap Y position when not on ladder/bar but on solid ground
            // This prevents floating appearance when stepping off ladders mid-tile
            if (!onLadder && !onBar && p.vy === 0) {
                const newPx = Math.floor(p.x + 0.5);
                const newPy = Math.floor(p.y + 0.5);
                const newOnGround = this.isSolidForPlayer(newPx, newPy + 1) || this.isLadder(newPx, newPy + 1);
                if (newOnGround) {
                    p.y = Math.round(p.y);
                }
            }

            // Digging
            if (keys.DIGL || keys.DIGR) {
                const digDir = keys.DIGL ? -1 : 1;
                const digX = px + digDir;
                const digY = py + 1;

                // Validate dig position and conditions
                if ((onGround || onLadder || onBar) &&
                    digX >= 0 && digX < LEVEL_WIDTH && digY >= 0 && digY < LEVEL_HEIGHT &&
                    !this.isSolidForPlayer(px + digDir, py)) {
                    this.dig(digX, digY);
                }
                keys.DIGL = false;
                keys.DIGR = false;
            }

            this.collectGold(p.x, p.y);

            if (p.vx !== 0 || p.vy !== 0) {
                p.frame = (p.frame + 1) % 8;

                // Play movement sounds every 4 frames
                if (p.frame % 4 === 0) {
                    if (onBar) {
                        this.sound.play('bar');
                    } else if (onLadder && p.vy !== 0) {
                        this.sound.play('climb');
                    } else if (onGround && p.vx !== 0) {
                        this.sound.play('step');
                    }
                }
            }

            // Play fall sound when dropping from bar
            if (!onGround && !onLadder && !onBar && p.vy > 0 && !p.wasFalling) {
                this.sound.play('fall');
            }
            p.wasFalling = (!onGround && !onLadder && !onBar && p.vy > 0);

            // Level complete when player reaches top of the level with escape ladder active
            // Check: player is at top row (y < 0.5) OR player is on escape ladder at row 0
            if (this.escapeLadderActive) {
                const atTop = p.y < 0.5;
                const onEscapeLadder = this.getTile(px, 0) === TILE.ESCAPE_LADDER && py === 0;
                if (atTop || onEscapeLadder) {
                    this.levelComplete();
                }
            }
        }

        updateEnemies() {
            const p = this.player;

            for (const e of this.enemies) {
                const ex = Math.floor(e.x + 0.5);
                const ey = Math.floor(e.y + 0.5);

                // Check if enemy is in or falling into a hole
                if (!e.trapped) {
                    // Check current position
                    let caughtInHole = false;
                    const checkX = Math.floor(e.x + 0.5);

                    // Check holes at current and nearby Y positions (for falling enemies)
                    for (const hole of this.dugHoles) {
                        if (hole.x === checkX) {
                            // Check if enemy is at or passing through this hole
                            const enemyTop = e.y;
                            const enemyBottom = e.y + 0.8;
                            const holeTop = hole.y;
                            const holeBottom = hole.y + 1;

                            // If enemy overlaps with hole vertically
                            if (enemyBottom > holeTop && enemyTop < holeBottom) {
                                // Only trap if hole is not already occupied
                                if (!this.isHoleOccupied(hole.x, hole.y, e)) {
                                    e.trapped = ENEMY_TRAPPED_TIME;
                                    e.x = hole.x + 0.5;
                                    e.y = hole.y;
                                    e.vx = 0;
                                    e.vy = 0;
                                    this.sound.play('trap');
                                    caughtInHole = true;
                                    this.score += 75;  // C64 original: trapping enemy 75 points
                                    this.updateUI();

                                    if (e.hasGold) {
                                        e.hasGold = false;
                                        this.sound.play('drop');
                                        if (this.getTile(hole.x, hole.y - 1) === TILE.EMPTY) {
                                            this.setTile(hole.x, hole.y - 1, TILE.GOLD);
                                        }
                                    }
                                    break;
                                }
                            }
                        }
                    }

                    if (caughtInHole) continue;
                }

                if (e.trapped > 0) {
                    e.trapped--;
                    const holeX = Math.floor(e.x);
                    const holeY = Math.floor(e.y);

                    // Keep enemy locked in hole position
                    e.x = holeX + 0.5;
                    e.vx = 0;
                    e.vy = 0;

                    if (e.trapped < ENEMY_TRAPPED_ESCAPE && !this.isSolidOrBrick(holeX, holeY - 1)) {
                        e.y -= 0.025;
                        // Escape when climbing out of hole
                        if (e.y <= holeY - 1) {
                            e.trapped = 0;
                            e.y = holeY - 1;
                        }
                    } else {
                        // Keep at hole position while trapped
                        e.y = holeY;
                    }
                    continue;
                }

                const onLadder = this.isLadder(ex, ey);
                const onBar = this.isBar(ex, ey);
                const belowIsLadder = this.isLadder(ex, ey + 1);
                const belowSolid = this.isSolidOrBrick(ex, ey + 1);
                
                // False Floor (TRAP) - enemies fall through more easily (no delay)
                const onFalseFloor = this.isFalseFloor(ex, ey + 1);
                
                // Original rule: enemies fall through false floor immediately (no 1-frame delay)
                const onGround = (belowSolid || onLadder || belowIsLadder) && !onFalseFloor;
                
                // Check for trapped player or enemy below (can walk on their head)
                const onTrappedEntity = this.getTrappedEntityAtTile(ex, ey + 1);
                const onTrappedBelow = onTrappedEntity !== null;

                e.vx = 0;
                e.vy = 0;

                // Falling check - not on ground, ladder, bar, or trapped entity
                if (!onGround && !onLadder && !onBar && !onTrappedBelow) {
                    e.vy = 0.2 * this.speedMultiplier;
                } else {
                    // Chase player
                    const dx = p.x - e.x;
                    const dy = p.y - e.y;
                    const speed = 0.06 * this.speedMultiplier;

                    // Movement checks - enemies can walk ON BRICK but not THROUGH BRICK
                    const canLeft = ex > 0 && !this.isSolidOrBrick(ex - 1, ey);
                    const canRight = ex < LEVEL_WIDTH - 1 && !this.isSolidOrBrick(ex + 1, ey);
                    const canUp = ey > 0 && !this.isSolidOrBrick(ex, ey - 1) && (onLadder || this.isLadder(ex, ey - 1));
                    const canDown = ey < LEVEL_HEIGHT - 1 && !this.isSolidOrBrick(ex, ey + 1) && (onLadder || belowIsLadder);

                    // Simple AI: prioritize direction toward player
                    if (onLadder || onTrappedBelow) {
                        // On ladder or trapped entity - prefer vertical movement
                        if (dy < -0.5 && canUp) {
                            e.vy = -speed;
                        } else if (dy > 0.5 && canDown) {
                            e.vy = speed;
                        } else if (dx < -0.5 && canLeft) {
                            e.vx = -speed;
                            e.dir = -1;
                        } else if (dx > 0.5 && canRight) {
                            e.vx = speed;
                            e.dir = 1;
                        } else if (canUp) {
                            e.vy = -speed;
                        } else if (canDown) {
                            e.vy = speed;
                        }
                    } else if (onBar) {
                        // On bar - move horizontally or drop
                        if (dy > 1 && !belowSolid && Math.abs(dx) < 2) {
                            // Drop toward player below
                            e.vy = 0.2 * this.speedMultiplier;
                        } else if (dx < -0.5 && canLeft) {
                            e.vx = -speed;
                            e.dir = -1;
                        } else if (dx > 0.5 && canRight) {
                            e.vx = speed;
                            e.dir = 1;
                        } else if (canLeft) {
                            e.vx = -speed;
                            e.dir = -1;
                        } else if (canRight) {
                            e.vx = speed;
                            e.dir = 1;
                        }
                    } else if (onGround || onTrappedBelow) {
                        // On ground or trapped entity - chase player
                        const sameColumn = Math.abs(dx) < 0.5;

                        if (sameColumn && dy !== 0) {
                            // Same X as player but different floor - need to find ladder
                            if (dy < 0 && canUp) {
                                // Player above and can go up
                                e.vy = -speed;
                            } else if (dy > 0 && canDown) {
                                // Player below and can go down
                                e.vy = speed;
                            } else {
                                // Need to move horizontally to find a ladder
                                // Check which direction has a ladder
                                let leftLadderDist = 999, rightLadderDist = 999;
                                for (let searchX = ex - 1; searchX >= 0; searchX--) {
                                    if (this.isLadder(searchX, ey) || this.isLadder(searchX, ey + 1)) {
                                        leftLadderDist = ex - searchX;
                                        break;
                                    }
                                    if (this.isSolid(searchX, ey)) break;
                                }
                                for (let searchX = ex + 1; searchX < LEVEL_WIDTH; searchX++) {
                                    if (this.isLadder(searchX, ey) || this.isLadder(searchX, ey + 1)) {
                                        rightLadderDist = searchX - ex;
                                        break;
                                    }
                                    if (this.isSolid(searchX, ey)) break;
                                }

                                // Move toward closer ladder
                                if (leftLadderDist < rightLadderDist && canLeft) {
                                    e.vx = -speed;
                                    e.dir = -1;
                                } else if (rightLadderDist < 999 && canRight) {
                                    e.vx = speed;
                                    e.dir = 1;
                                } else if (canLeft) {
                                    e.vx = -speed;
                                    e.dir = -1;
                                } else if (canRight) {
                                    e.vx = speed;
                                    e.dir = 1;
                                }
                            }
                        } else {
                            // Different X - move horizontally toward player
                            if (dx < -0.5 && canLeft) {
                                e.vx = -speed;
                                e.dir = -1;
                            } else if (dx > 0.5 && canRight) {
                                e.vx = speed;
                                e.dir = 1;
                            } else if (dy < -0.5 && canUp) {
                                e.vy = -speed;
                            } else if (dy > 0.5 && canDown) {
                                e.vy = speed;
                            } else if (canLeft) {
                                e.vx = -speed;
                                e.dir = -1;
                            } else if (canRight) {
                                e.vx = speed;
                                e.dir = 1;
                            }
                        }
                    }
                }

                // Apply movement
                e.x += e.vx;
                e.y += e.vy;

                // Clamp to level bounds
                e.x = Math.max(0, Math.min(e.x, LEVEL_WIDTH - 1));
                e.y = Math.max(0, Math.min(e.y, LEVEL_HEIGHT - 1));

                // Snap Y when on solid ground or trapped entity (not ladder/bar)
                if ((onGround || onTrappedBelow) && !onLadder && !onBar && !belowIsLadder && e.vy >= 0) {
                    e.y = Math.round(e.y);
                }

                // Snap to trapped entity head when standing on it
                if (onTrappedBelow && onTrappedEntity) {
                    e.y = Math.floor(onTrappedEntity.y) - 1;
                }

                // Gold pickup with cooldown (Apple II original: 5% chance per frame when passing through)
                if (!e.hasGold && this.getTile(ex, ey) === TILE.GOLD) {
                    if (e.goldPickupCooldown <= 0 && Math.random() < GOLD_PICKUP_CHANCE) {
                        e.hasGold = true;
                        this.setTile(ex, ey, TILE.EMPTY);
                        e.goldPickupCooldown = GOLD_PICKUP_COOLDOWN;
                        this.sound.play('pickup');
                    }
                }
                if (e.goldPickupCooldown > 0) {
                    e.goldPickupCooldown--;
                }

                // Random gold drop while carrying (Apple II original: 2% chance)
                // Smart drop: enemy tries to drop gold in a safe place when being chased
                if (e.hasGold && Math.random() < GOLD_DROP_CHANCE) {
                    // Check if player is close and below - drop to create trap
                    const distToPlayer = Math.sqrt(dx * dx + dy * dy);
                    if (distToPlayer < 3 && dy > 0) {
                        // Drop gold to potentially trap player
                        if (this.getTile(ex, ey) === TILE.EMPTY) {
                            e.hasGold = false;
                            this.setTile(ex, ey, TILE.GOLD);
                            this.sound.play('drop');
                        }
                    } else if (Math.random() < 0.3) {
                        // Random drop
                        if (this.getTile(ex, ey) === TILE.EMPTY) {
                            e.hasGold = false;
                            this.setTile(ex, ey, TILE.GOLD);
                            this.sound.play('drop');
                        }
                    }
                }

                // Enemy with gold prioritizes escaping to the top (Apple II behavior)
                if (e.hasGold && (onGround || onTrappedBelow) && ey < 5) {
                    // Move toward left side of the map to escape (common pattern)
                    if (canLeft && ex > 3) {
                        e.vx = -speed;
                        e.dir = -1;
                    } else if (canRight && ex < LEVEL_WIDTH - 4) {
                        e.vx = speed;
                        e.dir = 1;
                    }
                }

                if (e.vx !== 0 || e.vy !== 0) {
                    e.frame = (e.frame + 1) % 8;
                }
            }
        }

        updateHoles() {
            for (let i = this.dugHoles.length - 1; i >= 0; i--) {
                const hole = this.dugHoles[i];
                hole.timer--;

                if (hole.timer <= 0) {
                    for (const e of this.enemies) {
                        if (Math.floor(e.x + 0.5) === hole.x && Math.floor(e.y + 0.5) === hole.y) {
                            this.score += 75;  // C64 original: enemy dies in hole 75 points
                            this.updateUI();
                            this.sound.play('kill');
                            this.respawnEnemy(e);
                        }
                    }

                    const px = Math.floor(this.player.x + 0.5);
                    const py = Math.floor(this.player.y + 0.5);
                    if (px === hole.x && py === hole.y) {
                        this.playerDie();
                    }

                    this.sound.play('fill');
                    this.setTile(hole.x, hole.y, TILE.BRICK);
                    this.dugHoles.splice(i, 1);
                }
            }
        }

        respawnEnemy(e) {
            // Drop gold before respawning (original game mechanic)
            if (e.hasGold) {
                const dropX = Math.floor(e.x + 0.5);
                const dropY = Math.floor(e.y + 0.5);
                // Try to drop at current position, or above if blocked
                if (this.getTile(dropX, dropY) === TILE.EMPTY) {
                    this.setTile(dropX, dropY, TILE.GOLD);
                } else if (dropY > 0 && this.getTile(dropX, dropY - 1) === TILE.EMPTY) {
                    this.setTile(dropX, dropY - 1, TILE.GOLD);
                }
                e.hasGold = false;
            }

            const spots = [];
            for (let x = 0; x < LEVEL_WIDTH; x++) {
                for (let y = 0; y < 3; y++) {
                    if (!this.isSolid(x, y)) spots.push({ x, y });
                }
            }
            if (spots.length > 0) {
                const spawn = spots[Math.floor(Math.random() * spots.length)];
                e.x = spawn.x;
                e.y = spawn.y;
            } else {
                e.x = e.startX;
                e.y = e.startY;
            }
            e.trapped = 0;
            e.goldPickupCooldown = 0;
            this.sound.play('respawn');
        }

        checkCollisions() {
            const p = this.player;

            // Skip collision check if player is trapped in a hole (enemies can walk on player's head)
            if (p.trapped > 0) {
                // But enemies can still attack player in hole
                for (const e of this.enemies) {
                    if (e.trapped > 0) continue; // Skip trapped enemies
                    
                    const dx = Math.abs(p.x - e.x);
                    const dy = p.y - e.y;
                    
                    // Enemy can attack player in hole if close enough
                    if (dx < 0.7 && dy > -0.3 && dy < 0.7) {
                        this.playerDie();
                        return;
                    }
                }
                return;
            }

            for (const e of this.enemies) {
                // Skip collision if enemy is trapped (player can walk on their head)
                if (e.trapped > 0) continue;

                const dx = Math.abs(p.x - e.x);
                const dy = p.y - e.y;

                // Player standing on enemy head - can walk on them
                if (dx < 0.7 && dy < -0.3 && dy > -0.8) {
                    // Player is on top of enemy - safe to walk
                    continue;
                }

                // Player dies if horizontally close and vertically overlapping (at same level)
                if (dx < 0.5 && dy > -0.3 && dy < 0.5) {
                    // Check if enemy has gold - player can steal it!
                    if (e.hasGold) {
                        e.hasGold = false;
                        // Original Apple II rule: can only carry 1 gold at a time
                        if (this.player.goldCount === 0) {
                            this.player.goldCount = 1;
                        }
                        this.goldCollected++;
                        this.score += 250;
                        this.sound.play('gold');
                        this.updateUI();
                        continue; // Don't die if stole gold
                    }
                    this.playerDie();
                    return;
                }
            }
        }

        playerDie() {
            if (this.gameState !== STATE.PLAYING) return;

            // Original Apple II: Drop gold when player dies (can only carry 1 gold)
            if (this.player && this.player.goldCount > 0) {
                const dropX = Math.floor(this.player.x + 0.5);
                const dropY = Math.floor(this.player.y + 0.5);
                
                // Can only carry 1 gold, so just drop one
                if (this.getTile(dropX, dropY) === TILE.EMPTY) {
                    this.setTile(dropX, dropY, TILE.GOLD);
                    this.player.goldCount = 0;
                } else if (dropY > 0 && this.getTile(dropX, dropY - 1) === TILE.EMPTY) {
                    this.setTile(dropX, dropY - 1, TILE.GOLD);
                    this.player.goldCount = 0;
                }
                this.escapeLadderActive = false;
            }

            this.gameState = STATE.DYING;
            this.lives--;
            this.updateUI();
            this.sound.play('die');
            this.deathTimer = DEATH_DELAY_FRAMES;
        }

        levelComplete() {
            this.gameState = STATE.LEVEL_COMPLETE;
            
            // C64: After completing all 150 levels, speed increases and game restarts
            if (this.currentLevel >= 150 && this.gameMode === 'classic') {
                this.speedMultiplier = Math.min(this.speedMultiplier + 0.15, 2.0); // Max 2x speed
                this.currentLevel = 1;
                this.score = 0;
                this.lives = 5;
                this.showMessage('SPEED UP! ' + Math.round(this.speedMultiplier * 100) + '%');
            } else {
                this.currentLevel++;
                this.score += 1500;  // C64 original: level complete 1500 points
                this.lives++;
            }
            this.goldCollected = 0;  //    
            this.escapeLadderActive = false;
            this.updateUI();
            this.showMessage('LEVEL ' + this.currentLevel);
            this.sound.play('levelup');
            this.levelCompleteTimer = LEVEL_COMPLETE_DELAY_FRAMES;
        }

        update() {
            if (this.gameState !== STATE.PLAYING) return;

            this.frameCount++;
            
            try {
                this.updatePlayer();
                this.updateEnemies();
                this.updateHoles();
                this.updateDigEffects();
                this.checkCollisions();
            } catch (e) {
                console.error('Update error:', e);
            }
        }

        // checkStuck disabled - was causing game freeze
        // Original Lode Runner doesn't have stuck detection
        checkStuck() {
            return;
        }

        findReachablePositions(startX, startY) {
            const reachable = new Set();
            const visited = new Set();
            const queue = [{ x: startX, y: startY }];

            visited.add(`${startX},${startY}`);

            while (queue.length > 0) {
                const { x, y } = queue.shift();
                reachable.add(`${x},${y}`);

                // Check all possible movements from this position
                const moves = this.getPossibleMoves(x, y);

                for (const move of moves) {
                    const key = `${move.x},${move.y}`;
                    if (!visited.has(key)) {
                        visited.add(key);
                        queue.push(move);
                    }
                }
            }

            return reachable;
        }

        // Check if position is a dug hole (will become solid again)
        isDugHole(x, y) {
            for (const hole of this.dugHoles) {
                if (hole.x === x && hole.y === y) {
                    return true;
                }
            }
            return false;
        }

        // For stuck detection: check if solid OR will become solid (dug hole)
        isSolidOrWillBe(x, y) {
            return this.isSolid(x, y) || this.isDugHole(x, y);
        }

        getPossibleMoves(x, y) {
            const moves = [];

            const currentTile = this.getTile(x, y);
            const belowTile = this.getTile(x, y + 1);
            const onLadder = currentTile === TILE.LADDER || currentTile === TILE.ESCAPE_LADDER;
            const onBar = currentTile === TILE.BAR;
            // Consider dug holes as ground (they will fill back up)
            const onGround = this.isSolidOrWillBe(x, y + 1) ||
                            belowTile === TILE.LADDER ||
                            currentTile === TILE.LADDER ||
                            currentTile === TILE.ESCAPE_LADDER;

            // Check for trapped enemy below (can stand on)
            let onTrappedEnemy = false;
            for (const e of this.enemies) {
                if (e.trapped > 0 && Math.floor(e.x) === x && Math.floor(e.y) === y + 1) {
                    onTrappedEnemy = true;
                    break;
                }
            }

            const canMove = onGround || onLadder || onBar || onTrappedEnemy;

            // Move left
            if (canMove && !this.isSolid(x - 1, y) && x > 0) {
                moves.push({ x: x - 1, y });
            }

            // Move right
            if (canMove && !this.isSolid(x + 1, y) && x < LEVEL_WIDTH - 1) {
                moves.push({ x: x + 1, y });
            }

            // Move up (ladder only)
            if ((onLadder || this.isLadder(x, y - 1)) && !this.isSolid(x, y - 1) && y > 0) {
                moves.push({ x, y: y - 1 });
            }

            // Move down (ladder or falling) - but don't intentionally fall into dug holes
            if (y < LEVEL_HEIGHT - 1 && !this.isSolid(x, y + 1)) {
                // For stuck detection: avoid falling into dug holes (player wouldn't do this)
                // But allow if there's a ladder or bar below
                const belowIsHole = this.isDugHole(x, y + 1);
                const belowHasLadder = this.isLadder(x, y + 1);
                const belowHasBar = this.isBar(x, y + 1);
                if (!belowIsHole || belowHasLadder || belowHasBar) {
                    moves.push({ x, y: y + 1 });
                }
            }

            // Dig left (creates path through brick below-left)
            // Only add if player can escape from the dug position
            if (canMove && x > 0 && !this.isSolid(x - 1, y)) {
                const digTarget = this.getTile(x - 1, y + 1);
                if (digTarget === TILE.BRICK || digTarget === TILE.TRAP) {
                    // Check if player can escape from the dug hole
                    // Player can escape if there's an opening to the side
                    const canEscapeLeft = x > 1 && !this.isSolid(x - 2, y + 1);
                    const canEscapeRight = !this.isSolid(x, y + 1) || this.isSolid(x, y + 2);
                    // Also reachable if there's a ladder or bar in the dug position
                    const hasLadderOrBar = this.isLadder(x - 1, y + 1) || this.isBar(x - 1, y + 1);

                    if (canEscapeLeft || canEscapeRight || hasLadderOrBar) {
                        moves.push({ x: x - 1, y: y + 1 });
                    }
                    // Even if can't escape, the position above the dig (x-1, y) is still reachable
                    // This is already handled by the "move left" logic
                }
            }

            // Dig right (creates path through brick below-right)
            // Only add if player can escape from the dug position
            if (canMove && x < LEVEL_WIDTH - 1 && !this.isSolid(x + 1, y)) {
                const digTarget = this.getTile(x + 1, y + 1);
                if (digTarget === TILE.BRICK || digTarget === TILE.TRAP) {
                    // Check if player can escape from the dug hole
                    const canEscapeRight = x < LEVEL_WIDTH - 2 && !this.isSolid(x + 2, y + 1);
                    const canEscapeLeft = !this.isSolid(x, y + 1) || this.isSolid(x, y + 2);
                    const hasLadderOrBar = this.isLadder(x + 1, y + 1) || this.isBar(x + 1, y + 1);

                    if (canEscapeRight || canEscapeLeft || hasLadderOrBar) {
                        moves.push({ x: x + 1, y: y + 1 });
                    }
                }
            }

            // Special case: if on bar, can drop off
            if (onBar && !this.isSolid(x, y + 1)) {
                // Don't drop into dug holes (same check as regular down movement)
                const belowIsHole = this.isDugHole(x, y + 1);
                if (!belowIsHole) {
                    moves.push({ x, y: y + 1 });
                }
            }

            return moves;
        }

        triggerStuck(reason) {
            if (this.gameState !== STATE.PLAYING) return;

            // DEMO       
            if (this.demoMode) {
                this.currentLevel = Math.floor(Math.random() * Math.min(10, this.activeLevels.length)) + 1;
                this.loadLevel(this.currentLevel);
                this.gameState = STATE.PLAYING;
                this.showMessage('DEMO - PRESS ENTER TO PLAY');
                return;
            }

            this.gameState = STATE.STUCK;
            this.stuckReason = reason;
            this.sound.play('stuck');
            this.showDeathOverlay('LEVEL IMPOSSIBLE!', reason);
        }

        showDeathOverlay(title, reason) {
            if (this.deathOverlay) {
                this.deathTitle.textContent = title;
                this.deathReason.innerHTML = reason + '<br><br>You will lose 1 life.';
                this.deathOverlay.classList.add('visible');
            }
        }

        hideDeathOverlay() {
            if (this.deathOverlay) {
                this.deathOverlay.classList.remove('visible');
            }
        }

        // ============================================
        // VECTOR GRAPHICS RENDERING
        // ============================================

        render() {
            const ctx = this.ctx;
            const T = TILE_SIZE;

            // Render editor mode
            if (this.gameState === STATE.EDITOR) {
                this.renderEditor();
                return;
            }

            // Render title screen with C64 style
            if (this.gameState === STATE.TITLE) {
                this.renderTitleScreen(ctx);
                return;
            }

            // C64 style: pure black background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw tiles
            for (let y = 0; y < LEVEL_HEIGHT; y++) {
                for (let x = 0; x < LEVEL_WIDTH; x++) {
                    this.drawTile(x, y, this.level[y][x]);
                }
            }

            // Draw filling holes
            for (const hole of this.dugHoles) {
                // Original Apple II: last 1 second (~30 frames) has blinking effect
                if (hole.timer < 30 && Math.floor(this.frameCount / 8) % 2 === 0) {
                    // Blinking effect when hole is about to fill
                    this.drawBrick(hole.x, hole.y);
                } else if (hole.timer < 50) {
                    const fillAmt = 1 - (hole.timer / 50);
                    this.drawBrickPartial(hole.x, hole.y, fillAmt);
                }
            }

            // Draw enemies
            for (const e of this.enemies) {
                this.drawEnemy(e);
            }

            // Draw player
            if (this.player && this.gameState !== STATE.DYING) {
                this.drawPlayer(this.player);
            } else if (this.gameState === STATE.DYING && Math.floor(this.frameCount / 4) % 2 === 0) {
                this.drawPlayer(this.player);
            }

            // C64 style: Screen flash on death
            if (this.gameState === STATE.DYING) {
                const flashAlpha = 0.3 + Math.sin(this.frameCount * 0.5) * 0.2;
                ctx.fillStyle = COLORS.RED;
                ctx.globalAlpha = flashAlpha;
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                ctx.globalAlpha = 1;
            }

            // C64 style: Level complete flash
            if (this.gameState === STATE.LEVEL_COMPLETE) {
                const flashAlpha = 0.15 + Math.sin(this.frameCount * 0.3) * 0.1;
                ctx.fillStyle = COLORS.GREEN;
                ctx.globalAlpha = flashAlpha;
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                ctx.globalAlpha = 1;
            }

            // C64 style: Pause overlay
            if (this.gameState === STATE.PAUSED) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                
                ctx.textAlign = 'center';
                ctx.font = `bold ${s(32)}px monospace`;
                ctx.fillStyle = COLORS.YELLOW;
                ctx.fillText('PAUSED', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
                
                ctx.font = `${s(14)}px monospace`;
                ctx.fillStyle = COLORS.CYAN;
                const blink = Math.floor(this.frameCount / 30) % 2;
                if (blink) {
                    ctx.fillText('PRESS ENTER TO RESUME', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + s(40));
                }
                ctx.textAlign = 'left';
            }

            // C64 style: Game Over overlay
            if (this.gameState === STATE.GAME_OVER) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.85)';
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                
                ctx.textAlign = 'center';
                ctx.font = `bold ${s(36)}px monospace`;
                ctx.fillStyle = COLORS.RED;
                ctx.fillText('GAME OVER', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 - s(20));
                
                ctx.font = `${s(14)}px monospace`;
                ctx.fillStyle = COLORS.YELLOW;
                ctx.fillText('FINAL SCORE: ' + this.score, CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + s(20));
                
                ctx.fillStyle = COLORS.CYAN;
                const blink = Math.floor(this.frameCount / 30) % 2;
                if (blink) {
                    ctx.fillText('PRESS ENTER TO CONTINUE', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + s(60));
                }
                ctx.textAlign = 'left';
            }

            // C64 style: Stuck overlay
            if (this.gameState === STATE.STUCK) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                
                ctx.textAlign = 'center';
                ctx.font = `bold ${s(32)}px monospace`;
                ctx.fillStyle = COLORS.YELLOW;
                ctx.fillText('STUCK!', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 - s(20));
                
                ctx.font = `${s(12)}px monospace`;
                ctx.fillStyle = COLORS.RED;
                ctx.fillText(this.stuckReason || 'NO WAY OUT', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + s(20));
                
                ctx.fillStyle = COLORS.CYAN;
                const blink = Math.floor(this.frameCount / 30) % 2;
                if (blink) {
                    ctx.fillText('PRESS R TO RESTART', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + s(50));
                }
                ctx.textAlign = 'left';
            }

            // Draw digging effects (pickaxe swing)
            for (const eff of this.diggingEffects) {
                this.drawDiggingEffect(eff);
            }

            // Draw debris particles (C64 style - simple squares)
            for (const p of this.digParticles) {
                const alpha = p.life / 30;
                ctx.fillStyle = p.color;
                ctx.globalAlpha = alpha;
                // Simple square particles (C64 style)
                const size = p.size * 0.5;
                ctx.fillRect(p.x - size/2, p.y - size/2, size, size);
                ctx.globalAlpha = 1;
            }
        }

        drawDiggingEffect(eff) {
            const ctx = this.ctx;
            const T = TILE_SIZE;
            const s = (v) => v * SCALE;

            const px = eff.x * T;
            const py = eff.y * T;
            const progress = eff.frame / eff.maxFrames;

            // C64 style: Simple pickaxe (white line drawing)
            const swingAngle = Math.sin(progress * Math.PI) * 0.8;
            const pickX = px + T * 0.5 + eff.dir * T * 0.25;
            const pickY = py - T * 0.1;

            ctx.save();
            ctx.translate(pickX, pickY);
            ctx.rotate(eff.dir * swingAngle - eff.dir * 0.3);

            // Simple white pickaxe (C64 style)
            ctx.strokeStyle = COLORS.WHITE;
            ctx.lineWidth = s(2);
            ctx.lineCap = 'round';

            // Handle (line)
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(eff.dir * T * 0.25, -T * 0.2);
            ctx.stroke();

            // Pickaxe head (simple arc)
            const headX = eff.dir * T * 0.25;
            const headY = -T * 0.2;
            ctx.beginPath();
            ctx.arc(headX, headY, T * 0.12, -Math.PI * 0.7, Math.PI * 0.2);
            ctx.stroke();

            ctx.restore();

            // C64 style: Simple dust particles (white squares)
            if (progress > 0.3 && progress < 0.8) {
                const dustCount = 3;
                for (let i = 0; i < dustCount; i++) {
                    const dustX = px + T * 0.3 + (i * T * 0.2) + eff.dir * T * 0.1;
                    const dustY = py + T * 0.4 + Math.random() * T * 0.3;
                    const dustSize = s(2 + Math.random() * 2);
                    
                    ctx.fillStyle = COLORS.LIGHT_GRAY;
                    ctx.fillRect(dustX, dustY, dustSize, dustSize);
                }
            }

            // Simple crack effect on brick (C64 style lines)
            if (progress < 0.6) {
                const crackAlpha = progress * 2;
                ctx.strokeStyle = `rgba(0, 0, 0, ${crackAlpha})`;
                ctx.lineWidth = s(1);

                ctx.beginPath();
                ctx.moveTo(px + T * 0.4, py + T * 0.3);
                ctx.lineTo(px + T * 0.5, py + T * 0.6);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(px + T * 0.5, py + T * 0.6);
                ctx.lineTo(px + T * 0.6, py + T * 0.4);
                ctx.stroke();
            }
        }

        renderEditor() {
            const ctx = this.ctx;
            const T = TILE_SIZE;

            // C64 style: pure black background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw editor level
            for (let y = 0; y < LEVEL_HEIGHT; y++) {
                for (let x = 0; x < LEVEL_WIDTH; x++) {
                    this.drawTile(x, y, this.editorLevel[y][x]);
                }
            }

            // Draw player
            if (this.editorPlayer) {
                ctx.fillStyle = COLORS.CYAN;
                ctx.beginPath();
                ctx.arc(
                    (this.editorPlayer.x + 0.5) * T,
                    (this.editorPlayer.y + 0.5) * T,
                    T * 0.3, 0, Math.PI * 2
                );
                ctx.fill();
            }

            // Draw enemies
            if (this.editorEnemies) {
                for (const e of this.editorEnemies) {
                    ctx.fillStyle = COLORS.RED;
                    ctx.beginPath();
                    ctx.arc(
                        (e.x + 0.5) * T,
                        (e.y + 0.5) * T,
                        T * 0.3, 0, Math.PI * 2
                    );
                    ctx.fill();
                }
            }

            // Draw selected tile indicator
            ctx.fillStyle = '#FFFFFF';
            ctx.font = `${Math.round(16 * SCALE)}px monospace`;
            ctx.fillText('Selected: ' + this.getTileName(this.editorTile), 10, CANVAS_HEIGHT - 10);

            // Draw tile palette
            const paletteY = CANVAS_HEIGHT - 40 * SCALE;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, paletteY, CANVAS_WIDTH, 40 * SCALE);
            
            const tiles = [
                { tile: TILE.EMPTY, label: '1:Empty' },
                { tile: TILE.BRICK, label: '2:Brick' },
                { tile: TILE.SOLID, label: '3:Solid' },
                { tile: TILE.LADDER, label: '4:Ladder' },
                { tile: TILE.BAR, label: '5:Bar' },
                { tile: TILE.TRAP, label: '6:Trap' },
                { tile: TILE.GOLD, label: '7:Gold' },
                { tile: TILE.ESCAPE_LADDER, label: '8:EscLdr' }
            ];
            
            let x = 10;
            for (const t of tiles) {
                ctx.fillStyle = t.tile === this.editorTile ? '#FFFF00' : '#FFFFFF';
                ctx.font = `${Math.round(12 * SCALE)}px monospace`;
                ctx.fillText(t.label, x, paletteY + 20 * SCALE);
                x += 80 * SCALE;
            }
        }

        renderTitleScreen(ctx) {
            const s = (v) => v * SCALE;
            
            // Pure black background
            ctx.fillStyle = COLORS.BLACK;
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // C64 style title text
            ctx.textAlign = 'center';
            
            // Main title - C64 style
            const titleY = CANVAS_HEIGHT * 0.25;
            ctx.font = `bold ${s(36)}px monospace`;
            
            // LODE RUNNER title with animation
            const pulse = Math.sin(this.frameCount * 0.1) * 0.15 + 0.85;
            ctx.globalAlpha = pulse;
            
            // Red title
            ctx.fillStyle = COLORS.RED;
            ctx.fillText('LODE RUNNER', CANVAS_WIDTH / 2, titleY);
            
            // White border effect
            ctx.strokeStyle = COLORS.WHITE;
            ctx.lineWidth = s(2);
            ctx.strokeText('LODE RUNNER', CANVAS_WIDTH / 2, titleY);
            ctx.globalAlpha = 1;

            // Subtitle
            ctx.font = `bold ${s(16)}px monospace`;
            ctx.fillStyle = COLORS.CYAN;
            const modeText = this.gameMode === 'championship' ? 'CHAMPIONSHIP' : 'CLASSIC';
            ctx.fillText(`${modeText} EDITION`, CANVAS_WIDTH / 2, titleY + s(35));

            // Level count
            ctx.font = `${s(12)}px monospace`;
            ctx.fillStyle = COLORS.LIGHT_GRAY;
            const levelCount = this.gameMode === 'championship' ? '50 LEVELS' : '150 LEVELS';
            ctx.fillText(`${levelCount}`, CANVAS_WIDTH / 2, titleY + s(60));

            // Instructions
            ctx.font = `${s(14)}px monospace`;
            ctx.fillStyle = COLORS.YELLOW;
            const blink = Math.floor(this.frameCount / 30) % 2;
            if (blink) {
                ctx.fillText('PRESS ENTER TO START', CANVAS_WIDTH / 2, CANVAS_HEIGHT * 0.55);
            }

            // Credits
            ctx.font = `${s(10)}px monospace`;
            ctx.fillStyle = COLORS.GRAY;
            ctx.fillText('(C) 1983 BRODERBUND SOFTWARE', CANVAS_WIDTH / 2, CANVAS_HEIGHT * 0.75);
            ctx.fillText('A DOUG SMITH PRODUCTION', CANVAS_WIDTH / 2, CANVAS_HEIGHT * 0.78);

            // Controls info
            ctx.fillStyle = COLORS.CYAN;
            ctx.fillText('CONTROLS: ARROWS/WASD - MOVE | Z/X - DIG', CANVAS_WIDTH / 2, CANVAS_HEIGHT * 0.88);
            ctx.fillText('ENTER - START/PAUSE | ESC - PAUSE | R - RESTART', CANVAS_WIDTH / 2, CANVAS_HEIGHT * 0.93);

            ctx.textAlign = 'left';
        }

        getTileName(tile) {
            switch (tile) {
                case TILE.EMPTY: return 'Empty';
                case TILE.BRICK: return 'Brick';
                case TILE.SOLID: return 'Solid';
                case TILE.LADDER: return 'Ladder';
                case TILE.BAR: return 'Bar';
                case TILE.TRAP: return 'Trap';
                case TILE.GOLD: return 'Gold';
                case TILE.ESCAPE_LADDER: return 'EscapeLadder';
                default: return 'Unknown';
            }
        }

        drawTile(x, y, tile) {
            const ctx = this.ctx;
            const T = TILE_SIZE;
            const px = x * T;
            const py = y * T;
            const s = (v) => v * SCALE; // Scale helper

            switch (tile) {
                case TILE.BRICK:
                    this.drawBrick(px, py);
                    break;

                case TILE.SOLID:
                    // C64 style: blue/gray solid block
                    ctx.fillStyle = COLORS.BLUE;
                    ctx.fillRect(px, py, T, T);
                    
                    // Simple texture pattern
                    ctx.fillStyle = '#1A1449'; // darker blue
                    ctx.fillRect(px + T * 0.1, py + T * 0.1, T * 0.35, T * 0.35);
                    ctx.fillRect(px + T * 0.55, py + T * 0.55, T * 0.35, T * 0.35);
                    
                    // Border
                    ctx.strokeStyle = COLORS.LIGHT_BLUE;
                    ctx.lineWidth = s(1);
                    ctx.strokeRect(px + s(1), py + s(1), T - s(2), T - s(2));
                    break;
                    // Border
                    this.drawRoundRect(px, py, T, T, s(2));
                    ctx.strokeStyle = '#303030';
                    ctx.lineWidth = s(1);
                    ctx.stroke();
                    break;

                case TILE.LADDER:
                    // C64 style: simple wooden ladder
                    ctx.fillStyle = COLORS.YELLOW;
                    // Left rail
                    ctx.fillRect(px + T * 0.15, py, T * 0.1, T);
                    // Right rail
                    ctx.fillRect(px + T * 0.75, py, T * 0.1, T);
                    // Rungs
                    ctx.fillStyle = COLORS.ORANGE;
                    for (let i = 0; i < 3; i++) {
                        ctx.fillRect(px + T * 0.25, py + T * 0.15 + i * T * 0.35, T * 0.5, T * 0.08);
                    }
                    break;

                case TILE.ESCAPE_LADDER:
                    // C64 style: flashing escape ladder
                    const flash = Math.floor(this.frameCount / 4) % 2;
                    ctx.fillStyle = flash ? COLORS.YELLOW : COLORS.LIGHT_GREEN;
                    // Left rail
                    ctx.fillRect(px + T * 0.15, py, T * 0.1, T);
                    // Right rail
                    ctx.fillRect(px + T * 0.75, py, T * 0.1, T);
                    // Rungs
                    for (let i = 0; i < 3; i++) {
                        ctx.fillRect(px + T * 0.25, py + T * 0.15 + i * T * 0.35, T * 0.5, T * 0.08);
                    }
                    break;

                case TILE.BAR:
                    // C64 style: simple horizontal bar
                    ctx.fillStyle = COLORS.LIGHT_GRAY;
                    ctx.fillRect(px, py + T * 0.35, T, T * 0.2);
                    ctx.strokeStyle = COLORS.GRAY;
                    ctx.lineWidth = s(1);
                    ctx.strokeRect(px, py + T * 0.35, T, T * 0.2);
                    break;

                case TILE.TRAP:
                    // C64 style: dark trap door
                    ctx.fillStyle = COLORS.BLACK;
                    ctx.fillRect(px, py, T, T);
                    ctx.strokeStyle = COLORS.DARK_GRAY;
                    ctx.lineWidth = s(1);
                    ctx.strokeRect(px + s(1), py + s(1), T - s(2), T - s(2));
                    break;
                    ctx.moveTo(px + s(3), barY + s(3));
                    ctx.lineTo(px + T - s(3), barY + s(3));
                    ctx.stroke();

                    // Rivets
                    for (let i = 0; i < 4; i++) {
                        const rx = px + T * 0.1 + i * T * 0.27;
                        this.drawCircle(rx, barY + barH/2, s(3));
                        ctx.fillStyle = '#808080';
                        ctx.fill();
                        ctx.strokeStyle = '#404040';
                        ctx.lineWidth = s(1);
                        ctx.stroke();
                    }
                    break;

                case TILE.GOLD:
                    // C64 style: simple gold treasure (box shape)
                    const goldX = px + T * 0.5;
                    const goldY = py + T * 0.5;
                    
                    // Gold box (C64 style)
                    ctx.fillStyle = COLORS.YELLOW;
                    ctx.fillRect(px + T * 0.2, py + T * 0.15, T * 0.6, T * 0.7);
                    
                    // Dark border
                    ctx.strokeStyle = COLORS.ORANGE;
                    ctx.lineWidth = s(1);
                    ctx.strokeRect(px + T * 0.2, py + T * 0.15, T * 0.6, T * 0.7);
                    
                    // Shine line
                    ctx.fillStyle = COLORS.WHITE;
                    ctx.fillRect(px + T * 0.25, py + T * 0.2, T * 0.15, T * 0.1);
                    
                    // Center dot
                    ctx.fillStyle = COLORS.RED;
                    ctx.beginPath();
                    ctx.arc(goldX, goldY + T * 0.1, T * 0.08, 0, Math.PI * 2);
                    ctx.fill();
                    break;
            }
        }

        drawBrick(px, py) {
            const ctx = this.ctx;
            const T = TILE_SIZE;
            const s = (v) => v * SCALE;

            // C64 style: simple red brick
            // Fill with mortar color (dark brown)
            ctx.fillStyle = COLORS.BROWN;
            ctx.fillRect(px, py, T, T);

            // Draw brick pattern (simple red blocks - C64 red)
            const brickH = T * 0.28;
            const gap = s(1);

            // Row 1
            ctx.fillStyle = COLORS.RED;
            ctx.fillRect(px + gap, py + gap, T * 0.45, brickH);
            ctx.fillStyle = '#8B6B5C'; // darker red
            ctx.fillRect(px + T * 0.52, py + gap, T * 0.43, brickH);

            // Row 2 (offset)
            ctx.fillStyle = '#8B6B5C';
            ctx.fillRect(px + gap, py + T * 0.36, T * 0.2, brickH);
            ctx.fillStyle = COLORS.RED;
            ctx.fillRect(px + T * 0.28, py + T * 0.36, T * 0.44, brickH);
            ctx.fillStyle = '#7A5A4A';
            ctx.fillRect(px + T * 0.78, py + T * 0.36, T * 0.17, brickH);

            // Row 3
            ctx.fillStyle = '#8B6B5C';
            ctx.fillRect(px + gap, py + T * 0.68, T * 0.45, brickH);
            ctx.fillStyle = COLORS.RED;
            ctx.fillRect(px + T * 0.52, py + T * 0.68, T * 0.43, brickH);
        }

        drawBrickPartial(x, y, fillAmt) {
            const ctx = this.ctx;
            const T = TILE_SIZE;
            const px = x * T;
            const py = y * T;
            const h = T * fillAmt;
            const startY = py + T - h;
            const s = (v) => v * SCALE;

            // C64 style: Simple brick reforming (solid color with border)
            ctx.fillStyle = COLORS.RED;
            ctx.fillRect(px + s(1), startY, T - s(2), h);
            
            // Border
            ctx.strokeStyle = COLORS.BROWN;
            ctx.lineWidth = s(1);
            ctx.strokeRect(px + s(1), startY, T - s(2), h);

            // Simple line pattern (C64 style)
            if (h > T * 0.3) {
                ctx.fillStyle = COLORS.BROWN;
                ctx.fillRect(px + s(3), startY + h * 0.3, T - s(6), s(1));
            }
            if (h > T * 0.6) {
                ctx.fillRect(px + s(3), startY + h * 0.6, T - s(6), s(1));
            }
        }

        drawPlayer(p) {
            const ctx = this.ctx;
            const T = TILE_SIZE;
            const px = p.x * T;
            const py = p.y * T;
            const anim = (p.vx !== 0 || p.vy !== 0) ? Math.floor(p.frame / 2) % 4 : 0;
            const s = (v) => v * SCALE;
            const dir = p.dir || 1;

            // C64 style: simple stick figure (white)
            const lineWidth = s(2);
            ctx.strokeStyle = COLORS.WHITE;
            ctx.lineWidth = lineWidth;
            ctx.lineCap = 'round';

            // Head (circle)
            const headRadius = T * 0.15;
            const headX = px + T * 0.5 + dir * T * 0.03;
            ctx.beginPath();
            ctx.arc(headX, py + T * 0.2, headRadius, 0, Math.PI * 2);
            ctx.stroke();

            // Eyes (looking in direction)
            ctx.fillStyle = COLORS.BLACK;
            const eyeX1 = headX - dir * T * 0.05;
            const eyeX2 = headX + dir * T * 0.05;
            ctx.beginPath();
            ctx.arc(eyeX1, py + T * 0.18, s(1.5), 0, Math.PI * 2);
            ctx.arc(eyeX2, py + T * 0.18, s(1.5), 0, Math.PI * 2);
            ctx.fill();

            // Body (vertical line)
            ctx.beginPath();
            ctx.moveTo(px + T * 0.5, py + T * 0.35);
            ctx.lineTo(px + T * 0.5, py + T * 0.6);
            ctx.stroke();

            // Arms (based on animation)
            const armSwing = (anim === 1 || anim === 3) ? T * 0.1 : 0;
            ctx.beginPath();
            // Left arm
            ctx.moveTo(px + T * 0.5, py + T * 0.4);
            ctx.lineTo(px + T * 0.3 - armSwing, py + T * 0.55);
            // Right arm
            ctx.moveTo(px + T * 0.5, py + T * 0.4);
            ctx.lineTo(px + T * 0.7 + armSwing, py + T * 0.55);
            ctx.stroke();

            // Legs (based on animation)
            const legSwing = (anim === 1) ? T * 0.1 : ((anim === 3) ? -T * 0.1 : 0);
            ctx.beginPath();
            // Left leg
            ctx.moveTo(px + T * 0.5, py + T * 0.6);
            ctx.lineTo(px + T * 0.35 - legSwing, py + T * 0.85);
            // Right leg
            ctx.moveTo(px + T * 0.5, py + T * 0.6);
            ctx.lineTo(px + T * 0.65 + legSwing, py + T * 0.85);
            ctx.stroke();

            // Apple II style: Gold indicator when carrying gold (flashing)
            if (p.goldCount > 0) {
                const goldPulse = Math.sin(this.frameCount * GOLD_ANIM_SPEED) * 0.3 + 0.7;
                ctx.fillStyle = COLORS.YELLOW;
                ctx.globalAlpha = goldPulse;
                ctx.fillRect(px + T * 0.4, py - T * 0.15, T * 0.2, T * 0.15);
                // Shine effect
                ctx.fillStyle = COLORS.WHITE;
                ctx.globalAlpha = goldPulse * 0.8;
                ctx.fillRect(px + T * 0.42, py - T * 0.13, T * 0.06, T * 0.04);
                ctx.strokeStyle = COLORS.ORANGE;
                ctx.lineWidth = s(1);
                ctx.strokeRect(px + T * 0.4, py - T * 0.15, T * 0.2, T * 0.15);
                ctx.globalAlpha = 1;
            }

            // Death animation - falling effect
            if (p.dying) {
                const deathFrame = Math.min(p.deathTimer / DEATH_DELAY_FRAMES, 1);
                ctx.globalAlpha = 1 - deathFrame;
                ctx.strokeStyle = COLORS.RED;
                ctx.lineWidth = s(3);
                // X eyes
                ctx.beginPath();
                ctx.moveTo(headX - T * 0.08, py + T * 0.15);
                ctx.lineTo(headX + T * 0.08, py + T * 0.23);
                ctx.moveTo(headX + T * 0.08, py + T * 0.15);
                ctx.lineTo(headX - T * 0.08, py + T * 0.23);
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
        }

        drawEnemy(e) {
            const ctx = this.ctx;
            const T = TILE_SIZE;
            const px = e.x * T;
            const py = e.y * T;
            const anim = (e.vx !== 0 || e.vy !== 0) ? Math.floor(e.frame / 2) % 4 : 0;
            const s = (v) => v * SCALE;

            if (e.trapped > 0) {
                // Apple II style: trapped enemy with more detailed animation
                const tileX = Math.floor(e.x);
                const tileY = Math.floor(e.y);
                const hx = tileX * T;
                const hy = tileY * T;
                
                // Dark hole effect
                ctx.fillStyle = COLORS.BLACK;
                ctx.fillRect(hx + s(1), hy + s(1), T - s(2), T - s(2));
                ctx.strokeStyle = COLORS.BROWN;
                ctx.lineWidth = s(1);
                ctx.strokeRect(hx + s(1), hy + s(1), T - s(2), T - s(2));
                
                // Pulsing red circle - faster pulse for urgency
                const pulse = Math.sin(this.frameCount * TRAP_PULSE_SPEED) * 0.3 + 0.7;
                ctx.fillStyle = COLORS.RED;
                ctx.globalAlpha = pulse;
                ctx.beginPath();
                ctx.arc(hx + T * 0.5, hy + T * 0.55, T * 0.22, 0, Math.PI * 2);
                ctx.fill();
                
                // Inner glow
                ctx.globalAlpha = pulse * 0.5;
                ctx.beginPath();
                ctx.arc(hx + T * 0.5, hy + T * 0.55, T * 0.12, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
                
                // Arms reaching up - more animated
                const armWave = Math.sin(this.frameCount * 0.2) * T * 0.05;
                ctx.strokeStyle = COLORS.RED;
                ctx.lineWidth = s(2);
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(hx + T * 0.35, hy + T * 0.4);
                ctx.lineTo(hx + T * 0.2 - armWave, hy + T * 0.2);
                ctx.moveTo(hx + T * 0.65, hy + T * 0.4);
                ctx.lineTo(hx + T * 0.8 + armWave, hy + T * 0.2);
                ctx.stroke();

                // Show warning when about to escape (last 60 frames)
                if (e.trapped < 60) {
                    const warningPulse = Math.sin(this.frameCount * 0.5) * 0.5 + 0.5;
                    ctx.fillStyle = COLORS.YELLOW;
                    ctx.globalAlpha = warningPulse;
                    ctx.font = `${Math.floor(10 * SCALE)}px Courier New`;
                    ctx.textAlign = 'center';
                    ctx.fillText('!', hx + T * 0.5, hy - T * 0.1);
                    ctx.globalAlpha = 1;
                }
                return;
            }

            // C64 style: red stick figure enemy
            const lineWidth = s(2);
            ctx.strokeStyle = COLORS.RED;
            ctx.lineWidth = lineWidth;
            ctx.lineCap = 'round';

            // Head (circle with helmet)
            const headRadius = T * 0.15;
            ctx.beginPath();
            ctx.arc(px + T * 0.5, py + T * 0.2, headRadius, 0, Math.PI * 2);
            ctx.stroke();

            // Helmet line
            ctx.beginPath();
            ctx.moveTo(px + T * 0.35, py + T * 0.12);
            ctx.lineTo(px + T * 0.65, py + T * 0.12);
            ctx.stroke();

            // Body (vertical line)
            ctx.beginPath();
            ctx.moveTo(px + T * 0.5, py + T * 0.35);
            ctx.lineTo(px + T * 0.5, py + T * 0.6);
            ctx.stroke();

            // Arms (based on animation)
            const armSwing = (anim === 1 || anim === 3) ? T * 0.1 : 0;
            ctx.beginPath();
            // Left arm
            ctx.moveTo(px + T * 0.5, py + T * 0.4);
            ctx.lineTo(px + T * 0.3 - armSwing, py + T * 0.55);
            // Right arm
            ctx.moveTo(px + T * 0.5, py + T * 0.4);
            ctx.lineTo(px + T * 0.7 + armSwing, py + T * 0.55);
            ctx.stroke();

            // Legs (based on animation)
            const legSwing = (anim === 1) ? T * 0.1 : ((anim === 3) ? -T * 0.1 : 0);
            ctx.beginPath();
            // Left leg
            ctx.moveTo(px + T * 0.5, py + T * 0.6);
            ctx.lineTo(px + T * 0.35 - legSwing, py + T * 0.85);
            // Right leg
            ctx.moveTo(px + T * 0.5, py + T * 0.6);
            ctx.lineTo(px + T * 0.65 + legSwing, py + T * 0.85);
            ctx.stroke();

            // Apple II style: Gold indicator when carrying gold (flashing yellow box)
            if (e.hasGold) {
                const goldPulse = Math.sin(this.frameCount * GOLD_ANIM_SPEED) * 0.3 + 0.7;
                ctx.fillStyle = COLORS.YELLOW;
                ctx.globalAlpha = goldPulse;
                ctx.fillRect(px + T * 0.4, py - T * 0.1, T * 0.2, T * 0.15);
                // Shine effect
                ctx.fillStyle = COLORS.WHITE;
                ctx.globalAlpha = goldPulse * 0.7;
                ctx.fillRect(px + T * 0.42, py - T * 0.08, T * 0.06, T * 0.04);
                ctx.strokeStyle = COLORS.ORANGE;
                ctx.lineWidth = s(1);
                ctx.strokeRect(px + T * 0.4, py - T * 0.1, T * 0.2, T * 0.15);
                ctx.globalAlpha = 1;
            }
        }

        gameLoop() {
            try {
                const now = performance.now();
                const delta = now - this.lastTime;

                if (delta >= this.tickRate) {
                    // Demo mode timer - 30    
                    if (!this.demoMode) {
                        const idleTime = this.frameCount - this.lastInputTime;
                        if (idleTime >= this.idleTimeoutFrames) {
                            this.startDemo();
                        }
                    }

                    // Demo AI update
                    if (this.demoMode && this.gameState === STATE.PLAYING) {
                        this.updateDemo();
                    }

                    // Handle frame-based timers
                    if (this.gameState === STATE.DYING) {
                        this.deathTimer--;
                        if (this.deathTimer <= 0) {
                            if (this.demoMode) {
                                //    
                                this.currentLevel = Math.floor(Math.random() * Math.min(10, this.activeLevels.length)) + 1;
                                this.loadLevel(this.currentLevel);
                                this.gameState = STATE.PLAYING;
                                this.showMessage('DEMO - PRESS ENTER TO PLAY');
                            } else if (this.lives <= 0) {
                                this.gameState = STATE.GAME_OVER;
                                this.showMessage('GAME OVER - PRESS ENTER');
                                this.sound.play('gameover');
                            } else {
                                this.loadLevel(this.currentLevel);
                                this.gameState = STATE.PLAYING;
                                this.showMessage('');
                            }
                        }
                    }

                    if (this.gameState === STATE.LEVEL_COMPLETE) {
                        this.levelCompleteTimer--;
                        if (this.levelCompleteTimer <= 0) {
                            if (this.demoMode) {
                                //    
                                this.currentLevel = Math.floor(Math.random() * Math.min(10, this.activeLevels.length)) + 1;
                                this.showMessage('DEMO - PRESS ENTER TO PLAY');
                            }
                            this.loadLevel(this.currentLevel);
                            this.gameState = STATE.PLAYING;
                            if (!this.demoMode) this.showMessage('');
                        }
                    }

                    this.update();
                    this.render();
                    // Keep frameCount incrementing for animations even when not playing
                    if (this.gameState !== STATE.PLAYING) {
                        this.frameCount++;
                    }
                    this.lastTime = now - (delta % this.tickRate);
                }
            } catch (e) {
                console.error('Game loop error:', e);
            }

            requestAnimationFrame(() => this.gameLoop());
        }
    }

    // ============================================
    // INITIALIZE
    // ============================================

    window.addEventListener('load', () => {
        new LodeRunner();
    });

})();
